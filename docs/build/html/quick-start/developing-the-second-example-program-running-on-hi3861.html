
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Developing the Second Example Program Running on Hi3861 &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="developing-the-second-example-program-running-on-hi3861">
<h1>Developing the Second Example Program Running on Hi3861<a class="headerlink" href="#developing-the-second-example-program-running-on-hi3861" title="Permalink to this headline">¶</a></h1>
<p>This example shows how to compile a simple service and print <strong>Hello
World</strong>.</p>
<div class="section" id="modifying-source-code">
<h2>Modifying Source Code<a class="headerlink" href="#modifying-source-code" title="Permalink to this headline">¶</a></h2>
<p>The source code needs to be modified when fixing bugs or compiling a new
service. The following describes how to modify the source code when
compiling a new service.</p>
<ol class="arabic">
<li><p>Determine the directory structure.</p>
<p>Before compiling a service, you must create a directory (or a
directory structure) in <strong>./applications/sample/wifi-iot/app</strong> to
store source code files.</p>
<p>For example, add the <strong>my_first_app</strong> service to the <strong>app</strong>
directory, where <strong>hello_world.c</strong> is the service code and
<strong>BUILD.gn</strong> is the compilation script. The directory structure is
shown as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
└── applications
    └── sample
        └── wifi-iot
            └── app
                │── my_first_app
                │  │── hello_world.c
                │  └── BUILD.gn
                └── BUILD.gn
</pre></div>
</div>
</li>
<li><p>Compile the service code.</p>
<p>Create the service entry function <strong>HelloWorld</strong> in <strong>hello_world.c</strong>
and implement service logic. Use the SYS_RUN() of the OpenHarmony
<strong>bootstrap</strong> module to start services. (<strong>SYS_RUN</strong> is defined in
the <strong>ohos_init.h</strong> file.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &quot;ohos_init.h&quot;</span>
<span class="c1">#include &quot;ohos_types.h&quot;</span>

<span class="n">void</span> <span class="n">HelloWorld</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;[DEMO] Hello world.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">SYS_RUN</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Compile the <strong>BUILD.gn</strong> file for building services into a static
library.</p>
<p>The <strong>BUILD.gn</strong> file consists of three parts, including target,
source file, and header file path. You need to fill in all of these
parts. Take <strong>my_first_app</strong> as an example, you need to create
<strong>./applications/sample/wifi-iot/app/my_first_app/BUILD.gn</strong> and
complete the following configurations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static_library</span><span class="p">(</span><span class="s2">&quot;myapp&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;hello_world.c&quot;</span>
    <span class="p">]</span>
    <span class="n">include_dirs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;//utils/native/lite/include&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Specify the compilation result named libmyapp.a in
<strong>static_library</strong>. You can fill in this part based on your need.</p></li>
<li><p>Specify the .c file on which a file depends and its path in
<strong>sources</strong>. The path that contains <strong>//</strong> represents an absolute
path (the code root path), otherwise it is a relative path.</p></li>
<li><p>Specify the path of .h file on which <strong>sources</strong> depends in
<strong>include_dirs</strong>.</p></li>
</ul>
</li>
<li><p>Compile the <strong>BUILD.gn</strong> file and specify the feature modules to be
built.</p>
<p>Configure the <strong>./applications/sample/wifi-iot/app/BUILD.gn</strong> file
and add an index to the <strong>features</strong> field to enable the target to be
involved in compilation. Specify the path and target of a service
module in <strong>features</strong>. The following uses <strong>my_first_app</strong> as an
example and the <strong>features</strong> is configured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">import</span><span class="p">(</span><span class="s2">&quot;//build/lite/config/component/lite_component.gni&quot;</span><span class="p">)</span>

<span class="n">lite_component</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;my_first_app:myapp&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>my_first_app</strong> is a relative path that points to
<strong>./applications/sample/wifi-iot/app/my_first_app/BUILD.gn</strong>.</p></li>
<li><p><strong>myapp</strong> represents the static library in
<strong>./applications/sample/wifi-iot/app/my_first_app/BUILD.gn</strong>.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="debugging-and-verification">
<h2>Debugging and Verification<a class="headerlink" href="#debugging-and-verification" title="Permalink to this headline">¶</a></h2>
<p>Currently, there are two debugging and verification methods: using
printf to print logs and using asm files to locate <strong>panic</strong> problems.
You can select one of them based on your need.</p>
<p>As the service shown is simple, use the printf method. The following
describes the two debugging methods.</p>
</div>
<div class="section" id="printf">
<h2>printf<a class="headerlink" href="#printf" title="Permalink to this headline">¶</a></h2>
<p>Add <strong>printf</strong> function to the code, which helps print data to the
serial port. You can add log printing in key service paths or service
exception locations, as shown in the following figure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">HelloWorld</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;[DEMO] Hello world.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="locating-exceptions-using-the-asm-file">
<h2>Locating Exceptions Using the asm File<a class="headerlink" href="#locating-exceptions-using-the-asm-file" title="Permalink to this headline">¶</a></h2>
<p>When the system exits abnormally, the call stack information about the
abnormal exit is displayed on the serial port. The following is an
example: You can locate the exception by parsing the exception stack
information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=======</span><span class="n">KERNEL</span> <span class="n">PANIC</span><span class="o">=======</span>
<span class="o">**********************</span><span class="n">Call</span> <span class="n">Stack</span><span class="o">*********************</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">0</span> <span class="o">--</span> <span class="mi">4860</span><span class="n">d8</span> <span class="n">addr</span><span class="p">:</span><span class="n">f784c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">1</span> <span class="o">--</span> <span class="mi">47</span><span class="n">b2b2</span> <span class="n">addr</span><span class="p">:</span><span class="n">f788c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">2</span> <span class="o">--</span> <span class="mf">3e562</span><span class="n">c</span> <span class="n">addr</span><span class="p">:</span><span class="n">f789c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">3</span> <span class="o">--</span> <span class="mi">4101</span><span class="n">de</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ac</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">4</span> <span class="o">--</span> <span class="mf">3e5</span><span class="n">f32</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78cc</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">5</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f78c0</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ec</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">6</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f5e24</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78fc</span>
<span class="o">********************</span><span class="n">Call</span> <span class="n">Stack</span> <span class="n">end</span><span class="o">*******************</span>
</pre></div>
</div>
<p>To parse the call stack information, the <strong>Hi3861_wifiiot_app.asm</strong> file
is required. This file records the symbol addresses of the functions in
the code in the flash memory and the disassembly information. The asm
file is built and output together with the version software package and
is stored in the <strong>./out/wifiiot/</strong> directory.</p>
<ol class="arabic">
<li><p>(Optional) Save the** CallStack** information to a txt file for
editing.</p></li>
<li><p>Open the asm file, search for the function address in each call
stack, and list the corresponding function. Generally, you only need
to find the functions matching the first several stacks to locate
exceptions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Stack</span> <span class="mi">0</span> <span class="o">--</span> <span class="mi">4860</span><span class="n">d8</span> <span class="n">addr</span><span class="p">:</span><span class="n">f784c</span> <span class="o">--</span> <span class="n">WadRecvCB</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">1</span> <span class="o">--</span> <span class="mi">47</span><span class="n">b2b2</span> <span class="n">addr</span><span class="p">:</span><span class="n">f788c</span> <span class="o">--</span> <span class="n">wal_sdp_process_rx_data</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">2</span> <span class="o">--</span> <span class="mf">3e562</span><span class="n">c</span> <span class="n">addr</span><span class="p">:</span><span class="n">f789c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">3</span> <span class="o">--</span> <span class="mi">4101</span><span class="n">de</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ac</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">4</span> <span class="o">--</span> <span class="mf">3e5</span><span class="n">f32</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78cc</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">5</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f78c0</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ec</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">6</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f5e24</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78fc</span>
</pre></div>
</div>
</li>
<li><p>Determined that an exception occurs in the <strong>WadRecvCB</strong> function
based on the call stack information.</p>
<p><img alt="image1" src="../_images/en-us_image_0000001054763554.png" /></p>
</li>
<li><p>Check and modify the code.</p></li>
</ol>
</div>
<div class="section" id="viewing-execution-result">
<h2>Viewing Execution Result<a class="headerlink" href="#viewing-execution-result" title="Permalink to this headline">¶</a></h2>
<p>After the sample code is compiled, burnt, run, and debugged, the
following information is displayed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ready to OS start
FileSystem mount ok.
wifi init success!
[DEMO] Hello world.
</pre></div>
</div>
</div>
<div class="section" id="follow-up-learning">
<h2>Follow-up Learning<a class="headerlink" href="#follow-up-learning" title="Permalink to this headline">¶</a></h2>
<p>Congratulations! You have finished all steps! You are advised to go on
learning how to develop WLAN-connected products.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/quick-start/developing-the-second-example-program-running-on-hi3861.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>