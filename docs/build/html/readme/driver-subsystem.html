
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Driver Subsystem &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="driver-subsystem">
<h1>Driver Subsystem<a class="headerlink" href="#driver-subsystem" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The OpenHarmony driver subsystem is constructed using the C
object-oriented programming (OOP). It provides a unified driver platform
through platform decoupling, kernel decoupling, and compatible kernels.
This unified driver architecture platform is designed to provide a more
precise and efficient development environment, where you develop a
driver that can be deployed on different systems supporting HDF.</p>
<p>The OpenHarmony driver subsystem provides the following key features and
capabilities to shorten the driver development period and make
third-party device driver integration much easier:</p>
<ul>
<li><p>Flexible framework capabilities</p>
<p>Based on the traditional driver framework, the OpenHarmony driver
subsystem builds flexible framework capabilities to deploy terminal
products with the capacity ranging from hundreds KB to hundreds MB of
memory.</p>
</li>
<li><p>Standardized driver APIs</p>
<p>The OpenHarmony driver subsystem provides you with abundant and
stable driver APIs, which are compatible with those of future-proof
smartphones, tablets, smart TVs.</p>
</li>
<li><p>Component-based driver models</p>
<p>The OpenHarmony driver subsystem supports component-based driver
models. It provides more refined driver management to dismantle
components, enabling you to focus on the interaction between the
hardware and driver.</p>
<p>The subsystem also presets some template-based driver model
components, such as the network device models.</p>
</li>
<li><p>Normalized configuration GUIs</p>
<p>The OpenHarmony driver subsystem provides a unified configuration GUI
and a cross-platform tool for configuration conversion and generation
to implement seamless switchover across platforms.</p>
</li>
</ul>
<p>You can use DevEco to manage driver projects, generate driver templates,
and manage settings to make the development of OpenHarmony drivers
easier.</p>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>The OpenHarmony driver framework adopts the primary/secondary mode and
is developed based on the framework, model, competence library, and
tool.</p>
<p><strong>Figure 1</strong> Interaction between the driver and framework</p>
<p><img alt="image1" src="../_images/en-us_image_0000001053805078.png" /></p>
<ul class="simple">
<li><p>Driver framework stored in the <strong>frameworks/core</strong> directory</p>
<ul>
<li><p>Loads and starts drivers.</p></li>
<li><p>Deploys and expands the driver framework flexibly through the
object manager.</p></li>
</ul>
</li>
<li><p>Driver models stored in the <strong>frameworks/model</strong> directory</p>
<ul>
<li><p>Provides model-based driving capabilities, such as network device
models.</p></li>
</ul>
</li>
<li><p>Driver capability library stored in the <strong>frameworks/ability</strong>
directory</p>
<ul>
<li><p>Provides basic driver models, such as the I/O communication model.</p></li>
</ul>
</li>
<li><p>Driver tools stored in the <strong>frameworkstools</strong> directory</p>
<ul>
<li><p>Provides tools for HDI API conversion, and driver configuration
and driver compilation.</p></li>
</ul>
</li>
<li><p>Driver APIs stored in the <strong>litehdi</strong> directory</p>
<ul>
<li><p>Provides normalized driver APIs.</p></li>
</ul>
</li>
<li><p>Support stored in the <strong>frameworks/support</strong> directory</p>
<ul>
<li><p>Provides platform driver APIs and system APIs with normalized
abstraction capabilities.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="directory-structures">
<h2>Directory Structures<a class="headerlink" href="#directory-structures" title="Permalink to this headline">¶</a></h2>
<p><strong>Table 1</strong> Directory structure of the OpenHarmony driver framework</p>
<table><thead align="left"><tr id="row7977610131417"><th class="cellrowborder" valign="top" width="30.34%" id="mcps1.2.3.1.1"><p id="p18792459121314"><p>Directory</p>
</p></th><th class="cellrowborder" valign="top" width="69.66%" id="mcps1.2.3.1.2"><p id="p77921459191317"><p>Description</p>
</p></th></tr></thead><tbody><tr id="row17666001869"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p4667601064"><p>hdf</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p154741318610"><p>Indicates the OpenHarmony driver framework.</p>
</p></td></tr><tr id="row17977171010144"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p2793159171311"><p>hdf/frameworks</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p879375920132"><p>Provides the source code to develop the driver frameworks, driver
models, and capability model libraries.</p>
</p></td></tr><tr id="row258624313915"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p858718432912"><p>hdf/frameworks/ability</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p1866016071012"><p>Provides functional capabilities for the driver development, such as the
message model libraries.</p>
</p></td></tr><tr id="row6978161091412"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p37931659101311"><p>hdf/frameworks/core</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p6793059171318"><p>Provides the core code to implement the OpenHarmony driver framework.</p>
</p></td></tr><tr id="row6978201031415"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p117935599130"><p>hdf/frameworks/core/host</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p53051522133"><p>Provides functions of the driver host environment framework, including:</p>
</p><p id="p168291956191214"><ol class="arabic simple">
<li><p>Loading and starting a driver, and dispatching device nodes.</p></li>
</ol>
</p><p id="p945834131310"><ol class="arabic simple" start="2">
<li><p>Dispatching events.</p></li>
</ol>
</p><p id="p1365513245138"><ol class="arabic simple" start="3">
<li><p>Managing the internal power status.</p></li>
</ol>
</p><p id="p113814121414"><ol class="arabic simple" start="4">
<li><p>Managing the common driver resource configurations.</p></li>
</ol>
</p></td></tr><tr id="row138241821218"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p1138321861211"><p>hdf/frameworks/core/manager</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p103831518181211"><p>Provides the management modules of the driver framework, including:</p>
</p><p id="p1125114971315"><ol class="arabic simple">
<li><p>Driver API management module.</p></li>
</ol>
</p><p id="p419655510136"><ol class="arabic simple" start="2">
<li><p>Driver configuration management module.</p></li>
</ol>
</p><p id="p95776361144"><ol class="arabic simple" start="3">
<li><p>Device node management module.</p></li>
</ol>
</p><p id="p75789456140"><ol class="arabic simple" start="4">
<li><p>Security management module.</p></li>
</ol>
</p><p id="p183476761517"><ol class="arabic simple" start="5">
<li><p>Fault management module.</p></li>
</ol>
</p></td></tr><tr id="row116251627171512"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p76251275152"><p>hdf/frameworks/core/shared</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p56256278150"><p>Provides shared code for the host and manager.</p>
</p></td></tr><tr id="row2306123015162"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p10306143019164"><p>hdf/frameworks/model</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p1030713021612"><p>Provides a universal framework model for drivers.</p>
</p></td></tr><tr id="row2021312310176"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p421315312177"><p>hdf/frameworks/model/network</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p421313113179"><p>Provides network device models for drivers.</p>
</p></td></tr><tr id="row2167642189"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p21683416181"><p>hdf/frameworks/support</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p71681548183"><p>Provides drivers with system APIs and hardware, such as GPIO, I2C, and
SPI capabilities.</p>
</p><p id="p19848191416195"><p>Some interfaces can be migrated across platforms.</p>
</p></td></tr><tr id="row116634294203"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p1866392919204"><p>hdf/frameworks/support/platform</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p5663329202017"><p>Provides APIs that support the common hardware of platforms, such as
GPIO, I2C, and SPI capabilities.</p>
</p></td></tr><tr id="row193157275210"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p1331513279211"><p>hdf/frameworks/tools</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p131542762113"><p>Provides the driver capability libraries, such as the tool that
configures and compiles the HCS (HDF Configuration Source).</p>
</p></td></tr><tr id="row66349163223"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p2634161611224"><p>hdf/frameworks/utils</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p26341516202215"><p>Provides basic data structures and algorithms.</p>
</p></td></tr><tr id="row1897841071415"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p16793185961315"><p>hdf/lite/adapter</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p14793959161317"><p>Adapts to kernel operation APIs and provides abstract APIs.</p>
</p></td></tr><tr id="row16448173512518"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p644893514514"><p>hdf/lite/include</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p1744933517511"><p>Provides driver APIs for lightweight devices.</p>
</p></td></tr><tr id="row192731625216"><td class="cellrowborder" valign="top" width="30.34%" headers="mcps1.2.3.1.1 "><p id="p10281116185217"><p>hdf/lite/hdi</p>
</p></td><td class="cellrowborder" valign="top" width="69.66%" headers="mcps1.2.3.1.2 "><p id="p7286165524"><p>Provides APIs of the OpenHarmony driver.</p>
</p></td></tr></tbody></table></div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="use">
<h2>Use<a class="headerlink" href="#use" title="Permalink to this headline">¶</a></h2>
<p><strong>Figure 2</strong> Interaction between the driver and framework</p>
<p><img alt="image2" src="../_images/en-us_image_0000001052764349.png" /></p>
<p>Driver loading is mostly done by the driver framework, and you only need
to register and configure required APIs. The driver framework will load
and initialize the driver based on the parsing content.</p>
<p>Driver development based on the HDF consists of the following three
parts:</p>
<ol class="arabic simple">
<li><p>Driver: develop the functions.</p></li>
<li><p>Information configuration: present the loading information of the
driver.</p></li>
<li><p>Resource configuration: configure the hardware information of the
driver.</p></li>
</ol>
<p>The driver mainly aims to develop the functions.</p>
<p>The first part that catches your eyes is the driver entry, which is
described through <strong>DriverEntry</strong>.</p>
<p>Three APIs are available, namely <strong>bind</strong>, <strong>init</strong>, and <strong>release</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">HdfDriverEntry</span> <span class="n">g_deviceSample</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">.</span><span class="n">moduleVersion</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="o">.</span><span class="n">moduleName</span> <span class="o">=</span> <span class="s2">&quot;sample_driver&quot;</span><span class="p">,</span>
    <span class="o">.</span><span class="n">Bind</span> <span class="o">=</span> <span class="n">SampleDriverBind</span><span class="p">,</span>
    <span class="o">.</span><span class="n">Init</span> <span class="o">=</span> <span class="n">SampleDriverInit</span><span class="p">,</span>
    <span class="o">.</span><span class="n">Release</span> <span class="o">=</span> <span class="n">SampleDriverRelease</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p><strong>Bind</strong>: This API is used to bind driver devices and its functions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32_t</span> <span class="n">SampleDriverBind</span><span class="p">(</span><span class="n">struct</span> <span class="n">HdfDeviceObject</span> <span class="o">*</span><span class="n">deviceObject</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">//</span> <span class="n">TODO</span><span class="p">:</span> <span class="n">Bind</span> <span class="n">device</span> <span class="n">service</span> <span class="n">to</span> <span class="n">device</span> <span class="nb">object</span><span class="o">.</span>
    <span class="o">//</span> <span class="n">And</span> <span class="n">you</span> <span class="n">can</span> <span class="n">also</span> <span class="n">initialize</span> <span class="n">device</span> <span class="n">resources</span> <span class="n">here</span><span class="o">.</span>
    <span class="k">return</span> <span class="n">HDF_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Description of Init: When devices are successfully bound, the framework
calls Init to initialize the driver. After initialization is complete,
the driver framework will determine whether to create external service
interfaces based on the configuration file. If the driver fails to be
initialized, the driver framework will automatically release the created
device interface.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32_t</span> <span class="n">SampleDriverInit</span><span class="p">(</span><span class="n">struct</span> <span class="n">HdfDeviceObject</span> <span class="o">*</span><span class="n">deviceObject</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">//</span> <span class="n">TODO</span><span class="p">:</span> <span class="n">Init</span> <span class="n">hardware</span> <span class="ow">or</span> <span class="n">other</span> <span class="n">resources</span> <span class="n">here</span><span class="o">.</span>
    <span class="k">return</span> <span class="n">HDF_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Release</strong>: When you need to uninstall a driver, the drive framework
calls this function to release the driver resources. Then, other
internal resources will be released.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">SampleDriverRelease</span><span class="p">(</span><span class="n">struct</span> <span class="n">HdfDeviceObject</span> <span class="o">*</span><span class="n">deviceObject</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">//</span> <span class="n">Release</span> <span class="nb">all</span> <span class="n">resources</span><span class="o">.</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The OpenHarmony driver is mainly deployed in the kernel space using the
static link mode. It is compiled and packed with the kernel subsystem
and system image.</p>
<p><strong>Figure 3</strong> OpenHarmony driver installation</p>
<p><img alt="image3" src="../_images/en-us_image_0000001053044331.png" /></p>
</div>
<div class="section" id="repositories-involved">
<h2>Repositories Involved<a class="headerlink" href="#repositories-involved" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://openharmony.gitee.com/openharmony/drivers_hdf_frameworks">drivers_hdf_frameworks</a></p>
<p><a class="reference external" href="https://openharmony.gitee.com/openharmony/drivers_hdf_lite">drivers_hdf_lite</a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/readme/driver-subsystem.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>