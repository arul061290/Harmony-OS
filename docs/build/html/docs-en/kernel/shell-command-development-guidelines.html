
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shell Command Development Guidelines &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="shell-command-development-guidelines">
<h1>Shell Command Development Guidelines<a class="headerlink" href="#shell-command-development-guidelines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="development-guidelines">
<h2>Development Guidelines<a class="headerlink" href="#development-guidelines" title="Permalink to this headline">¶</a></h2>
<p>You can perform the following operations to add shell commands:</p>
<ol class="arabic">
<li><p>Include the following header files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;shell.h&quot;</span>
<span class="c1">#include &quot;shcmd.h&quot;</span>
</pre></div>
</div>
</li>
<li><p>Register commands. You can register commands either statically or
dynamically when the system is running. In most cases, static
registration is widely used by common system commands, and dynamic
registration is widely used by user commands.</p>
<ol class="arabic">
<li><p>Static registration:</p>
<ol class="arabic">
<li><p>Register a command using a macro.</p>
<p>The prototype of the macro is as follows:</p>
<p>SHELLCMD_ENTRY(l, cmdType, cmdKey, paraNum, cmdHook)</p>
<p><strong>Table 1</strong> Parameters of the SHELLCMD_ENTRY macro</p>
<table><thead align="left"><tr id="row209856358456"><th class="cellrowborder" valign="top" width="20.91%" id="mcps1.2.3.1.1"><p id="p998583517456"><p>Parameter</p>
</p></th><th class="cellrowborder" valign="top" width="79.09%" id="mcps1.2.3.1.2"><p id="p169851735174511"><p>Description</p>
</p></th></tr></thead><tbody><tr id="row13985153574517"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p6985113513452"><p>l</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p998573514457"><p>Indicates the global variable name to be passed during the
static registration. Note that the name cannot be the same as
other symbol names in the system.</p>
</p></td></tr><tr id="row398513594518"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p59856356450"><p>cmdType</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p119859355458"><p>Indicates the command type.</p>
</p><ul id="ul11135144114816"><li><p id="p21351144488"><p>CMD_TYPE_EX: does not support standard command parameters and
will mask the command keywords you entered. For example, if you
enter ls /ramfs, only /ramfs will be passed to the registration
function, and the ls command keyword will be masked.</p>
</p></li><li><p id="p21353410482"><p>CMD_TYPE_STD: supports standard command parameters. All the
characters you entered will be passed to the registration
function after being parsed.</p>
</p></li></ul></td></tr><tr id="row20985153524519"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p1098693510451"><p>cmdKey</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p11986735144514"><p>Indicates the command keyword, which is the name used to access
a shell function.</p>
</p></td></tr><tr id="row1398683511450"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p598613359451"><p>paraNum</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p11986535144516"><p>Indicates the maximum number of input parameters in the
execution function to be invoked. This parameter is not
supported currently.</p>
</p></td></tr><tr id="row39861935154516"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p5986735114518"><p>cmdHook</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p398683574515"><p>Indicates the address of the execution function, that is, the
function that is actually executed by the command.</p>
</p></td></tr></tbody></table><p>Example: SHELLCMD_ENTRY(ls_shellcmd, CMD_TYPE_EX, “ls”, XARGS,
(CMD_CBK_FUNC)osShellCmdLs)</p>
</li>
<li><p>Add the required options to the
<strong>build/mk/liteos_tables_ldflags.mk</strong> file.</p>
<p>For example, when registering the <strong>ls</strong> command, add
<strong>-uls_shellcmd</strong> to the <strong>build/mk/liteos_tables_ldflags.mk</strong>
file. <strong>-u</strong> is followed by the first parameter of
<strong>SHELLCMD_ENTRY</strong>.</p>
</li>
</ol>
</li>
<li><p>Dynamic registration:</p>
<p>The prototype of the function to register is as follows:</p>
<p>UINT32 osCmdReg(CmdT ype cmdType, CHAR *cmdKey, UINT32 paraNum,
CmdCallBackFunc cmdProc)</p>
<p><strong>Table 2</strong> Parameters of UINT32 osCmdReg</p>
<table><thead align="left"><tr id="row1644693318490"><th class="cellrowborder" valign="top" width="20.91%" id="mcps1.2.3.1.1"><p id="p1644618337493"><p>Parameter</p>
</p></th><th class="cellrowborder" valign="top" width="79.09%" id="mcps1.2.3.1.2"><p id="p444603317491"><p>Description</p>
</p></th></tr></thead><tbody><tr id="row844643374912"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p14446133319498"><p>cmdType</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p174461339496"><p>Indicates the command type.</p>
</p><ul id="ul1244773317496"><li><p id="p1844719331495"><p>CMD_TYPE_EX: does not support standard command parameters and will
mask the command keywords you entered. For example, if you enter
ls /ramfs, only /ramfs will be passed to the registration
function, and the ls command keyword will be masked.</p>
</p></li><li><p id="p20447143315498"><p>CMD_TYPE_STD: supports standard command parameters. All the
characters you entered will be passed to the registration function
after being parsed.</p>
</p></li></ul></td></tr><tr id="row14471733184915"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p744783319494"><p>cmdKey</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p18447833124914"><p>Indicates the command keyword, which is the name used to access a
shell function.</p>
</p></td></tr><tr id="row17447143317495"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p174477331495"><p>paraNum</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p8447233184914"><p>Indicates the maximum number of input parameters in the execution
function to be invoked. This parameter is not supported currently.
The default value is XARGS(0xFFFFFFFF).</p>
</p></td></tr><tr id="row10447233174913"><td class="cellrowborder" valign="top" width="20.91%" headers="mcps1.2.3.1.1 "><p id="p18447183334920"><p>cmdHook</p>
</p></td><td class="cellrowborder" valign="top" width="79.09%" headers="mcps1.2.3.1.2 "><p id="p44471533184912"><p>Indicates the address of the execution function, that is, the
function that is actually executed by the command.</p>
</p></td></tr></tbody></table><p>Example: osCmdReg(CMD_TYPE_EX, “ls”, XARGS,
(CMD_CBK_FUNC)osShellCmdLs)</p>
</li>
</ol>
<blockquote>
<div><p><img alt="image1" src="../../_images/icon-note4.gif" /> <strong>NOTE:</strong> The command keyword must be unique.
Specifically, two different commands cannot share the same command
keyword. Otherwise, only one command is executed. When executing
user commands sharing the same keyword, the shell executes only
the first command in the <strong>help</strong> commands.</p>
</div></blockquote>
</li>
<li><p>Use the following function prototype to add built-in commands:</p>
<p>UINT32 osShellCmdLs(UINT32 argc, CHAR **argv)</p>
<p><strong>Table 3</strong> Parameters of osShellCmdLs</p>
<table><thead align="left"><tr id="row84451058105117"><th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.1"><p id="p1644515855111"><p>Parameter</p>
</p></th><th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.2"><p id="p18445145805113"><p>Description</p>
</p></th></tr></thead><tbody><tr id="row194461458185112"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p64461158145120"><p>argc</p>
</p></td><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p1844625885112"><p>Indicates the number of parameters in the shell command.</p>
</p></td></tr><tr id="row144620587511"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p244625811517"><p>argv</p>
</p></td><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p11446958105119"><p>Indicates a pointer array, where each element points to a string. You
can determine whether to pass the command keyword to the registration
function by specifying the command type.</p>
</p></td></tr></tbody></table></li>
<li><p>Enter the shell command in either of the following methods:</p>
<ul class="simple">
<li><p>Enter the shell command in the serial port tool.</p></li>
<li><p>Enter the shell command in the Telnet tool. For details, see
<a class="reference external" href="telnet.md">telnet</a>.</p></li>
</ul>
</li>
</ol>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/docs-en/kernel/shell-command-development-guidelines.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>