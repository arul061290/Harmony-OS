
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Second Example Program of the Hi3861 Development Board &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="the-second-example-program-of-the-hi3861-development-board">
<h1>The Second Example Program of the Hi3861 Development Board<a class="headerlink" href="#the-second-example-program-of-the-hi3861-development-board" title="Permalink to this headline">¶</a></h1>
<p>This example shows how to compile a simple service and export Hello
World.</p>
<div class="section" id="the-source-code-is-modified">
<h2>The source code is modified.<a class="headerlink" href="#the-source-code-is-modified" title="Permalink to this headline">¶</a></h2>
<p>The source code needs to be modified in the bugfix and new service
scenarios. The following uses a new service as an example to describe
how to modify the source code.</p>
<ol class="arabic">
<li><p>Determine the directory structure.</p>
<p>Before compiling a service, you must create a directory (or a
directory structure) in ./application/sample/wifi-iot/app to store
service source code files.</p>
<p>For example, add the my_first_app service to the app directory, where
hello_world.c is the service code and BUILD.gn is the compilation
script. The directory structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
└── application
    └── sample
        └── wifi-iot
            └── app
                │── my_first_app
                │  │── hello_world.c
                │  └── BUILD.gn
                └── BUILD.gn
</pre></div>
</div>
</li>
<li><p>Compiling Service Code</p>
<p>Create the service entry function HelloWorld in hello_world.c and
implement the service logic. At the bottom of the code, use the
SYS_RUN() interface to start services. (SYS_RUN is defined in the
ohos_init.h file.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;ohos_init.h&quot;</span>
<span class="c1">#include &quot;ohos_types.h&quot;</span>

<span class="n">void</span> <span class="n">HelloWorld</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;[DEMO] Hello world.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">SYS_RUN</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Compile the BUILD.gn file for building services into a static
library.</p>
<p>As described in step 1, the BUILD.gn file consists of three parts
(target, source file, and header file path), which need to be filled
in by developers. Take my_first_app as an example. You need to create
./application/sample/app/my_first_app/BUILD.gn and complete the
following configurations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static_library</span><span class="p">(</span><span class="s2">&quot;myapp&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;hello_world.c&quot;</span>
    <span class="p">]</span>
    <span class="n">include_dirs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;//utils/native/lite/include&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The compilation result of the service module specified in
static_library is the static library file libmyapp.a. Set this
parameter based on the site requirements.</p></li>
<li><p>In source, specify the .c file and path on which the static
library .a depends. If the path contains “//”, it indicates an
absolute path (the code root path). If the path does not contain
“//”, it indicates a relative path.</p></li>
<li><p>In include_dirs, specify the path of the .h file on which the
source depends.</p></li>
</ul>
</li>
<li><p>Compile the BUILD.gn file and specify the feature modules to be
built.</p>
<p>Configure the ./application/sample/app/BUILD.gn file and add an index
to the features field to enable the target module to participate in
compilation. The features field specifies the path and target of a
service module. The following uses my_first_app as an example. The
features field is configured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lite_component</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0.0&quot;</span>
    <span class="n">dependences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;my_first_app:myapp&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>my_first_app is a relative path that points to
./application/sample/app/my_first_app/BUILD.gn.</p></li>
<li><p>myapp is the target that points to static_library(“myapp”) in
./application/sample/app/my_first_app/BUILD.gn.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="commissioning">
<h2>Commissioning<a class="headerlink" href="#commissioning" title="Permalink to this headline">¶</a></h2>
<p>Currently, there are three debugging and verification methods: using
printf to print logs, using asm files to locate panic problems, and
using jLink simulator for debugging. Developers can select a method
based on the actual service situation.</p>
<p>In this example, the service is simple. Therefore, you can use the
printf method to print logs. The following describes how to use various
debugging methods.</p>
</div>
<div class="section" id="h2printf-print">
<h2>h2printf print<a class="headerlink" href="#h2printf-print" title="Permalink to this headline">¶</a></h2>
<p>The printf maintenance and test function is added to the code. The
information is directly printed to the serial port. Developers can add
logs in key service paths or service exception locations, as shown in
the following figure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">HelloWorld</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;[DEMO] Hello world.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="h2-locate-the-fault-based-on-the-asm-file">
<h2>h2. Locate the fault based on the asm file.<a class="headerlink" href="#h2-locate-the-fault-based-on-the-asm-file" title="Permalink to this headline">¶</a></h2>
<p>When the system exits abnormally, the call stack information about the
abnormal exit cause is displayed on the serial port, as shown in the
following figure. You can locate the exception by parsing the exception
stack information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=======</span><span class="n">KERNEL</span> <span class="n">PANIC</span><span class="o">=======</span>
<span class="o">**********************</span><span class="n">Call</span> <span class="n">Stack</span><span class="o">*********************</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">0</span> <span class="o">--</span> <span class="mi">4860</span><span class="n">d8</span> <span class="n">addr</span><span class="p">:</span><span class="n">f784c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">1</span> <span class="o">--</span> <span class="mi">47</span><span class="n">b2b2</span> <span class="n">addr</span><span class="p">:</span><span class="n">f788c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">2</span> <span class="o">--</span> <span class="mf">3e562</span><span class="n">c</span> <span class="n">addr</span><span class="p">:</span><span class="n">f789c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">3</span> <span class="o">--</span> <span class="mi">4101</span><span class="n">de</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ac</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">4</span> <span class="o">--</span> <span class="mf">3e5</span><span class="n">f32</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78cc</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">5</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f78c0</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ec</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">6</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f5e24</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78fc</span>
<span class="o">********************</span><span class="n">Call</span> <span class="n">Stack</span> <span class="n">end</span><span class="o">*******************</span>
</pre></div>
</div>
<p>To parse the preceding call stack information, the
Hi3861_wifiiot_app.asm file is required. This file records the symbol
addresses of the functions in the code in the flash memory and the
disassembly information. The ASM file is built and output together with
the version software package and is stored in the
./out/wifiiot_hi3861v100_liteos_riscv/ directory.</p>
<ol class="arabic">
<li><p>Save the CallStack information to a .txt file for editing. Pause or
resume barcode scanning.</p></li>
<li><p>Open the asm file, search for the addresses in CallStack, and list
the corresponding function names. Generally, you only need to find
the functions corresponding to the first several stack information to
determine the direction of the abnormal code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Stack</span> <span class="mi">0</span> <span class="o">--</span> <span class="mi">4860</span><span class="n">d8</span> <span class="n">addr</span><span class="p">:</span><span class="n">f784c</span> <span class="o">--</span> <span class="n">WadRecvCB</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">1</span> <span class="o">--</span> <span class="mi">47</span><span class="n">b2b2</span> <span class="n">addr</span><span class="p">:</span><span class="n">f788c</span> <span class="o">--</span> <span class="n">wal_sdp_process_rx_data</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">2</span> <span class="o">--</span> <span class="mf">3e562</span><span class="n">c</span> <span class="n">addr</span><span class="p">:</span><span class="n">f789c</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">3</span> <span class="o">--</span> <span class="mi">4101</span><span class="n">de</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ac</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">4</span> <span class="o">--</span> <span class="mf">3e5</span><span class="n">f32</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78cc</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">5</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f78c0</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78ec</span>
<span class="n">Call</span> <span class="n">Stack</span> <span class="mi">6</span> <span class="o">--</span> <span class="mi">3</span><span class="n">f5e24</span> <span class="n">addr</span><span class="p">:</span><span class="n">f78fc</span>
</pre></div>
</div>
</li>
<li><p>Based on the preceding call stack information, it can be determined
that an exception occurs in the WadRecvCB function.</p>
<p><img alt="image1" src="../../_images/en-us_image_0000001054763554.png" /></p>
</li>
<li><p>Check and modify the code.</p></li>
</ol>
</div>
<div class="section" id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h2>
<p>After the sample code is compiled, burnt, run, and debugged, the
following information is displayed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ready to OS start
FileSystem mount ok.
wifi init success!
[DEMO] Hello world.
</pre></div>
</div>
</div>
<div class="section" id="follow-up-learning">
<h2>Follow-up Learning<a class="headerlink" href="#follow-up-learning" title="Permalink to this headline">¶</a></h2>
<p>Congratulations! You have finished the Hi3861 WLAN module quick start.
You can go on learning <a class="reference external" href="en-us_topic_0000001052854655.md">Cameras with a
Screen</a> in the next step.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/docs-en/quick-start/the-second-example-program-of-the-hi3861-development-board.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>