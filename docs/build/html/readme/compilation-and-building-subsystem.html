
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compilation and Building Subsystem &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="compilation-and-building-subsystem">
<h1>Compilation and Building Subsystem<a class="headerlink" href="#compilation-and-building-subsystem" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The compilation and building subsystem provides a compilation and
building framework based on GN and Ninja. Using this subsystem, you can
perform the following operations:</p>
<ol class="arabic simple">
<li><p>Build products with different chip platforms. For example, you can
build IP camera products on the Hi3518EV300 and Hi3516DV300
development boards and WLAN module product on the Hi3861 development
board.</p></li>
<li><p>Build a customized product generated by HPM configurations.</p></li>
</ol>
</div>
<div class="section" id="directory-structure">
<h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>build/lite                          # Compile and build a primary directory.
├── config                       # Compile related configuration items.
│   ├── boards                  # Define variables related to a development board, including its name, target architecture, and target CPU.
│   ├── component               # Define templates related to OpenHarmony components, including static libraries, dynamic libraries, extended components, and simulator libraries.
│   ├── kernel                  # Define compilation variables of OpenHarmony kernel and configuration parameters.
│   └── subsystem               # OpenHarmony subsystem lists
├── ndk                          # Define NDK-related compilation scripts and configuration parameters.
├── platform                     # Platform-related configuration files
│   ├── hi3516dv300_liteos_a    # HI3516DV300 and LiteOS_A platforms, including the platform full configuration table and boot file.
│   ├── hi3518ev300_liteos_a    # HI3518EV300 and LiteOS_A platforms, including the platform full configuration table and boot file.
│   └── hi3861v100_liteos_riscv # HI3861V100 and LiteOS_RISCV platforms, including the platform full configuration table and boot file.
├── product                      # Product full configuration table, including the configuration unit, subsystem list, and compiler
├── toolchain                    # Compilation toolchain, including the compiler path, compilation options, and link options.
└── tools                         # Tools on which compilation and building depend, including mkfs.
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<p>You must preinstall GN and Ninja and add them to environment variables.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Compile an existing product.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compile the WLAN platform.</span>
<span class="n">python</span> <span class="n">build</span><span class="o">.</span><span class="n">py</span> <span class="n">wifiiot</span>

<span class="c1"># Compile the IP camera based on Hi3518EV300.</span>
<span class="n">python</span> <span class="n">build</span><span class="o">.</span><span class="n">py</span> <span class="n">ipcamera_hi3518ev300</span>

<span class="c1"># Compile the IP camera based on Hi3516DV300.</span>
<span class="n">python</span> <span class="n">build</span><span class="o">.</span><span class="n">py</span> <span class="n">ipcamera_hi3516dv300</span>
</pre></div>
</div>
<ul>
<li><p>Compile components.</p>
<p>This section uses a customized component as an example to describe
how to compile a component, a library, and an executable file.</p>
<p>The example component consists of two functions: <strong>feature1</strong> and
<strong>feature2</strong>. <strong>feature1</strong> is a dynamic library, and <strong>feature2</strong> is
an executable file.</p>
<p>The complete directory structure of the example component is as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>example                        # Customized component
├── BUILD.gn                # GN script of a customized component. BUILD.gn is a fixed name.
├── feature1                # Customized unit 1
│   ├── BUILD.gn           # GN script of the customized unit 1. BUILD.gn is a fixed name.
│   ├── include            # Header file folder
│   │   └── helloworld1.h # Header file 1
│   └── src                # Source file folder
│       └── helloworld1.c  # Source file 1
├── feature2                # Customized unit 2
│   ├── BUILD.gn           # GN script of the customized unit 2. BUILD.gn is a fixed name.
│   ├── include            # Header file folder
│   │   └── helloworld2.h # Header file 2
│   └── src                # Source file folder
│       └── helloworld2.c  # Source file 2
├── build.sh                # build.sh script of the customized component, which is optional
└── Makefile                # Makefile script of the customized component, which is optional
</pre></div>
</div>
<p>Step 1: Compile the <strong>BUILD.gn</strong> script of a dynamic library in the
<strong>example/feature1</strong> directory.</p>
<p>The <strong>lite_library</strong> template can be used to compile dynamic and
static libraries. The following is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example of compiling the helloworld dynamic library</span>
<span class="c1"># Build.gn file of helloworld</span>
<span class="n">lite_library</span><span class="p">(</span><span class="s2">&quot;helloworld_lib&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;shared_library&quot;</span> <span class="c1"># Compile a dynamic library.</span>
    <span class="c1">#target_type = &quot;static_library&quot; # Compile a static library.</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;src/helloworld1.c&quot;</span>
    <span class="p">]</span>
    <span class="n">include_dirs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;include&quot;</span><span class="p">,</span>
        <span class="s2">&quot;../feature2_example/include&quot;</span> <span class="c1"># If feature2_example is required, add it to this include.</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Step 2: Compile the <strong>BUILD.gn</strong> script of an executable file in the
<strong>example/feature2</strong> directory.</p>
<p>The executable template provided by GN can be used to compile an
executable file. The following is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compile the executable .bin file.</span>
<span class="n">executable</span><span class="p">(</span><span class="s2">&quot;hello_world_bin&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;src/helloworld.c&quot;</span>
    <span class="p">]</span>
    <span class="n">include_dirs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;include&quot;</span><span class="p">,</span>
        <span class="c1">#&quot;../feature2_example/include&quot; # If feature2_example is required, add it to this include.</span>
    <span class="p">]</span>
    <span class="c1"># If feature1_example is required, add it to this deps.</span>
    <span class="c1">#deps = [</span>
    <span class="c1">#    &quot;../feature1_example:helloworld1&quot;</span>
    <span class="c1">#]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Step 3: Compile the <strong>BUILD.gn</strong> script of a component in the
<strong>example/BUILD.gn</strong> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">import</span><span class="p">(</span><span class="s2">&quot;//build/lite/config/component/lite_component.gni&quot;</span><span class="p">)</span>
<span class="c1"># Use the BUILD.gn script to compile the entire project.</span>
<span class="n">lite_component</span><span class="p">(</span><span class="s2">&quot;example_gn&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;feature_example1:helloworld_lib&quot;</span><span class="p">,</span>
        <span class="s2">&quot;feature_example2:hello_world_bin&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">}</span>
<span class="c1"># Integrate the built-in build.sh or Makefile project and use the gn script to call the hybrid compilation.</span>
<span class="n">build_ext_component</span><span class="p">(</span><span class="s2">&quot;example_mk&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">exec_path</span> <span class="o">=</span> <span class="n">rebase_path</span><span class="p">(</span><span class="n">rebase_path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">root_build_dir</span><span class="p">))</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">rebase_path</span><span class="p">(</span><span class="n">get_path_info</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;out_dir&quot;</span><span class="p">))</span>
    <span class="n">prebuilts</span> <span class="o">=</span> <span class="s2">&quot;sh build.sh&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;make clean &amp;&amp; make&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Available compilation and building variables</p>
<p>The variables that can be referenced globally are defined in
<strong>//build/lite/ohos_var.gni</strong>.</p>
<p><a class="reference external" href="#table3296103714372">Table 1</a> describes the common variables of
users.</p>
<p><strong>Table 1</strong></p>
<table><thead align="left"><tr id="row529623712377"><th class="cellrowborder" valign="top" width="16.89%" id="mcps1.2.4.1.1"><p id="p1629723723717"><p>Variable</p>
</p></th><th class="cellrowborder" valign="top" width="32.98%" id="mcps1.2.4.1.2"><p id="p13297137163720"><p>Value Range</p>
</p></th><th class="cellrowborder" valign="top" width="50.129999999999995%" id="mcps1.2.4.1.3"><p id="p1423425618374"><p>Description</p>
</p></th></tr></thead><tbody><tr id="row14297437193710"><td class="cellrowborder" valign="top" width="16.89%" headers="mcps1.2.4.1.1 "><p id="p62978371374"><p>ohos_kernel_type</p>
</p></td><td class="cellrowborder" valign="top" width="32.98%" headers="mcps1.2.4.1.2 "><p id="p1229716378376"><p>“liteos_a”, “liteos_riscv”</p>
</p></td><td class="cellrowborder" valign="top" width="50.129999999999995%" headers="mcps1.2.4.1.3 "><p id="p17234105673718"><p>Kernel type</p>
</p></td></tr><tr id="row8722028184617"><td class="cellrowborder" valign="top" width="16.89%" headers="mcps1.2.4.1.1 "><p id="p773182820463"><p>board_name</p>
</p></td><td class="cellrowborder" valign="top" width="32.98%" headers="mcps1.2.4.1.2 "><p id="p20731128124612"><p>“hi3516dv300”, “hi3518ev300”, “hi3861v100”</p>
</p></td><td class="cellrowborder" valign="top" width="50.129999999999995%" headers="mcps1.2.4.1.3 "><p id="p2737281461"><p>Development board type</p>
</p></td></tr><tr id="row1813718203473"><td class="cellrowborder" valign="top" width="16.89%" headers="mcps1.2.4.1.1 "><p id="p1813715200473"><p>ohos_build_compiler</p>
</p></td><td class="cellrowborder" valign="top" width="32.98%" headers="mcps1.2.4.1.2 "><p id="p1913713206476"><p>“gcc”, “clang”</p>
</p></td><td class="cellrowborder" valign="top" width="50.129999999999995%" headers="mcps1.2.4.1.3 "><p id="p013732013476"><p>Compilation toolchain type</p>
</p></td></tr></tbody></table><p>Example: Ohos_kernel_type usage,
component_example/feature2_example/BUILD.gn</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lite_library</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ohos_kernel_type</span> <span class="o">==</span> <span class="s2">&quot;liteos_a&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;shared_library&quot;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ohos_kernel_type</span> <span class="o">==</span> <span class="s2">&quot;liteos_riscv&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;static_library&quot;</span>
    <span class="p">}</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;src/helloworld1.c&quot;</span>
    <span class="p">]</span>
    <span class="n">include_dirs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;include&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Solution</p>
<p>After a template is downloaded from HPM, the customized full template
is stored in the <strong>//build/lite/product</strong> directory.</p>
<p>For example, ipcamera_hi3516dv300.json. This file that contains the
configurations of all customized subsystems and components is read.</p>
</li>
<li><p>Compilation output</p>
<p>All files generated during compilation are stored in the <strong>out</strong>
directory.</p>
<p>In the directory where the code is located, run <strong>python build.py
wifiiot</strong>. After the WLAN compilation is complete, the following
results are generated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>out/
└── wifiiot                                   # Product name
    ├── args.gn                               # Customized variable for gn compilation
    ├── build.log                             # Compilation log
    ├── build.ninja
    ├── build.ninja.d
    ├── gen
    ├── Hi3861_boot_signed_B.bin              # Signed bootloader backup file
    ├── Hi3861_boot_signed.bin                # Signed bootloader file
    ├── Hi3861_loader_signed.bin              # Loading file used by the burning tool
    ├── Hi3861_wifiiot_app_allinone.bin       # Production line tool burning file, including the independent burning program and loader program
    ├── Hi3861_wifiiot_app.asm                # Kernel asm file
    ├── Hi3861_wifiiot_app_burn.bin           # Burning file
    ├── Hi3861_wifiiot_app_flash_boot_ota.bin # Flash boot upgrade file
    ├── Hi3861_wifiiot_app.map               # Kernel map file
    ├── Hi3861_wifiiot_app_ota.bin           # Kernel upgrade file
    ├── Hi3861_wifiiot_app.out               # Kernel output file
    ├── Hi3861_wifiiot_app_vercfg.bin         # The boot and kernel version numbers are configured for secure boot to prevent version rollback.
    ├── libs                                  # Library folder
    ├── NOTICE_FILE
    ├── obj
    ├── suites
    └── toolchain.ninja
Note: You are advised to use Hi3861_wifiiot_app_allinone.bin to burn files.
</pre></div>
</div>
</li>
</ul>
<p>Run <strong>python build.py ipcamera_hi3518ev300</strong>. After IP
camera_HI3518EV300 is compiled, the following result is generated (the
same as IP camera_HI3516DV300).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>out/
└── ipcamera_hi3518ev300                # Product name
    ├── args.gn                         # Customized variable for gn compilation
    ├── bin                             # Link to the folder where the bin file is located.
    ├── bm_tool.map                     # map file
    ├── build.log                      # Compilation log
    ├── build.ninja
    ├── build.ninja.d
    ├── bundle_daemon_tool.map          # map file
    ├── data                            # Configuration file of underlying resources on which the media camera depends.
    ├── dev_tools                       # R&amp;D self-testing
    ├── foundation.map                  # map file
    ├── gen
    ├── libaudio_api.so
    ├── libs                            # Library files contained in an image
    ├── liteos.bin                      # bin file of the LiteOS basic kernel
    ├── media_server.map                # map file
    ├── NOTICE_FILE
    ├── obj                             # Binary file, which is the compilation result folder
    ├── OHOS_Image                      # .bin file for the LiteOS package without strip
    ├── OHOS_Image.asm                  # Assembly code
    ├── OHOS_Image.bin                  # Burning the .bin file for the LiteOS package
    ├── OHOS_Image.map                  # map file
    ├── rootfs.img                      # Compiled library and app image
    ├── rootfs.tar                      # Compress rootfs.tar.
    ├── suites                          # xts compilation result
    ├── test                            # Test case compilation result
    ├── toolchain.ninja
    ├── userfs                          # User-readable and writable partition
    ├── userfs.img                      # User-readable and writable partition in .img format, corresponding to the /storage directory after startup
    └── vendor                          # Firmware file and configuration file of the chip
</pre></div>
</div>
</div>
<div class="section" id="repositories-involved">
<h2>Repositories Involved<a class="headerlink" href="#repositories-involved" title="Permalink to this headline">¶</a></h2>
<p>build_lite</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/readme/compilation-and-building-subsystem.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>