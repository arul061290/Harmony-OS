
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Security Subsystem &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="security-subsystem">
<h1>Security Subsystem<a class="headerlink" href="#security-subsystem" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section provides samples about how to use existing security
mechanisms to improve system security features, including secure boot,
application permission management, inter-process communication (IPC)
authentication, Huawei Universal Keystore Service (HUKS), HiChain, and
application signature verification.</p>
</div>
<div class="section" id="directory-structure">
<h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>security
├── framework
│     ├── appverify    Application signature verification
│     ├── crypto_lite    Encryption and decryption
│     ├── hichainsdk_lite    Device authentication
│     ├── huks_lite    Key and certificate management
│     ├── secure_os    Secure OS
├── interface    Interface directory
│     ├── innerkits    Internal kit directory
│     │     ├── appverify    Application signature verification
│     │     ├── crypto_lite    Encryption and decryption
│     │     ├── hichainsdk_lite    Device authentication
│     │     ├── huks_lite    Key and certificate management
│     │     ├── iam_lite    Application permission management
│     │     ├── secure_os    Secure OS
│     ├── kits    External kit directory
│     │     ├── iam_lite    Application permission management
├── services    Implementation
│     ├── iam_lite    Application permission management
│     ├── secure_os    Secure OS
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<p>C programming language is used. The preceding security features are
mainly used on Cortex-A or devices with equivalent processing
capabilities. On Cortex-M or devices with equivalent processing
capabilities, only HUKS and HiChain are available.</p>
</div>
<div class="section" id="secure-boot">
<h2>Secure Boot<a class="headerlink" href="#secure-boot" title="Permalink to this headline">¶</a></h2>
<p>To generate a x509 image package, perform compilation to generate the
required binary images, including kernel images <strong>kernel.bin</strong>
(liteos/OHOS_Image) and <strong>rootfs.img</strong>. If the Hi3516DV300 chip is used,
the generated images are stored in the
<strong>outipcamera_hi3516dv300_liteos_a</strong> directory. Copy the binary images
and the secure uboot private keys (in the
<strong>vendorhisihi35xxhi3516dv300ubootsecureboot_release</strong> directory)
to the <strong>secureboot_ohos</strong> directory (in the
<strong>vendorhisihi35xxhi3516dv300uboot</strong> directory). Go to the
<strong>x509_creater</strong> directory, run the <strong>./creater.sh</strong> command, and
generate the x509 certificate as prompted. Return to the
<strong>secureboot_ohos</strong> directory and run <strong>./sec_os.sh</strong> to generate the
x509 image package.</p>
</div>
<div class="section" id="application-permission-management">
<h2>Application Permission Management<a class="headerlink" href="#application-permission-management" title="Permalink to this headline">¶</a></h2>
<p>Application permissions are used to control access to system resources
and features related to personal privacy, for example, accessing
hardware features of personal devices such as cameras and microphones,
and reading and writing media files. The OS protects such data and
features through application permission management.</p>
<p>The following table describes fields in a permission.</p>
<table><thead align="left"><tr id="row11107193541417"><th class="cellrowborder" valign="top" width="22.220000000000002%" id="mcps1.1.4.1.1"><p id="p6107535141420"><p>Field</p>
</p></th><th class="cellrowborder" valign="top" width="35.099999999999994%" id="mcps1.1.4.1.2"><p id="p111080352143"><p>Value</p>
</p></th><th class="cellrowborder" valign="top" width="42.68%" id="mcps1.1.4.1.3"><p id="p161080358141"><p>Description</p>
</p></th></tr></thead><tbody><tr id="row151081735111418"><td class="cellrowborder" valign="top" width="22.220000000000002%" headers="mcps1.1.4.1.1 "><p id="p1108193521417"><p>name</p>
</p></td><td class="cellrowborder" valign="top" width="35.099999999999994%" headers="mcps1.1.4.1.2 "><p id="p131081435151413"><p>String</p>
</p></td><td class="cellrowborder" valign="top" width="42.68%" headers="mcps1.1.4.1.3 "><p id="p0108235141411"><p>Permission name</p>
</p></td></tr><tr id="row19108143516148"><td class="cellrowborder" valign="top" width="22.220000000000002%" headers="mcps1.1.4.1.1 "><p id="p51081355145"><p>reason</p>
</p></td><td class="cellrowborder" valign="top" width="35.099999999999994%" headers="mcps1.1.4.1.2 "><p id="p01082358147"><p>Multi-language string ID</p>
</p></td><td class="cellrowborder" valign="top" width="42.68%" headers="mcps1.1.4.1.3 "><p id="p191081235171414"><p>Purpose of requesting the permission.</p>
</p></td></tr><tr id="row13108123516145"><td class="cellrowborder" valign="top" width="22.220000000000002%" headers="mcps1.1.4.1.1 "><p id="p18109835101415"><p>used-scene{</p>
</p><p id="p910913358146"><p>ability,</p>
</p><p id="p11109235181420"><p>when</p>
</p><p id="p16109193531417"><p>}</p>
</p></td><td class="cellrowborder" valign="top" width="35.099999999999994%" headers="mcps1.1.4.1.2 "><p id="p4109123511420"><p>ability: string of the component class name</p>
</p><p id="p19109133531410"><p>when: inuse and always</p>
</p></td><td class="cellrowborder" valign="top" width="42.68%" headers="mcps1.1.4.1.3 "><p id="p31091835151413"><p>Scene where the APIs controlled by this permission are called.</p>
</p><p id="p93361156407"><p>This field declares what components can call the APIs controlled by this
permission in the specified scene (foreground/background).</p>
</p></td></tr></tbody></table></div>
<div class="section" id="ipc-authentication">
<h2>IPC Authentication<a class="headerlink" href="#ipc-authentication" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>If system services registered with Samgr provide APIs for other
processes to access the services through IPC, access control policies
must be configured; otherwise, access to the system services will be
denied.</p></li>
<li><p>You can configure access control policies in
<strong>base/security/services/iam_lite/ipc_auth/include/policy_preset.h</strong>.</p>
<ol class="arabic simple">
<li><p>Define the policies for each feature.</p></li>
<li><p>Add the feature policies to the global policy.</p></li>
</ol>
</li>
</ul>
<p>For example, to configure an access policy for the BMS service, whose
service registered with Samgr is <strong>bundlems</strong> and whose registered
feature is <strong>BmsFeature</strong>, perform the following operations:</p>
<ol class="arabic simple">
<li><p>Define feature policies. You can configure multiple features and
configure multiple access policies for each feature.</p></li>
</ol>
<p><strong>Figure 1</strong> Example feature policy</p>
<p><img alt="image1" src="../_images/bms策略举例.png" /></p>
<p>There are three types of access policies:</p>
<p><strong>Figure 2</strong> Access policy structure</p>
<p><img alt="image2" src="../_images/策略类型2.png" /></p>
<ul class="simple">
<li><p><strong>RANGE</strong>: Processes with a UID within a specified range are allowed
to access <strong>BmsFeature</strong>. <strong>uidMin</strong> and <strong>uidMax</strong> need to be
specified.</p></li>
<li><p><strong>FIXED</strong>: Processes with specified UIDs are allowed to access
<strong>BmsFeature</strong>. <strong>fixedUid</strong> needs to be specified. A maximum number
of eight UIDs can be configured.</p></li>
<li><p><strong>BUNDLENAME</strong>: Only a specified application is allowed to access
<strong>BmsFeature</strong>. <strong>bundleName</strong> needs to be specified.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Add the defined feature policies to the global policy. You need to
configure the number of features.</p></li>
</ol>
<p><strong>Figure 3</strong> Registering a feature policy</p>
<p><img alt="image3" src="../_images/全局策略2.png" /></p>
<p>UID allocation rules:</p>
<ol class="arabic simple">
<li><p>Init process: 0</p></li>
</ol>
<p>appspawn process: 1</p>
<p>Shell process: 2</p>
<ol class="arabic simple" start="4">
<li><p>Other built-in system services: less than or equal to 99</p></li>
<li><p>System applications (such as settings, home screen, and camera):
100–999</p></li>
<li><p>Preset applications: 1000–9999</p></li>
<li><p>Common third-party applications: 10000 to <strong>INT_MAX</strong></p></li>
</ol>
</div>
<div class="section" id="huks">
<h2>HUKS<a class="headerlink" href="#huks" title="Permalink to this headline">¶</a></h2>
<p>In distributed scenarios, trust relationships need to be established
between devices with varied hardware capabilities and system
environments. A typical application is HiChain for trusted
interconnection between devices. In this case, a unified key management
service is required to ensure consistent APIs and key data formats, and
provide industry-standard encryption/decryption algorithms. HUKS is such
a service that provides unified key management and
encryption/decryption.</p>
<p>HUKS consists of native APIs, the hardware abstraction layer (HAL), and
Core Module.</p>
<ol class="arabic simple">
<li><p>Native APIs are implemented using the C language to ensure
consistency among all devices, and include the APIs for key
generation, encryption, and decryption.</p></li>
<li><p>Core Module depends on the HAL and provides core functions such as
encryption and decryption, signature verification, and key storage.</p></li>
<li><p>HAL shields differences between hardware and OSs and defines the
unified APIs for HUKS. It contains platform algoIOrithm libraries,
file systems, and logs.</p></li>
</ol>
</div>
<div class="section" id="hichain">
<h2>HiChain<a class="headerlink" href="#hichain" title="Permalink to this headline">¶</a></h2>
<p><strong>Device Interconnection Security</strong></p>
<p>To transmit user data securely between devices, ensure that the devices
are trusted by each other. A trust relationship and a secure data
transmission channel must be established between the devices. This
section describes how an IoT controller and IoT device establish a trust
relationship.</p>
<p><img alt="image4" src="../_images/en-us_image_0000001052584330.png" /></p>
<ul class="simple">
<li><p><strong>IoT device interconnection security</strong></p></li>
</ul>
<p>A trust relationship can be established between an IoT device that runs
OpenHarmony (such as the AI speaker, smart home device, and wearable
device) and an IoT controller (such as the smartphone and tablet).
Encrypted user data can be transmitted between the IoT device and IoT
controller through a secure connection.</p>
<ul class="simple">
<li><p><strong>IoT service identifier of the IoT controller</strong></p></li>
</ul>
<p>An IoT controller generates different identifiers for different IoT
device management services to isolate these services. The identifier can
be used for authentication and communication between an IoT controller
and an IoT device. It is an Ed25519 public/private key pair generated
using the elliptic curve cryptography.</p>
<ul class="simple">
<li><p><strong>IoT device identifier</strong></p></li>
</ul>
<p>An IoT device can generate its own device identifier for communicating
with the IoT controller. It is also an Ed25519 public/private key pair
generated using elliptic curve cryptography, with the private key stored
on the IoT device. Each time the device is restored to factory settings,
the public/private key pair will be reset.</p>
<p>The identifier can be used for secure communication between the IoT
controller and IoT device. After the devices exchange the service
identifier or device identifier, they can negotiate the key and
establish a secure communication channel.</p>
<ul class="simple">
<li><p><strong>P2P trusted binding between devices</strong></p></li>
</ul>
<p>When an IoT controller and an IOT device establish a trust relationship,
they exchange identifiers.</p>
<p>During this process, the user needs to enter or scan the PIN provided by
the IoT device on the IoT controller. PIN is either dynamically
generated if the IoT device has a screen, or preset by the manufacturer
if it does not have a screen. A PIN can be a number or a QR code. Then
the IoT controller and IoT device perform authentication and session key
exchange based on password authenticated key exchange (PAKE), and use
the session key to encrypt the channel for exchanging identity public
keys.</p>
<p><strong>Secure communication between the IoT controller and IoT device</strong></p>
<p>When an IoT controller and an IoT device communicate with each other
after establishing a trust relationship, they authenticate each other by
using the locally stored identity public key of the peer. Bidirectional
identity authentication and session key exchange are performed using the
Station-to-Station (STS) protocol during each communication. The session
key is used to encrypt the data transmission channel between the
devices.</p>
</div>
<div class="section" id="application-signature-verification">
<h2>Application Signature Verification<a class="headerlink" href="#application-signature-verification" title="Permalink to this headline">¶</a></h2>
<p>To ensure the integrity of application content, OpenHarmony uses
application signatures and profiles to manage application sources. Only
pre-installed applications and applications from HUAWEI AppGallery can
be installed on devices.</p>
<p><strong>Basic Concepts</strong></p>
<ul class="simple">
<li><p><strong>Developer certificate</strong></p></li>
</ul>
<p>Identity digital certificate of a developer, which is used to sign local
debugging software</p>
<ul class="simple">
<li><p><strong>Application debugging profile</strong></p></li>
</ul>
<p>Application debugging authorization file that allows you to install and
debug an application on a specified device</p>
<ul class="simple">
<li><p><strong>Application publishing certificate</strong></p></li>
</ul>
<p>Identity digital certificate of an application publisher, which is used
to sign an application to be published or preset</p>
<ul class="simple">
<li><p><strong>Application publishing profile</strong></p></li>
</ul>
<p>Description file of an application, which is used for reviewing an
application to be published or preset</p>
<ul class="simple">
<li><p><strong>APPID</strong></p></li>
</ul>
<p>Unique identifier of an application, which consists of the application
bundle name and the public key of the application publishing certificate</p>
<p><strong>How Application Signature Verification Works</strong></p>
<ol class="arabic simple">
<li><p>Apply for becoming an authorized application developer on HUAWEI
AppGallery.</p></li>
<li><p>Install and debug an application on a specified device.</p></li>
<li><p>Publish the application.</p></li>
</ol>
</div>
<div class="section" id="signature-of-an-application-published-on-huawei-appgallery">
<h2><strong>Signature of an Application Published on HUAWEI AppGallery</strong><a class="headerlink" href="#signature-of-an-application-published-on-huawei-appgallery" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Application debugging scenario</strong></p></li>
</ul>
<p>To develop and debug applications for OpenHarmony devices, you need to
apply for becoming an authorized application developer on HUAWEI
AppGallery. You need to generate a public/private key pair and upload
the public key to HUAWEI AppGallery. HUAWEI AppGallery creates a
developer certificate based on your identity information and the
uploaded public key, and issues the certificate through the developer
certificate CA. You also need to upload the application information and
debugging device ID for creating an application debugging profile, which
contains the HUAWEI AppGallery signature and cannot be tampered with.
Upon obtaining the developer certificate and application debugging
profile, you can install and debug applications signed with the private
key on a specified OpenHarmony device.</p>
<p>The application installation service of OpenHarmony verifies the
application signature to ensure application integrity. In addition, the
service verifies the developer certificate, application debugging
profile, and the mapping between them to ensure the validity of your
identity and the application.</p>
<p><img alt="image5" src="../_images/en-us_image_0000001051282241.png" /></p>
<ul class="simple">
<li><p><strong>Application publishing</strong></p></li>
</ul>
<p>To publish applications in HUAWEI AppGallery, you need to use the
application publishing certificate and profile issued by HUAWEI
AppGallery to sign the applications. As shown in the following figure,
the procedure of applying for the application publishing certificate and
profile is similar to that of applying for the developer certificate and
application debugging profile (you can use the same public/private key
pair). Applications signed by the application publishing certificate
cannot be directly installed on devices. Instead, the applications must
be published in HUAWEI AppGallery for review. After the applications are
reviewed and approved, HUAWEI AppGallery uses the publishing certificate
to re-sign the applications. The re-signed applications can be
downloaded and installed by users.</p>
<p>The application installation service of OpenHarmony verifies the
application signature to ensure application integrity. In addition, the
service checks whether the signature certificate is from HUAWEI
AppGallery to ensure that the application is trusted.</p>
<p><img alt="image6" src="../_images/en-us_image_0000001051562162.png" /></p>
</div>
<div class="section" id="repositories-involved">
<h2>Repositories Involved<a class="headerlink" href="#repositories-involved" title="Permalink to this headline">¶</a></h2>
<p>security_services_app_verify</p>
<p>security_frameworks_crypto_lite</p>
<p>security_services_hichainsdk_lite</p>
<p>security_services_huks_lite</p>
<p>security_frameworks_secure_os</p>
<p>security_interfaces_innerkits_hichainsdk_lite</p>
<p>security_interfaces_innerkits_iam_lite</p>
<p>security_interfaces_innerkits_huks_lite</p>
<p>security_interfaces_innerkits_app_verify</p>
<p>security_interfaces_innerkits_crypto_lite</p>
<p>security_interfaces_innerkits_secure_os</p>
<p>security_interfaces_kits_iam_lite</p>
<p>security_services_iam_lite</p>
<p>security_services_secure_os</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/readme/security-subsystem.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>