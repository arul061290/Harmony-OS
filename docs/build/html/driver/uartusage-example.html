
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UART Usage Example &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="uart-usage-example">
<h1>UART Usage Example<a class="headerlink" href="#uart-usage-example" title="Permalink to this headline">Â¶</a></h1>
<p>The following is a usage example of a UART device, including how to
obtain the UART device handle, set the baud rate, device attributes, and
transmission mode, read data from or write data into the UART device,
and then destroy the UART device handle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;hdf_log.h&quot;</span>
<span class="c1">#include &quot;uart_if.h&quot;</span>

<span class="n">void</span> <span class="n">UartTestSample</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">int32_t</span> <span class="n">ret</span><span class="p">;</span>
    <span class="n">uint32_t</span> <span class="n">port</span><span class="p">;</span>
    <span class="n">struct</span> <span class="n">DevHandle</span> <span class="o">*</span><span class="n">handle</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
    <span class="n">uint8_t</span> <span class="n">wbuff</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">};</span>
    <span class="n">uint8_t</span> <span class="n">rbuff</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">struct</span> <span class="n">UartAttribute</span> <span class="n">attribute</span><span class="p">;</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">dataBits</span> <span class="o">=</span> <span class="n">UART_ATTR_DATABIT_7</span><span class="p">;</span>   <span class="o">/*</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">data</span> <span class="n">bits</span> <span class="n">to</span> <span class="mf">7.</span> <span class="o">*/</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">parity</span> <span class="o">=</span> <span class="n">UART_ATTR_PARITY_NONE</span><span class="p">;</span>   <span class="o">/*</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">parity</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">no</span> <span class="n">parity</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">stopBits</span> <span class="o">=</span> <span class="n">UART_ATTR_STOPBIT_1</span><span class="p">;</span>   <span class="o">/*</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">stop</span> <span class="n">bit</span> <span class="n">to</span> <span class="mf">1.</span> <span class="o">*/</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">rts</span> <span class="o">=</span> <span class="n">UART_ATTR_RTS_DIS</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">Disable</span> <span class="n">the</span> <span class="n">RTS</span> <span class="n">signal</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">cts</span> <span class="o">=</span> <span class="n">UART_ATTR_CTS_DIS</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">Disable</span> <span class="n">the</span> <span class="n">CTS</span> <span class="n">signal</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">fifoRxEn</span> <span class="o">=</span> <span class="n">UART_ATTR_RX_FIFO_EN</span><span class="p">;</span>  <span class="o">/*</span> <span class="n">Enable</span> <span class="n">RX</span> <span class="n">FIFO</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">fifoTxEn</span> <span class="o">=</span> <span class="n">UART_ATTR_TX_FIFO_EN</span><span class="p">;</span>  <span class="o">/*</span> <span class="n">Enable</span> <span class="n">TX</span> <span class="n">FIFO</span><span class="o">.</span> <span class="o">*/</span>
    <span class="o">/*</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">port</span> <span class="n">number</span> <span class="n">actually</span> <span class="n">used</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="o">/*</span> <span class="n">Obtain</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">device</span> <span class="n">handle</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">UartOpen</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">handle</span> <span class="o">==</span> <span class="n">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HDF_LOGE</span><span class="p">(</span><span class="s2">&quot;UartOpen: failed!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">/*</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">baud</span> <span class="n">rate</span> <span class="n">to</span> <span class="mf">9600.</span> <span class="o">*/</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">UartSetBaud</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">9600</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HDF_LOGE</span><span class="p">(</span><span class="s2">&quot;UartSetBaud: failed, ret </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
        <span class="n">goto</span> <span class="n">_ERR</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">/*</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">device</span> <span class="n">attributes</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">UartSetAttribute</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attribute</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HDF_LOGE</span><span class="p">(</span><span class="s2">&quot;UartSetAttribute: failed, ret </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
        <span class="n">goto</span> <span class="n">_ERR</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">/*</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">transmission</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">non</span><span class="o">-</span><span class="n">blocking</span> <span class="n">mode</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">UartSetTransMode</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">UART_MODE_RD_NONBLOCK</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HDF_LOGE</span><span class="p">(</span><span class="s2">&quot;UartSetTransMode: failed, ret </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
        <span class="n">goto</span> <span class="n">_ERR</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">/*</span> <span class="n">Write</span> <span class="mi">5</span><span class="o">-</span><span class="n">byte</span> <span class="n">data</span> <span class="n">into</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">device</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">UartWrite</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">wbuff</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HDF_LOGE</span><span class="p">(</span><span class="s2">&quot;UartWrite: failed, ret </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
        <span class="n">goto</span> <span class="n">_ERR</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">/*</span> <span class="n">Read</span> <span class="mi">5</span><span class="o">-</span><span class="n">byte</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">UART</span> <span class="n">device</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">UartRead</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">rbuff</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HDF_LOGE</span><span class="p">(</span><span class="s2">&quot;UartRead: failed, ret </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
        <span class="n">goto</span> <span class="n">_ERR</span><span class="p">;</span>
    <span class="p">}</span>
<span class="n">_ERR</span><span class="p">:</span>
    <span class="o">/*</span> <span class="n">Destroy</span> <span class="n">the</span> <span class="n">UART</span> <span class="n">device</span> <span class="n">handle</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">UartClose</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/driver/uartusage-example.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>