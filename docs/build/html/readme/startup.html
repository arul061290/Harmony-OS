
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Startup &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="startup">
<h1>Startup<a class="headerlink" href="#startup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The startup subsystem is responsible for starting key system processes
and services after the kernel is started and before applications are
started. This subsystem has the following modules:</p>
<ul class="simple">
<li><p><strong>init</strong> for starting system service processes</p></li>
</ul>
<p>This module can be used on the Hi3516DV300 and Hi3518EV300 platforms
powered by LiteOS Cortex-A.</p>
<p>It starts system service processes from the time the kernel loads the
first user-space process to the time the first application program is
started. In addition to loading key system processes, the startup
subsystem needs to configure required permissions during the startup,
and keeps the specified process alive after sub-processes are started.
If a process exits abnormally, the startup subsystem needs to restart
it, and to perform system reset for a special process.</p>
<ul>
<li><p><strong>appspawn</strong> for spawning applications</p>
<p>This module can be used on the Hi3516DV300 and Hi3518EV300 platforms
powered by LiteOS Cortex-A.</p>
<p>It spawns application processes upon receiving commands from the
application framework, configures required permissions, and invokes
the entry of the application framework.</p>
</li>
<li><p><strong>bootstrap</strong> for starting service modules</p>
<p>This module can be used on the Hi3861 platform powered by LiteOS
Cortex-M.</p>
<p>It provides identifiers for starting services and functions. When the
SAMGR is started, the entry function identified by <strong>boostrap</strong> is
invoked and system services are started.</p>
</li>
<li><p><strong>Syspara</strong></p>
<p>This module can be used on the Hi3861, Hi3516DV300 and Hi3518EV300
platforms powered by LiteOS Cortex-M and LiteOS Cortex-A.</p>
<p>It obtains and sets system attributes for the operating system.</p>
<p>System attributes consist of default, OEM-specified, and custom
system attributes. OEM-specified system attributes provide only
default values. The specific values need to be adjusted as required.
For details, see <a class="reference external" href="#section674513182447">Usage</a>.</p>
</li>
</ul>
</div>
<div class="section" id="directory-structure">
<h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p><strong>Table 1</strong> Directory structure of the source code for the Startup
subsystem</p>
<table><thead align="left"><tr id="row7977610131417"><th class="cellrowborder" valign="top" width="19.439999999999998%" id="mcps1.2.4.1.1"><p id="p18792459121314"><p>Directory</p>
</p></th><th class="cellrowborder" valign="top" width="66.64%" id="mcps1.2.4.1.2"><p id="p77921459191317"><p>Description</p>
</p></th><th class="cellrowborder" valign="top" width="13.919999999999998%" id="mcps1.2.4.1.3"><p id="p101617019356"><p>Applicable Platform</p>
</p></th></tr></thead><tbody><tr id="row17977171010144"><td class="cellrowborder" valign="top" width="19.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p2793159171311"><p>base/startup/services/appspawn_lite</p>
</p></td><td class="cellrowborder" valign="top" width="66.64%" headers="mcps1.2.4.1.2 "><p id="p879375920132"><p>appspawn module for spawning application processes. It receives AMS
messages via lightweight IPC, parses the messages, starts application
processes based on the parsing result, and grants permissions to them.</p>
</p></td><td class="cellrowborder" valign="top" width="13.919999999999998%" headers="mcps1.2.4.1.3 "><p id="p63463619360"><p>Hi3516DV300</p>
</p><p id="p141611802359"><p>Hi3518EV300</p>
</p></td></tr><tr id="row6978161091412"><td class="cellrowborder" valign="top" width="19.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p37931659101311"><p>base/startup/services/bootstrap_lite</p>
</p></td><td class="cellrowborder" valign="top" width="66.64%" headers="mcps1.2.4.1.2 "><p id="p6793059171318"><p>bootstrap module for starting all services except core system services.</p>
</p></td><td class="cellrowborder" valign="top" width="13.919999999999998%" headers="mcps1.2.4.1.3 "><p id="p101610019353"><p>Hi3861</p>
</p></td></tr><tr id="row6978201031415"><td class="cellrowborder" align="left" valign="top" width="19.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p117935599130"><p>base/startup/services/init_lite</p>
</p></td><td class="cellrowborder" valign="top" width="66.64%" headers="mcps1.2.4.1.2 "><p id="p0793185971316"><p>init module for the init process, which is the first user-space process
loaded after the kernel is initialized. After the startup, the
configuration file in /etc/init.cfg is parsed. Based on the parsing
result, other key system processes are started and granted required
permissions.</p>
</p></td><td class="cellrowborder" valign="top" width="13.919999999999998%" headers="mcps1.2.4.1.3 "><p id="p2176757193619"><p>Hi3516DV300</p>
</p><p id="p51611013358"><p>Hi3518EV300</p>
</p></td></tr><tr id="row1897841071415"><td class="cellrowborder" valign="top" width="19.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p16793185961315"><p>base/startup/interfaces</p>
</p></td><td class="cellrowborder" valign="top" width="66.64%" headers="mcps1.2.4.1.2 "><p id="p20413161014013"><p>Open APIs provided by the bootstrap module. The main function directs
the calls to these APIs to start the service framework.</p>
</p></td><td class="cellrowborder" rowspan="2" valign="top" width="13.919999999999998%" headers="mcps1.2.4.1.3 "><p id="p1956516512380"><p>Hi3861</p>
</p><p id="p2670195353812"><p>Hi3516DV300</p>
</p><p id="p116118053518"><p>Hi3518EV300</p>
</p></td></tr><tr id="row178841725886"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p88841825887"><p>base/startup/frameworks/syspara_lite</p>
</p></td><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p98851625589"><p>syspara module. It provides APIs to obtain device information, including
the product name, brand name, category name, and manufacturer name.</p>
</p></td></tr></tbody></table><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>base
├──startup    Root directory of the startup subsystem
├──── frameworks
│     └── syspara_lite
│         ├── LICENSE     License file for open-source code
│         ├── parameter   Source files for the syspara module
│         │   ├── BUILD.gn
│         │   └── src
│         │       ├── BUILD.gn
│         │       ├── param_impl_hal     syspara module implemented based on LiteOS Cortex-M
│         │       └── param_impl_posix   syspara module implemented based on LiteOS Cortex-A
│         └── token
│             ├── BUILD.gn
│             └── src
│                 ├── token_impl_hal
│                 └── token_impl_posix
├──── hals
│     └── syspara_lite       Header files at the hardware abstraction layer of the syspara module
├──── interfaces
│     └── kits
│         └── syspara_lite   Open APIs related to the syspara module
└──── services
      ├── appspawn_lite    appspawn module
      │   ├── BUILD.gn    Compilation and configuration of the appspawn module
      │   ├── include     Header files for the appspawn module
      │   ├── LICENSE     License file for open-source code
      │   ├── moduletest  Self-testing code for the appspawn module
      │   └── src         Source files for the appspawn module
      ├── bootstrap_lite   bootstrap module
      │   ├── BUILD.gn    Compilation and configuration of the bootstrap module
      │   ├── LICENSE     License file for open-source code
      │   └── source      Source files for the bootstrap module
      └── init_lite       init module
           ├── BUILD.gn    Compilation and configuration of the init module
          ├── include     Header files for the init module
          ├── LICENSE     License file for open-source code
          ├── moduletest  Self-testing code for the init module
          └── src         Sources for the init module
vendor
└──huawei
        └──camera
                └──init_configs  Configuration file of the init module (in JSON format, in the /etc/ directory)
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The startup subsystem is developed using the C language.</p></li>
<li><p>OEM-specified system attributes provide only default values. The
specific values need to be adjusted as required.</p></li>
</ul>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Configuration file of the init module</p></li>
</ul>
<p>The configuration file <strong>init.cfg</strong> of the <strong>init</strong> module contains
service names, executable file paths, permissions, and other attributes
of all key system services that need to be started by the init process.
The file is stored in <strong>/vendor/huawei/camera/init_configs/</strong> under
<strong>/etc/</strong>. It is in JSON format, and its size cannot exceed 100 KB.</p>
<p>After the init process starts, it reads the <strong>/etc/init.cfg</strong> file,
parses the JSON content, and loads system services in sequence based on
the parsing result. The format and content of the configuration file are
described as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;jobs&quot;</span> <span class="p">:</span> <span class="p">[{</span>
            <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;pre-init&quot;</span><span class="p">,</span>      <span class="o">--------</span> <span class="n">Job</span> <span class="n">executed</span> <span class="n">before</span> <span class="n">the</span> <span class="n">initialization</span><span class="o">.</span> <span class="n">It</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">store</span> <span class="n">some</span> <span class="n">pre</span><span class="o">-</span><span class="n">operations</span> <span class="p">(</span><span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">creating</span> <span class="n">a</span> <span class="n">folder</span><span class="p">)</span> <span class="n">before</span> <span class="n">the</span> <span class="n">init</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">started</span><span class="o">.</span>
            <span class="s2">&quot;cmds&quot;</span> <span class="p">:</span> <span class="p">[</span>
                 <span class="s2">&quot;mkdir /testdir&quot;</span><span class="p">,</span>      <span class="o">--------</span> <span class="n">Command</span> <span class="k">for</span> <span class="n">creating</span> <span class="n">a</span> <span class="n">folder</span><span class="o">.</span> <span class="n">mkdir</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">target</span> <span class="n">folder</span> <span class="n">must</span> <span class="n">be</span> <span class="n">separated</span> <span class="n">by</span> <span class="n">only</span> <span class="n">one</span> <span class="n">space</span><span class="o">.</span>
                <span class="s2">&quot;chmod 0700 /testdir&quot;</span><span class="p">,</span> <span class="o">--------</span> <span class="n">Command</span> <span class="k">for</span> <span class="n">modifying</span> <span class="n">the</span> <span class="n">permission</span><span class="p">,</span> <span class="n">which</span> <span class="n">must</span> <span class="n">be</span> <span class="ow">in</span> <span class="n">the</span> <span class="mi">0</span><span class="n">xxxx</span> <span class="nb">format</span><span class="o">.</span> <span class="n">chmod</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">target</span> <span class="n">folder</span> <span class="n">must</span> <span class="n">be</span> <span class="n">separated</span> <span class="n">by</span> <span class="n">only</span> <span class="n">one</span> <span class="n">space</span><span class="o">.</span>
                <span class="s2">&quot;chown 99 99 /testdir&quot;</span><span class="p">,</span><span class="o">--------</span> <span class="n">Command</span> <span class="k">for</span> <span class="n">modifying</span> <span class="n">the</span> <span class="n">owner</span> <span class="n">group</span><span class="o">.</span> <span class="n">chown</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">target</span> <span class="n">folder</span> <span class="n">must</span> <span class="n">be</span> <span class="n">separated</span> <span class="n">by</span> <span class="n">only</span> <span class="n">one</span> <span class="n">space</span><span class="o">.</span>
                <span class="s2">&quot;mkdir /testdir2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mount vfat /dev/mmcblk0p0 /testdir2 noexec nosuid&quot;</span> <span class="o">--------</span> <span class="n">mount</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">following</span> <span class="nb">format</span><span class="p">:</span> <span class="n">mount</span> <span class="n">file</span> <span class="n">system</span> <span class="nb">type</span> <span class="n">source</span> <span class="n">target</span> <span class="n">flags</span> <span class="n">data</span>
                                                                    <span class="o">--------</span> <span class="n">flags</span> <span class="n">currently</span> <span class="n">supports</span> <span class="n">only</span> <span class="n">nodev</span><span class="p">,</span> <span class="n">noexec</span><span class="p">,</span> <span class="n">nosuid</span><span class="p">,</span> <span class="ow">and</span> <span class="n">rdonly</span><span class="p">,</span> <span class="n">which</span> <span class="n">are</span> <span class="n">separated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">space</span><span class="o">.</span>
            <span class="p">]</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;init&quot;</span><span class="p">,</span>          <span class="o">--------</span> <span class="n">Job</span> <span class="n">name</span> <span class="n">supported</span> <span class="n">by</span> <span class="n">the</span> <span class="n">init</span> <span class="n">process</span><span class="o">.</span> <span class="n">Ensure</span> <span class="n">that</span> <span class="n">an</span> <span class="n">extended</span> <span class="n">job</span> <span class="n">name</span> <span class="n">contains</span> <span class="n">a</span> <span class="n">maximum</span> <span class="n">of</span> <span class="mi">32</span> <span class="nb">bytes</span><span class="o">.</span>
            <span class="s2">&quot;cmds&quot;</span> <span class="p">:</span> <span class="p">[</span>                <span class="o">--------</span> <span class="n">Command</span> <span class="nb">set</span> <span class="n">supported</span> <span class="n">by</span> <span class="n">the</span> <span class="n">current</span> <span class="n">job</span><span class="o">.</span> <span class="n">Only</span> <span class="n">one</span> <span class="n">space</span> <span class="ow">is</span> <span class="n">allowed</span> <span class="n">between</span> <span class="n">the</span> <span class="n">command</span> <span class="n">name</span> <span class="p">(</span><span class="n">less</span> <span class="n">than</span> <span class="mi">10</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">following</span> <span class="n">parameter</span> <span class="p">(</span><span class="n">less</span> <span class="n">than</span> <span class="mi">32</span> <span class="nb">bytes</span><span class="p">)</span><span class="o">.</span>
                <span class="s2">&quot;start service1&quot;</span><span class="p">,</span>     <span class="o">--------</span> <span class="n">First</span> <span class="n">command</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">job</span>
                <span class="s2">&quot;start service2&quot;</span>      <span class="o">--------</span> <span class="n">Second</span> <span class="n">command</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">job</span> <span class="p">(</span><span class="n">You</span> <span class="n">can</span> <span class="n">adjust</span> <span class="n">the</span> <span class="n">sequence</span> <span class="n">of</span> <span class="n">commands</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">array</span> <span class="k">as</span> <span class="n">required</span><span class="o">.</span> <span class="n">The</span> <span class="n">init</span> <span class="n">process</span> <span class="n">executes</span> <span class="n">the</span> <span class="n">commands</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">order</span> <span class="k">as</span> <span class="n">they</span> <span class="n">are</span> <span class="n">parsed</span><span class="o">.</span><span class="p">)</span>
             <span class="p">]</span>
        <span class="p">},</span> <span class="p">{</span>
             <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;post-init&quot;</span><span class="p">,</span>    <span class="o">--------</span> <span class="n">Job</span> <span class="n">executed</span> <span class="n">after</span> <span class="n">the</span> <span class="n">initialization</span><span class="o">.</span> <span class="n">It</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">store</span> <span class="n">some</span> <span class="n">operations</span> <span class="n">performed</span> <span class="n">after</span> <span class="n">the</span> <span class="n">init</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">started</span><span class="o">.</span>
             <span class="s2">&quot;cmds&quot;</span> <span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;services&quot;</span> <span class="p">:</span> <span class="p">[{</span>                         <span class="o">--------</span> <span class="n">service</span> <span class="nb">set</span> <span class="p">(</span><span class="ow">in</span> <span class="n">an</span> <span class="n">array</span><span class="p">),</span> <span class="n">including</span> <span class="nb">all</span> <span class="n">system</span> <span class="n">services</span> <span class="n">that</span> <span class="n">need</span> <span class="n">to</span> <span class="n">be</span> <span class="n">started</span> <span class="n">by</span> <span class="n">the</span> <span class="n">init</span> <span class="n">process</span>
            <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;service1&quot;</span><span class="p">,</span>            <span class="o">--------</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">service</span><span class="o">.</span> <span class="n">A</span> <span class="n">maximum</span> <span class="n">of</span> <span class="mi">32</span> <span class="nb">bytes</span> <span class="n">must</span> <span class="n">be</span> <span class="n">specified</span> <span class="k">for</span> <span class="n">the</span> <span class="n">name</span><span class="o">.</span>
            <span class="s2">&quot;path&quot;</span> <span class="p">:</span> <span class="s2">&quot;/bin/process1&quot;</span>        <span class="o">--------</span> <span class="n">Full</span> <span class="n">path</span> <span class="n">of</span> <span class="n">the</span> <span class="n">executable</span> <span class="n">file</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">service</span><span class="o">.</span> <span class="n">A</span> <span class="n">maximum</span> <span class="n">of</span> <span class="mi">64</span> <span class="nb">bytes</span> <span class="n">must</span> <span class="n">be</span> <span class="n">specified</span> <span class="k">for</span> <span class="n">the</span> <span class="n">path</span><span class="o">.</span>
            <span class="s2">&quot;uid&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                      <span class="o">--------</span> <span class="n">UID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">service</span> <span class="n">process</span>
            <span class="s2">&quot;gid&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                      <span class="o">--------</span> <span class="n">GID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">service</span> <span class="n">process</span>
            <span class="s2">&quot;once&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                     <span class="o">--------</span> <span class="n">Whether</span> <span class="n">the</span> <span class="n">current</span> <span class="n">service</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">one</span><span class="o">-</span><span class="n">off</span> <span class="n">process</span>
                                                     <span class="mi">0</span> <span class="o">---</span> <span class="n">The</span> <span class="n">current</span> <span class="n">service</span> <span class="n">process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">one</span><span class="o">-</span><span class="n">off</span> <span class="n">process</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">process</span> <span class="n">exits</span> <span class="n">due</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">reason</span><span class="p">,</span> <span class="n">the</span> <span class="n">init</span> <span class="n">module</span> <span class="n">restarts</span> <span class="n">the</span> <span class="n">service</span> <span class="n">process</span> <span class="n">upon</span> <span class="n">receiving</span> <span class="n">the</span> <span class="n">SIGCHLD</span> <span class="n">signal</span><span class="o">.</span>
                                                   <span class="n">non</span><span class="o">-</span><span class="mi">0</span> <span class="o">---</span> <span class="n">The</span> <span class="n">current</span> <span class="n">service</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">one</span><span class="o">-</span><span class="n">off</span> <span class="n">process</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">process</span> <span class="n">exits</span> <span class="n">due</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">reason</span><span class="p">,</span> <span class="n">the</span> <span class="n">init</span> <span class="n">module</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">restart</span> <span class="n">the</span> <span class="n">service</span> <span class="n">process</span><span class="o">.</span>
            <span class="s2">&quot;importance&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>               <span class="o">--------</span> <span class="n">Whether</span> <span class="n">the</span> <span class="n">current</span> <span class="n">service</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">key</span> <span class="n">system</span> <span class="n">process</span>
                                                     <span class="mi">0</span> <span class="o">---</span> <span class="n">The</span> <span class="n">current</span> <span class="n">service</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">key</span> <span class="n">system</span> <span class="n">process</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">process</span> <span class="n">exits</span> <span class="n">due</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">reason</span><span class="p">,</span> <span class="n">the</span> <span class="n">init</span> <span class="n">module</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">system</span><span class="o">.</span>
                                                   <span class="n">non</span><span class="o">-</span><span class="mi">0</span> <span class="o">---</span> <span class="n">The</span> <span class="n">current</span> <span class="n">service</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">key</span> <span class="n">system</span> <span class="n">process</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">process</span> <span class="n">exits</span> <span class="n">due</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">reason</span><span class="p">,</span> <span class="n">the</span> <span class="n">init</span> <span class="n">module</span> <span class="n">resets</span> <span class="ow">and</span> <span class="n">restarts</span> <span class="n">the</span> <span class="n">system</span> <span class="n">upon</span> <span class="n">receiving</span> <span class="n">the</span> <span class="n">SIGCHLD</span> <span class="n">signal</span><span class="o">.</span>
            <span class="s2">&quot;caps&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>           <span class="o">--------</span> <span class="n">Capabilities</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">current</span> <span class="n">service</span><span class="o">.</span> <span class="n">They</span> <span class="n">are</span> <span class="n">evaluated</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">capabilities</span> <span class="n">supported</span> <span class="n">by</span> <span class="n">the</span> <span class="n">security</span> <span class="n">subsystem</span> <span class="ow">and</span> <span class="n">configured</span> <span class="ow">in</span> <span class="n">accordance</span> <span class="k">with</span> <span class="n">the</span> <span class="n">principle</span> <span class="n">of</span> <span class="n">least</span> <span class="n">permission</span><span class="o">.</span>
    <span class="p">},</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;service2&quot;</span><span class="p">,</span>            <span class="o">--------</span> <span class="n">Next</span> <span class="n">service</span> <span class="n">that</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">be</span> <span class="n">started</span> <span class="n">by</span> <span class="n">the</span> <span class="n">init</span> <span class="n">module</span><span class="o">.</span> <span class="n">The</span> <span class="n">service</span> <span class="n">sequence</span> <span class="ow">is</span> <span class="n">irrelevant</span> <span class="n">to</span> <span class="n">the</span> <span class="n">startup</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">the</span> <span class="n">cmd</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">job</span><span class="o">.</span>
            <span class="s2">&quot;path&quot;</span> <span class="p">:</span> <span class="s2">&quot;/bin/process2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uid&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;gid&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;once&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;importance&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;caps&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Table 2</strong> Supported commands</p>
<table><thead align="left"><tr id="row5623144194017"><th class="cellrowborder" valign="top" width="12.5%" id="mcps1.2.4.1.1"><p id="p56231449404"><p>Name</p>
</p></th><th class="cellrowborder" valign="top" width="31.05%" id="mcps1.2.4.1.2"><p id="p962313447401"><p>Syntax</p>
</p></th><th class="cellrowborder" valign="top" width="56.45%" id="mcps1.2.4.1.3"><p id="p88724434113"><p>Description</p>
</p></th></tr></thead><tbody><tr id="row962344416405"><td class="cellrowborder" valign="top" width="12.5%" headers="mcps1.2.4.1.1 "><p id="p66231144104011"><p>start</p>
</p></td><td class="cellrowborder" valign="top" width="31.05%" headers="mcps1.2.4.1.2 "><p id="p9607551369"><p>start ServiceName</p>
</p><p id="p862384484010"><p>Only one space is allowed.</p>
</p></td><td class="cellrowborder" valign="top" width="56.45%" headers="mcps1.2.4.1.3 "><p id="p17872104184113"><p>Starts a service. The service name must be the same as that in the
services array in the file.</p>
</p></td></tr><tr id="row962311443404"><td class="cellrowborder" valign="top" width="12.5%" headers="mcps1.2.4.1.1 "><p id="p13837142094117"><p>mkdir</p>
</p></td><td class="cellrowborder" valign="top" width="31.05%" headers="mcps1.2.4.1.2 "><p id="p637613010714"><p>mkdir /xxxx/xxx</p>
</p><p id="p2624244204019"><p>Only one space is allowed.</p>
</p></td><td class="cellrowborder" valign="top" width="56.45%" headers="mcps1.2.4.1.3 "><p id="p158722484112"><p>Creates a directory.</p>
</p></td></tr><tr id="row662404414406"><td class="cellrowborder" valign="top" width="12.5%" headers="mcps1.2.4.1.1 "><p id="p3624444154011"><p>chmod</p>
</p></td><td class="cellrowborder" valign="top" width="31.05%" headers="mcps1.2.4.1.2 "><p id="p68331741271"><p>chmod 0xxx /xxx/xx</p>
</p><p id="p7624344134020"><p>Only one space is allowed.</p>
</p></td><td class="cellrowborder" valign="top" width="56.45%" headers="mcps1.2.4.1.3 "><p id="p18872945418"><p>Changes the permission. The permission value must be in 0xxx format, for
example, 0755 and 0600. This configuration must comply with the
principle of least permission.</p>
</p></td></tr><tr id="row1462404494017"><td class="cellrowborder" valign="top" width="12.5%" headers="mcps1.2.4.1.1 "><p id="p136241144144013"><p>chown</p>
</p></td><td class="cellrowborder" valign="top" width="31.05%" headers="mcps1.2.4.1.2 "><p id="p84976100714"><p>chown uid gid /xxx/xx</p>
</p><p id="p1624144194011"><p>Only one space is allowed.</p>
</p></td><td class="cellrowborder" valign="top" width="56.45%" headers="mcps1.2.4.1.3 "><p id="p9872246417"><p>Changes the owner group.</p>
</p></td></tr><tr id="row1285512468412"><td class="cellrowborder" valign="top" width="12.5%" headers="mcps1.2.4.1.1 "><p id="p1385515468413"><p>mount</p>
</p></td><td class="cellrowborder" valign="top" width="31.05%" headers="mcps1.2.4.1.2 "><p id="p358535124815"><p>mount fileSysType source target flags data</p>
</p><p id="p178550463412"><p>Only one space is allowed.</p>
</p></td><td class="cellrowborder" valign="top" width="56.45%" headers="mcps1.2.4.1.3 "><p id="p1085544611415"><p>Mounts data. Currently, flags supports only nodev, noexec, nosuid, and
rdonly, and other strings are considered as data.</p>
</p></td></tr></tbody></table><p>It is worth noting that the modified <strong>init.cfg</strong> file must be in JSON
format. Otherwise, the init process fails to parse the file, and no
service will be started. The configured service permission
<strong>uid/gid/capability</strong> must meet the requirements imposed by the
security subsystem and comply with the principle of least permission. In
addition, if the values of <strong>once</strong> and <strong>importance</strong> of a service are
both <strong>0</strong> and the service exits for more than four consecutive times
within four minutes, the init process will stop restarting the service.</p>
<ul>
<li><p>System parameters</p>
<ul class="simple">
<li><p>OEM-specific system attributes</p></li>
</ul>
<p>For Hi3516DV300 and Hi3518EV300 development boards, you need to
modify the source files in the
<strong>vendor/huawei/camera/hals/utils/sys_param</strong> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_PRODUCT_TYPE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_MANUFACTURE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_BRAND</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_MARKET_NAME</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_PRODUCT_SERIES</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_PRODUCT_MODEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_SOFTWARE_MODEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_HARDWARE_MODEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_HARDWARE_PROFILE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;aout:true,display:true&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_BOOTLOADER_VERSION</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bootloader&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_SECURE_PATCH_LEVEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;2020-6-5&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_ABI_LIST</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
</pre></div>
</div>
<p>For Hi3861 development boards, you need to modify the source files in
the <strong>vendor/huawei/wifi-iot/hals/utils/sys_param</strong> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_PRODUCT_TYPE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_MANUFACTURE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_BRAND</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_MARKET_NAME</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_PRODUCT_SERIES</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_PRODUCT_MODEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_SOFTWARE_MODEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_HARDWARE_MODEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_HARDWARE_PROFILE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;aout:true,display:true&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_BOOTLOADER_VERSION</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bootloader&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_SECURE_PATCH_LEVEL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;2020-6-5&quot;</span><span class="p">};</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="n">HOS_ABI_LIST</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;****&quot;</span><span class="p">};</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Obtaining default system attributes</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span><span class="o">*</span> <span class="n">value1</span> <span class="o">=</span> <span class="n">GetProductType</span><span class="p">();</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Product type =</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value1</span><span class="p">);</span>
<span class="n">free</span><span class="p">(</span><span class="n">value1</span><span class="p">);</span>
<span class="n">char</span><span class="o">*</span> <span class="n">value2</span> <span class="o">=</span> <span class="n">GetManufacture</span><span class="p">();</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Manufacture =</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value2</span><span class="p">);</span>
<span class="n">free</span><span class="p">(</span><span class="n">value2</span><span class="p">);</span>
<span class="n">char</span><span class="o">*</span> <span class="n">value3</span> <span class="o">=</span> <span class="n">GetBrand</span><span class="p">();</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;GetBrand =</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value3</span><span class="p">);</span>
<span class="n">free</span><span class="p">(</span><span class="n">value3</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Obtaining custom system attributes</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">defSysParam</span> <span class="o">=</span> <span class="s2">&quot;data of sys param ***...&quot;</span><span class="p">;</span>
<span class="n">char</span> <span class="n">key</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;rw.parameter.key&quot;</span><span class="p">;</span>
<span class="n">char</span> <span class="n">value</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;OEM-hisi-10.1.0&quot;</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">SetParameter</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="n">char</span> <span class="n">valueGet</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">GetParameter</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">defSysParam</span><span class="p">,</span> <span class="n">valueGet</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;value = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">valueGet</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="repositories-involved">
<h2>Repositories Involved<a class="headerlink" href="#repositories-involved" title="Permalink to this headline">¶</a></h2>
<p>startup_frameworks_syspara_lite</p>
<p>startup_hals_syspara_lite</p>
<p>startup_interfaces_kits_syspara_lite</p>
<p>startup_appspawn_lite</p>
<p>startup_services_bootstrap_lite</p>
<p>startup_init_lite</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/readme/startup.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>