
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C Coding Style Guide &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="c-coding-style-guide">
<h1>C Coding Style Guide<a class="headerlink" href="#c-coding-style-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>Rules are not perfect. Disabling useful features in specific situations
may affect code implementation. However, the rules are formulated “to
help most programmers to get more benefits”. If a rule is found
unhelpful or difficult to follow in team coding, please send your
feedback to us so we can improve the rule accordingly. Before referring
to this guide, you are expected to have the following basic capabilities
for C rather than being a beginner who wants to learn about C.</p>
<ol class="arabic simple">
<li><p>Understand the ISO standard of C.</p></li>
<li><p>Be familiar with the basic features of C.</p></li>
<li><p>Understand the standard library of C.</p></li>
</ol>
</div>
<div class="section" id="general-principles">
<h2>General Principles<a class="headerlink" href="#general-principles" title="Permalink to this headline">¶</a></h2>
<p>Code must meet the requirements for <strong>readability</strong>,
<strong>maintainability</strong>, <strong>security</strong>, <strong>reliability</strong>, <strong>testability</strong>,
<strong>efficiency</strong>, and <strong>portability</strong> while ensuring functionality
correctness.</p>
</div>
<div class="section" id="conventions">
<h2>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>Rule</strong>: Conventions that must be followed during programming.</div>
<div class="line"><strong>Suggestion</strong>: Conventions that must be considered during
programming.</div>
</div>
<p>It is necessary to understand the reason for these conventions and to
try and comply with them, no matter if they are rules or
recommendations.</p>
</div>
<div class="section" id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">The only acceptable exceptions are those that do not violate the
general principles and provide appropriate reasons for their
existence.</div>
<div class="line">Exceptions destroy code consistency. Try to avoid them. Exceptions to
‘Rules’ should be very rare.</div>
</div>
<div class="line-block">
<div class="line">The style consistency principle is preferred in the following case:</div>
<div class="line"><strong>When you modify open source or third-party code. The existing code
specifications prevail.</strong></div>
</div>
</div>
</div>
<div class="section" id="naming">
<h1>1 Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h1>
<p>Names include file, function, variable, type, and macro names.</p>
<div class="line-block">
<div class="line">Naming is considered the most difficult and important thing in
software development.</div>
<div class="line">The name of an identifier must be clear, well defined, and easy to
understand, adapting to reading habit.</div>
</div>
<p>The unified naming style is the most direct expression of the
consistency principle.</p>
<div class="section" id="general-conventions">
<h2>General Conventions<a class="headerlink" href="#general-conventions" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>CamelCase</strong></div>
<div class="line">Camel case is the practice of writing compound words or phrases so
that each word or abbreviation in the phrase begins with a capital
letter, and with no intervening spaces or punctuation.</div>
<div class="line">This style has two alternatives depending on the case of the first
letter: <strong>UpperCamelCase and lowerCamelCase</strong></div>
</div>
<div class="section" id="rule-1-1-name-identifiers-in-camel-case-style">
<h3>Rule 1.1 Name identifiers in camel case style.<a class="headerlink" href="#rule-1-1-name-identifiers-in-camel-case-style" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Naming Style</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Function, struct, enumeration,
union</p></td>
<td><p>UpperCamelCase</p></td>
</tr>
<tr class="row-odd"><td><p>Variable, function parameter,
macro parameter, struct body,
union member</p></td>
<td><p>lowerCamelCase</p></td>
</tr>
<tr class="row-even"><td><p>Macro, constant, enumerated
value, goto tag</p></td>
<td><p>All capitalized, separated with
underscores (_)</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Note:</div>
<div class="line">The <code class="docutils literal notranslate"><span class="pre">constant</span></code> in the above table refers to the variable of the
basic data type, enumeration, and string type of the const modifier
under the global scope, excluding array, struct and union.</div>
<div class="line">The <code class="docutils literal notranslate"><span class="pre">variable</span></code> in the above table refers to variables other than the
constant definition, all using lowercase.</div>
</div>
</div>
<div class="section" id="rec-1-1-the-larger-the-scope-the-more-accurate-the-name-should-be">
<h3>Rec 1.1 The larger the scope, the more accurate the name should be.<a class="headerlink" href="#rec-1-1-the-larger-the-scope-the-more-accurate-the-name-should-be" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">C is different from C++. There is no namespace or class. Therefore,
the names of identifiers in the global scope must not conflict with
each other.</div>
<div class="line">Names of global functions, global variables, macros, types, and
enumerations must be accurately described and unique in the global
scope.</div>
</div>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">GetCount</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>                 <span class="c1">// Bad: inaccurate description.</span>
<span class="kt">int</span> <span class="nf">GetActiveConnectCount</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>    <span class="c1">// Good</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">For accurate naming, a module prefix can be added if necessary.</div>
<div class="line">The module prefix and the naming body can be connected by following
the CamelCase style.</div>
<div class="line">Example:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">PrefixFuncName</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>   <span class="c1">// OK: CamelCase, with no prefix in the format, but prefix in the content.</span>

<span class="k">enum</span> <span class="n">XxxMyEnum</span> <span class="p">{</span>            <span class="c1">// OK.</span>
    <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="file-naming">
<h2>File Naming<a class="headerlink" href="#file-naming" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rec-1-2-use-lowercase-file-names">
<h3>Rec 1.2 Use lowercase file names.<a class="headerlink" href="#rec-1-2-use-lowercase-file-names" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">File names naming are allowed only with lowercase letters, numbers,
and underscores (_).</div>
<div class="line">File names should be as short, accurate, and unambiguous as possible.</div>
<div class="line">The reason for using lowercase file names is that different systems
process file names in different ways (for example, Microsoft DOS and
Windows OS are not case sensitive, but Unix/Linux and Mac systems are
by default).</div>
</div>
<div class="line-block">
<div class="line">Good example:</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">dhcp_user_log.c</span></code></div>
</div>
<div class="line-block">
<div class="line">Bad examples:</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">dhcp_user-log.c</span></code>: It is not recommended you separate names with
‘-’.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">dhcpuserlog.c</span></code>: The words are not separated, causing poor
readability.</div>
</div>
</div>
</div>
<div class="section" id="function-naming">
<h2>Function Naming<a class="headerlink" href="#function-naming" title="Permalink to this headline">¶</a></h2>
<p>Functions are named in UpperCamelCase style.</p>
<div class="section" id="rec-1-3-name-functions-that-comply-with-reading-habits">
<h3>Rec 1.3 Name functions that comply with reading habits.<a class="headerlink" href="#rec-1-3-name-functions-that-comply-with-reading-habits" title="Permalink to this headline">¶</a></h3>
<p>The “verb + object” structure can be used for action related function
names. For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">AddTableEntry</span><span class="p">()</span> <span class="c1">// OK</span>
<span class="n">DeleteUser</span><span class="p">()</span>    <span class="c1">// OK</span>
<span class="n">GetUserInfo</span><span class="p">()</span>   <span class="c1">// OK</span>
</pre></div>
</div>
<p>An adjective or a prefix “is” can be used in a function returning a
Boolean value. For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">DataReady</span><span class="p">()</span>     <span class="c1">// OK</span>
<span class="n">IsRunning</span><span class="p">()</span>     <span class="c1">// OK</span>
<span class="n">JobDone</span><span class="p">()</span>       <span class="c1">// OK</span>
</pre></div>
</div>
<p>Data or Getter function:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TotalCount</span><span class="p">()</span>    <span class="c1">// OK</span>
<span class="n">GetTotalCount</span><span class="p">()</span> <span class="c1">// OK</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="variable-naming">
<h2>Variable Naming<a class="headerlink" href="#variable-naming" title="Permalink to this headline">¶</a></h2>
<p>Variables are named in the lowerCamelCase style. This includes global
variables, local variables, parameters in the function declaration or
definition as well as parameters in function-like macro.</p>
<blockquote>
<div><p>Rule 1.2 Add the ‘g_’ prefix to global variables. Do not add this prefix to static variables in a function.</p>
</div></blockquote>
<hr class="docutils" />
<div class="line-block">
<div class="line">Global variables should be used as little as possible, and special
attention should be paid to their use. Prefixes are used for visual
prominence, prompting developers to be more careful about using global
variables.</div>
<div class="line">The naming rule of global static variables is the same as that of
global variables. The name of a static variable in a function is the
same as that of a common local variable.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">g_activeConnectCount</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">Func</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">pktCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notes: The nature of a constant is also a global variable, but it does
not apply to current rule if the naming style is all uppercase and
connected by underline.</p>
<div class="section" id="rec-1-4-keep-local-variables-short-and-to-the-point">
<h3>Rec 1.4 Keep local variables short and to the point.<a class="headerlink" href="#rec-1-4-keep-local-variables-short-and-to-the-point" title="Permalink to this headline">¶</a></h3>
<p>The name of a local variable should be short on the premise that
meanings can be expressed through context.</p>
<p>The following is an example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Func</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="k">enum</span> <span class="n">PowerBoardStatus</span> <span class="n">powerBoardStatusOfSlot</span><span class="p">;</span> <span class="c1">// Not good: Long redundant local variable.</span>
    <span class="n">powerBoardStatusOfSlot</span> <span class="o">=</span> <span class="n">GetPowerBoardStatus</span><span class="p">(</span><span class="n">slot</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">powerBoardStatusOfSlot</span> <span class="o">==</span> <span class="n">POWER_OFF</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Better writing style:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Func</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="k">enum</span> <span class="n">PowerBoardStatus</span> <span class="n">status</span><span class="p">;</span>   <span class="c1">// Good: The status can be clearly expressed in context.</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">GetPowerBoardStatus</span><span class="p">(</span><span class="n">slot</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">POWER_OFF</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Similarly, “tmp” can be used to address any type of temporary
variable.</div>
<div class="line">A short variable name should be used with caution, but sometimes a
single character variable is allowed, for example, a counter variable
in a loop statement.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">COUNTER_RANGE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or, variables in simple math functions:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Mul</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-naming">
<h2>Type Naming<a class="headerlink" href="#type-naming" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Types are named in the UpperCamelCase style.</div>
<div class="line">The type can be a structure, a union, or an enumeration.</div>
</div>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">MsgHead</span> <span class="p">{</span>
    <span class="k">enum</span> <span class="n">MsgType</span> <span class="n">type</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">msgLen</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">msgBuf</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="nc">Packet</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="nc">SendPacket</span> <span class="n">send</span><span class="p">;</span>
    <span class="k">struct</span> <span class="nc">RecvPacket</span> <span class="n">recv</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">BaseColor</span> <span class="p">{</span>
    <span class="n">RED</span><span class="p">,</span>    <span class="c1">// Note: The enumeration is in UpperCamelCase style while the enumerated values adopt the macro naming style.</span>
    <span class="n">GREEN</span><span class="p">,</span>
    <span class="n">BLUE</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">NodeCmpFunc</span><span class="p">)(</span><span class="k">struct</span> <span class="nc">Node</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">Node</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">When you use typedef to set an alias for a struct, a union or an enum
type, try to use anonymous type.</div>
<div class="line">If you need self-nesting pointers, you can add a ‘tag’ prefix or an
underscore suffix.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>typedef struct {    // Good: The anonymous struct is used because self-nesting is not required.
    int a;
    int b;
} MyType;           // Struct alias with UpperCamelCase.

​```c
typedef struct tagNode {    // Good: Add the &#39;tag&#39; prefix or use &#39;Node_&#39;.
    struct tagNode *prev;
    struct tagNode *next;
} Node;             // UpperCamelCase.
</pre></div>
</div>
</div>
<div class="section" id="macros-constants-and-enumeration-naming">
<h2>Macros, Constants, and Enumeration Naming<a class="headerlink" href="#macros-constants-and-enumeration-naming" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Macros and enumerated values are capitalized and are separated with
underscores (_).</div>
<div class="line">Constants are recommended to be capitalized and be separated with
underscores (_). Also, as global const variables, they can be named
with global variable style.</div>
<div class="line">The constants here are defined as global const variables of basic data
type, enumeration, and string type.</div>
</div>
<div class="line-block">
<div class="line">Function-like macros, can be named the same way as functions, using
the UpperCamelCase naming style.</div>
<div class="line">However, this approach makes the macros look the same as functions. It
is confusing and needs special attention.</div>
</div>
<p>Macro example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PI 3.14</span>
<span class="cp">#define MAX(a, b)   (((a) &lt; (b)) ? (b) : (a))</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef SOME_DEFINE</span>
<span class="kt">void</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="cp">#define Foo(a) Bar(a)   </span><span class="c1">// The function-like macro is named as a function style.</span>
<span class="cp">#else</span>
<span class="kt">void</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Constant example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">VERSION</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>    <span class="c1">// OK.</span>

<span class="k">const</span> <span class="k">enum</span> <span class="n">Color</span> <span class="n">DEFAULT_COLOR</span> <span class="o">=</span> <span class="n">BLUE</span><span class="p">;</span> <span class="c1">// OK.</span>

<span class="k">const</span> <span class="kt">char</span> <span class="n">PATH_SEP</span> <span class="o">=</span> <span class="sc">&#39;/&#39;</span><span class="p">;</span>  <span class="c1">// OK.</span>

<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">GREETINGS</span> <span class="o">=</span> <span class="s">&quot;Hello, World!&quot;</span><span class="p">;</span> <span class="c1">// OK.</span>
</pre></div>
</div>
<p>Non-constant example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Structure type does not meet the definition of constant.</span>
<span class="k">const</span> <span class="k">struct</span> <span class="nc">MyType</span> <span class="n">g_myData</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>     <span class="c1">// OK: Name it in lowerCamelCase style.</span>

<span class="c1">// Array type does not meet the definition of constant.</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">g_xxxBaseValue</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span> <span class="p">};</span>   <span class="c1">// OK: Name it in lowerCamelCase style.</span>

<span class="kt">int</span> <span class="nf">Foo</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="c1">// The scope does not meet the definition of constant.</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">bufSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>    <span class="c1">// OK: Name it in lowerCamelCase style.</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Enumeration example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Note: The enumeration type name is in the UpperCamelCase style, while enumerated values are all capitalized and separated with underscores (_).</span>
<span class="k">enum</span> <span class="n">BaseColor</span> <span class="p">{</span>
    <span class="n">RED</span><span class="p">,</span>
    <span class="n">GREEN</span><span class="p">,</span>
    <span class="n">BLUE</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="section" id="rec-1-5-do-not-name-temporary-variables-in-function-like-macros-and-pollute-the-external-scope">
<h3>Rec 1.5 Do not name temporary variables in function-like macros and pollute the external scope.<a class="headerlink" href="#rec-1-5-do-not-name-temporary-variables-in-function-like-macros-and-pollute-the-external-scope" title="Permalink to this headline">¶</a></h3>
<p>First, <strong>use function-like macros as little as possible.</strong></p>
<p>When a function-like macro needs to define local variables, to avoid
naming conflicts with local variables in external functions,</p>
<p>an underline is a good solution. Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SWAP_INT(a, b) do { \</span>
<span class="cp">    int tmp_ = a; \</span>
<span class="cp">    a = b; \</span>
<span class="cp">    b = tmp_; \</span>
<span class="cp">} while (0)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="formatting">
<h1>2 Formatting<a class="headerlink" href="#formatting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="line-length">
<h2>Line Length<a class="headerlink" href="#line-length" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rec-2-1-ensure-that-each-line-is-no-more-than-120-characters-in-length">
<h3>Rec 2.1 Ensure that each line is no more than 120 characters in length.<a class="headerlink" href="#rec-2-1-ensure-that-each-line-is-no-more-than-120-characters-in-length" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The line width of the code should not be too long, otherwise it is not
conducive to reading.</div>
<div class="line">The line length requirement indirectly guides developers in shortening
function and variable names, reducing nesting, and improving
readability.</div>
<div class="line">It is strongly recommended that the number of characters per line do
not exceed <strong>120</strong> unless readability is significantly improved as a
result and no information is hidden.</div>
<div class="line">While the resolution of modern monitors is very high, long lines will
increase the difficulty of reading comprehension, which is against the
principles of “clear” and “concise” defined in this document.</div>
</div>
<p>The following scenarios should not be wrapped, and can be treated as
exceptions:</p>
<ul class="simple">
<li><p>Line breaks can cause strings truncated and hard to retrieved (grep),
such as command lines or URLs. Codes or comments that contain these
can be treated as exceptions appropriately.</p></li>
<li><p>‘#include’, ‘#error’ statements are allowed to exceed the line width
requirement, but you should try to avoid this.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef XXX_YYY_ZZZ</span>
<span class="cp">#error Header aaaa/bbbb/cccc/abc.h must only be included after xxxx/yyyy/zzzz/xyz.h</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indentation">
<h2>Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-1-use-spaces-to-indent-and-indent-four-spaces-at-a-time">
<h3>Rule 2.1 Use spaces to indent and indent four spaces at a time.<a class="headerlink" href="#rule-2-1-use-spaces-to-indent-and-indent-four-spaces-at-a-time" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Only spaces can be used for indentation. <strong>4</strong> spaces are indented
each time. Do not use the Tab character to indent.</div>
<div class="line">Currently, almost all integrated development environments (IDEs) and
code editors support automatically converting a Tab input to <strong>4</strong>
spaces. Please set your code editor to support indentation with
spaces, if it is not the default.</div>
</div>
</div>
</div>
<div class="section" id="braces">
<h2>Braces<a class="headerlink" href="#braces" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-2-use-the-k-r-indentation-style">
<h3>Rule 2.2 Use the K&amp;R indentation style.<a class="headerlink" href="#rule-2-2-use-the-k-r-indentation-style" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>K&amp;R style</strong></div>
<div class="line">While wrapping a line, the left brace of the function starts a new
line and takes a single line. Other left braces are placed at the end
of the line along with the statement.</div>
<div class="line">The right brace takes a single line, unless it is followed by the rest
of the same statement, such as ‘while’ in the ‘do’ statement, or
‘else’/‘else if’ of the ‘if’ statement, or a comma or semicolon.</div>
</div>
<p>For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">MyType</span> <span class="p">{</span>     <span class="c1">// Good: Follow the statement to the end, and indent one space.</span>
    <span class="p">...</span>
<span class="p">};</span>                  <span class="c1">// Good: The right brace is followed by the semicolon.</span>

<span class="kt">int</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>                   <span class="c1">// Good: The left brace of the function starts a new line, and nothing else is placed on the line.</span>
    <span class="k">if</span> <span class="p">(...)</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>        <span class="c1">// Good: The &#39;else&#39; statement follows the right brace.</span>
        <span class="p">...</span>
    <span class="p">}</span>               <span class="c1">// Good: The right brace takes a single line.</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="function-declaration-and-definition">
<h2>Function Declaration and Definition<a class="headerlink" href="#function-declaration-and-definition" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-3-the-return-type-and-function-name-of-the-function-declaration-and-definition-must-be-on-the-same-line-the-function-parameter-list-must-be-aligned-appropriately-if-it-needs-to-be-wrapped">
<h3>Rule 2.3 The return type and function name of the function declaration and definition must be on the same line. The function parameter list must be aligned appropriately if it needs to be wrapped.<a class="headerlink" href="#rule-2-3-the-return-type-and-function-name-of-the-function-declaration-and-definition-must-be-on-the-same-line-the-function-parameter-list-must-be-aligned-appropriately-if-it-needs-to-be-wrapped" title="Permalink to this headline">¶</a></h3>
<p>When a function is declared and defined, the return value type of the
function should be in the same line as the function name.</p>
<div class="line-block">
<div class="line">When the function parameter list is wrapped, it should be aligned
appropriately.</div>
<div class="line">The left parenthesis of a parameter list is always in the same line as
the function name. The right parenthesis always follows the last
parameter.</div>
</div>
<p>The following is an example of line breaks:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ReturnType</span> <span class="nf">FunctionName</span><span class="p">(</span><span class="n">ArgType</span> <span class="n">paramName1</span><span class="p">,</span> <span class="n">ArgType</span> <span class="n">paramName2</span><span class="p">)</span>   <span class="c1">// Good：All in one line</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="n">ReturnType</span> <span class="nf">VeryVeryVeryLongFunctionName</span><span class="p">(</span><span class="n">ArgType</span> <span class="n">paramName1</span><span class="p">,</span>     <span class="c1">// The line length cannot accommodate all parameters and thus a line break is required.</span>
                                        <span class="n">ArgType</span> <span class="n">paramName2</span><span class="p">,</span>     <span class="c1">// Good：Aligned with the previous line.</span>
                                        <span class="n">ArgType</span> <span class="n">paramName3</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="n">ReturnType</span> <span class="nf">LongFunctionName</span><span class="p">(</span><span class="n">ArgType</span> <span class="n">paramName1</span><span class="p">,</span> <span class="n">ArgType</span> <span class="n">paramName2</span><span class="p">,</span> <span class="c1">// Subject to line length, a line break is required.</span>
    <span class="n">ArgType</span> <span class="n">paramName3</span><span class="p">,</span> <span class="n">ArgType</span> <span class="n">paramName4</span><span class="p">,</span> <span class="n">ArgType</span> <span class="n">paramName5</span><span class="p">)</span>     <span class="c1">// Good: After the line break, 4 spaces are used for indentation.</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="n">ReturnType</span> <span class="nf">ReallyReallyReallyReallyLongFunctionName</span><span class="p">(</span>            <span class="c1">// The line length cannot accommodate the first parameter, and thus a line break is required.</span>
    <span class="n">ArgType</span> <span class="n">paramName1</span><span class="p">,</span> <span class="n">ArgType</span> <span class="n">paramName2</span><span class="p">,</span> <span class="n">ArgType</span> <span class="n">paramName3</span><span class="p">)</span> <span class="c1">// Good: After the line break, 4 spaces are used for indentation.</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="function-calls">
<h2>Function Calls<a class="headerlink" href="#function-calls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-4-the-parameter-list-should-be-aligned-appropriately-when-the-parameter-list-requires-a-line-break">
<h3>Rule 2.4 The parameter list should be aligned appropriately when the parameter list requires a line break.<a class="headerlink" href="#rule-2-4-the-parameter-list-should-be-aligned-appropriately-when-the-parameter-list-requires-a-line-break" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When the function is called, if the function parameter list is
wrapped, it should be aligned appropriately.</div>
<div class="line">The left parenthesis is always followed by a function name, and the
right parenthesis always follows the last parameter.</div>
</div>
<p>The following is an example of line breaks:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ReturnType</span> <span class="n">result</span> <span class="o">=</span> <span class="n">FunctionName</span><span class="p">(</span><span class="n">paramName1</span><span class="p">,</span> <span class="n">paramName2</span><span class="p">);</span>   <span class="c1">// Good：Function parameters are placed in one line.</span>

<span class="n">ReturnType</span> <span class="n">result</span> <span class="o">=</span> <span class="n">FunctionName</span><span class="p">(</span><span class="n">paramName1</span><span class="p">,</span>
                                 <span class="n">paramName2</span><span class="p">,</span>                <span class="c1">// Good：Aligned with the above parameters.</span>
                                 <span class="n">paramName3</span><span class="p">);</span>

<span class="n">ReturnType</span> <span class="n">result</span> <span class="o">=</span> <span class="n">FunctionName</span><span class="p">(</span><span class="n">paramName1</span><span class="p">,</span> <span class="n">paramName2</span><span class="p">,</span>
    <span class="n">paramName3</span><span class="p">,</span> <span class="n">paramName4</span><span class="p">,</span> <span class="n">paramName5</span><span class="p">);</span>                    <span class="c1">// Good：After the line break, 4 spaces are used for indentation.</span>

<span class="n">ReturnType</span> <span class="n">result</span> <span class="o">=</span> <span class="n">VeryVeryVeryLongFunctionName</span><span class="p">(</span>           <span class="c1">// The line length cannot accommodate the first parameter, and thus a line break is required.</span>
    <span class="n">paramName1</span><span class="p">,</span> <span class="n">paramName2</span><span class="p">,</span> <span class="n">paramName3</span><span class="p">);</span>                    <span class="c1">// After the line break, 4 spaces are used for indentation.</span>
</pre></div>
</div>
<p>If the parameters in a function call are associated with each other, the
parameters are grouped for better understanding, rather than strictly
adhering to formatting requirements.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Good：The parameters in each line represent a group of data structures with a strong correlation. They are placed on one line for ease of understanding.</span>
<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">DealWithStructureLikeParams</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>     <span class="c1">// Indicates a group of parameters.</span>
                                         <span class="n">right</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">right</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>  <span class="c1">// Indicates another group of related parameters.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="conditional-statements">
<h2>Conditional Statements<a class="headerlink" href="#conditional-statements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-5-conditional-statements-must-use-braces">
<h3>Rule 2.5 Conditional statements must use braces.<a class="headerlink" href="#rule-2-5-conditional-statements-must-use-braces" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">We require that all conditional statements use braces, even if there
is only one statement.</div>
<div class="line">Reason:</div>
</div>
<ul class="simple">
<li><p>Logic is intuitive and easy to read.</p></li>
<li><p>It is not easy to make mistakes when adding new code to the existing
conditional statement.</p></li>
<li><p>Function-like macros without braces are used in conditional
statements, can be error prone if braces do not surround the
conditional statement.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">objectIsNotExist</span><span class="p">)</span> <span class="p">{</span>         <span class="c1">// Good: Braces are added to a single-line conditional statement.</span>
    <span class="k">return</span> <span class="nf">CreateNewObject</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="rule-2-6-do-not-place-if-else-and-else-if-in-the-same-line">
<h3>Rule 2.6 Do not place ‘if’, ‘else’ and ‘else if’ in the same line.<a class="headerlink" href="#rule-2-6-do-not-place-if-else-and-else-if-in-the-same-line" title="Permalink to this headline">¶</a></h3>
<p>In a conditional statement, if there are multiple branches, they should
be written in different lines.</p>
<p>The correct format:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">someConditions</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>    <span class="c1">// Good: The &#39;else&#39; is in a different line of &#39;if&#39;.</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following is a case that does not comply with the specifications:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">someConditions</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="c1">// Bad: They are in the same line.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="loops">
<h2>Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-7-use-braces-in-loop-statements">
<h3>Rule 2.7 Use braces in loop statements.<a class="headerlink" href="#rule-2-7-use-braces-in-loop-statements" title="Permalink to this headline">¶</a></h3>
<p>Similar to the condition expression, we require that the for and while
loop conditional statements contain braces, even if there is only one
loop.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">someRange</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>   <span class="c1">// Good: Braces are used.</span>
    <span class="n">DoSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>   <span class="c1">// Good: The while loop body is empty. And braces are used.</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">continue</span><span class="p">;</span>           <span class="c1">// Good: The continue keyword highlights the end of the empty loop. And braces are used.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Bad example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">someRange</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">DoSomething</span><span class="p">();</span>      <span class="c1">// Bad: Braces should be added.</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="n">condition</span><span class="p">);</span>      <span class="c1">// Bad: Using semicolons will make people misunderstand which code is a part of the while statement.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="switch-statements">
<h2>Switch Statements<a class="headerlink" href="#switch-statements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-8-indent-the-case-or-default-statement-in-a-switch-statement-block">
<h3>Rule 2.8 Indent the case or default statement in a switch statement block.<a class="headerlink" href="#rule-2-8-indent-the-case-or-default-statement-in-a-switch-statement-block" title="Permalink to this headline">¶</a></h3>
<p>The indentation style of the switch statement is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>             <span class="c1">// Good: Indented</span>
        <span class="n">DoSomething1</span><span class="p">();</span> <span class="c1">// Good: Indented</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="p">{</span>           <span class="c1">// Good: Braces are added.</span>
        <span class="n">DoSomething2</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="mi">0</span><span class="o">:</span>                 <span class="c1">// Bad: &#39;case&#39; not indented</span>
    <span class="n">DoSomething</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
<span class="k">default</span><span class="o">:</span>                <span class="c1">// Bad: &#39;default&#39; not indented</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rec-2-2-keep-a-consistent-expression-line-break-style-and-ensure-that-operators-are-placed-at-the-end-of-the-line">
<h3>Rec 2.2 Keep a consistent expression line break style and ensure that operators are placed at the end of the line.<a class="headerlink" href="#rec-2-2-keep-a-consistent-expression-line-break-style-and-ensure-that-operators-are-placed-at-the-end-of-the-line" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A long expression that does not meet the line length requirement must
be wrapped appropriately. Generally, the expression is wrapped at an
operator of a lower priority or a hyphen, and the operator or hyphen
is placed at the end of the line.</div>
<div class="line">The operator and hyphen are placed at the end of the line, indicating
that the operation is to be continued.</div>
</div>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Pretend that the following first line does not meet the line length requirement.</span>
<span class="k">if</span> <span class="p">((</span><span class="n">currentValue</span> <span class="o">&gt;</span> <span class="n">MIN</span><span class="p">)</span> <span class="o">&amp;&amp;</span>  <span class="c1">// Good: After the line break, the Boolean operator is placed at the end of the line.</span>
    <span class="p">(</span><span class="n">currentValue</span> <span class="o">&lt;</span> <span class="n">MAX</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">DoSomething</span><span class="p">();</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">reallyReallyLongVariableName1</span> <span class="o">+</span>    <span class="c1">// Good: The plus sign is placed at the end of the line.</span>
             <span class="n">reallyReallyLongVariableName2</span><span class="p">;</span>
</pre></div>
</div>
<p>After an expression is wrapped, ensure that the lines are properly
aligned or indented by 4 spaces. See the following example.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">longVaribleName1</span> <span class="o">+</span> <span class="n">longVaribleName2</span> <span class="o">+</span> <span class="n">longVaribleName3</span> <span class="o">+</span>
    <span class="n">longVaribleName4</span> <span class="o">+</span> <span class="n">longVaribleName5</span> <span class="o">+</span> <span class="n">longVaribleName6</span><span class="p">;</span>         <span class="c1">// OK: indented with 4 spaces</span>

<span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">longVaribleName1</span> <span class="o">+</span> <span class="n">longVaribleName2</span> <span class="o">+</span> <span class="n">longVaribleName3</span> <span class="o">+</span>
          <span class="n">longVaribleName4</span> <span class="o">+</span> <span class="n">longVaribleName5</span> <span class="o">+</span> <span class="n">longVaribleName6</span><span class="p">;</span>   <span class="c1">// OK: aligned</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="variable-assignment">
<h2>Variable Assignment<a class="headerlink" href="#variable-assignment" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Rule 2.9 Multiple variable definitions and assignment statements cannot be written on one line.</p>
</div></blockquote>
<hr class="docutils" />
<p>It is best to have only one variable initialization statement on each
line. It is easier to read and understand.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">maxCount</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</pre></div>
</div>
<p>The following is an example that does not comply with the
specifications:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">maxCount</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="kt">bool</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// Bad: Multiple initialization statements are placed on the same line.</span>
<span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// Bad: Variable definitions need to be placed on different lines. Each definition occupies one line.</span>

<span class="kt">int</span> <span class="n">pointX</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">pointY</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">pointX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">pointY</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">// Bad: Multiple variable assignment statements are placed on the same line.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Exception:</div>
<div class="line">If multiple variables with strong correlation are defined and do not
need to be initialized, you can define the variables in a line to
reduce repeated information so that the code is more compact.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>  <span class="c1">// Good: Multiple variables that are defined and do not need to be initialized immediately can be written in one line.</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">row</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">col</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<p>Initialization is applicable to structs, unions, and arrays.</p>
<div class="section" id="rule-2-10-indent-when-initiating-a-new-line-or-make-a-reasonable-alignment">
<h3>Rule 2.10 Indent when initiating a new line, or make a reasonable alignment.<a class="headerlink" href="#rule-2-10-indent-when-initiating-a-new-line-or-make-a-reasonable-alignment" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When a structure or array is initialized, if a line break is made,
ensure that the line is indented with 4 spaces.</div>
<div class="line">From the readability point of view, make a reasonable alignment.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Good: No line break for a short line.</span>
<span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">};</span>

<span class="c1">// Good: A line break here makes the readability better.</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">rank</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span>
    <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">For complex data, the initialization should be clear and compact.</div>
<div class="line">Refer to the following format:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">a</span><span class="p">[][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="c1">// OK.</span>
    <span class="p">{</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="p">{</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">b</span><span class="p">[][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span> <span class="p">},</span>     <span class="c1">// OK.</span>
    <span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">c</span><span class="p">[][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span>
        <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span>      <span class="c1">// OK.</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Note:</p>
<ul class="simple">
<li><p>If the left brace is placed at the end of the line, the corresponding
right brace shoud be placed into a new line.</p></li>
<li><p>If the left brace is followed by the content, the corresponding right
brace should also follow the content.</p></li>
</ul>
</div>
<div class="section" id="rule-2-11-when-struct-and-union-members-are-initialized-each-member-is-initialized-on-a-separate-line">
<h3>Rule 2.11 When struct and union members are initialized, each member is initialized on a separate line.<a class="headerlink" href="#rule-2-11-when-struct-and-union-members-are-initialized-each-member-is-initialized-on-a-separate-line" title="Permalink to this headline">¶</a></h3>
<p>The C99 standard supports the initialization of the struct and union
members in their definition. This is called the designated initializer.
If initialization is performed in this way, each member is initialized
in a separate line.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">Date</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">year</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">month</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">day</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="p">{</span>    <span class="c1">// Good: When the designated initializer is used, each member is initialized on a separate line.</span>
    <span class="p">.</span><span class="n">year</span>   <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="p">.</span><span class="n">month</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">.</span><span class="n">day</span>    <span class="o">=</span> <span class="mi">1</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pointers">
<h2>Pointers<a class="headerlink" href="#pointers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rec-2-3-the-pointer-type-asterisk-follows-the-variable-name-or-the-type-do-not-leave-spaces-on-both-sides-and-always-use-at-least-one-space">
<h3>Rec 2.3 The pointer type asterisk “*” follows the variable name or the type. Do not leave spaces on both sides and always use at least one space.<a class="headerlink" href="#rec-2-3-the-pointer-type-asterisk-follows-the-variable-name-or-the-type-do-not-leave-spaces-on-both-sides-and-always-use-at-least-one-space" title="Permalink to this headline">¶</a></h3>
<p>When you declare or define a pointer variable or return a pointer type
function, “*” can be placed on the left or right, adhering to the type
or name. Do not leave spaces on both sides. And do not leave out spaces
altogether.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span><span class="n">p1</span><span class="p">;</span>    <span class="c1">// OK.</span>
<span class="kt">int</span><span class="o">*</span> <span class="n">p2</span><span class="p">;</span>    <span class="c1">// OK.</span>

<span class="kt">int</span><span class="o">*</span><span class="n">p3</span><span class="p">;</span>     <span class="c1">// Bad: No spaces.</span>
<span class="kt">int</span> <span class="o">*</span> <span class="n">p4</span><span class="p">;</span>   <span class="c1">// Bad: Spaces on both sides.</span>
</pre></div>
</div>
<p>Choose a style and stay consistent.</p>
<p>When using style that “*” follows type, avoid declaring multiple
variables with pointer in a line.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>  <span class="c1">// Bad: It is easy to misinterpret b as a pointer.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">When using style that “*” follows variable, there may be situations
that cannot be followed.</div>
<div class="line">Do not follow when it cannot. Style consistency first.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">VERSION</span> <span class="o">=</span> <span class="s">&quot;V100&quot;</span><span class="p">;</span>      <span class="c1">// OK.</span>
<span class="kt">int</span> <span class="nf">Foo</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="kr">restrict</span> <span class="n">p</span><span class="p">);</span>   <span class="c1">// OK.</span>
</pre></div>
</div>
<p>“*” never follows ‘const’ or ‘restrict’ keywords anytime.</p>
</div>
</div>
<div class="section" id="compilation-preprocessing">
<h2>Compilation Preprocessing<a class="headerlink" href="#compilation-preprocessing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-12-the-number-sign-must-be-placed-at-the-beginning-of-a-line-for-compilation-preprocessing-and-can-be-indented-in-nested-compilation-preprocessing">
<h3>Rule 2.12 The number sign (#) must be placed at the beginning of a line for compilation preprocessing and can be indented in nested compilation preprocessing.<a class="headerlink" href="#rule-2-12-the-number-sign-must-be-placed-at-the-beginning-of-a-line-for-compilation-preprocessing-and-can-be-indented-in-nested-compilation-preprocessing" title="Permalink to this headline">¶</a></h3>
<p>The number sign (#) must be placed at the beginning of a line for
compilation preprocessing, even if the code is embedded in the function
body.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(__x86_64__) &amp;&amp; defined(__GCC_HAVE_SYNC_COMPARE_AND_SWAP_16) </span><span class="c1">// Good: &quot;#&quot; is at the beginning of the line.</span>
<span class="cp">#define ATOMIC_X86_HAS_CMPXCHG16B 1  </span><span class="c1">// Good: &quot;#&quot; is at the beginning of the line.</span>
<span class="cp">#else</span>
<span class="cp">#define ATOMIC_X86_HAS_CMPXCHG16B 0</span>
<span class="cp">#endif</span>

<span class="kt">int</span> <span class="nf">FunctionName</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">someThingError</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">...</span>
<span class="cp">#ifdef HAS_SYSLOG        </span><span class="c1">// Good: &quot;#&quot; is at the beginning of the line even though it&#39;s in a function body.</span>
        <span class="n">WriteToSysLog</span><span class="p">();</span>
<span class="cp">#else</span>
        <span class="n">WriteToFileLog</span><span class="p">();</span>
<span class="cp">#endif</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nested preprocessing statements starting with “#” can be indented and
aligned based on indentation requirements to different layers.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(__x86_64__) &amp;&amp; defined(__GCC_HAVE_SYNC_COMPARE_AND_SWAP_16)</span>
    <span class="cp">#define ATOMIC_X86_HAS_CMPXCHG16B 1  </span><span class="c1">// Good: Statements are layered, facilitating reading.</span>
<span class="cp">#else</span>
    <span class="cp">#define ATOMIC_X86_HAS_CMPXCHG16B 0</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="whitespace">
<h2>Whitespace<a class="headerlink" href="#whitespace" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-2-13-ensure-that-horizontal-whitespace-is-used-to-highlight-keywords-important-information-and-avoid-unnecessary-whitespace">
<h3>Rule 2.13 Ensure that horizontal whitespace is used to highlight keywords, important information and avoid unnecessary whitespace.<a class="headerlink" href="#rule-2-13-ensure-that-horizontal-whitespace-is-used-to-highlight-keywords-important-information-and-avoid-unnecessary-whitespace" title="Permalink to this headline">¶</a></h3>
<p>Horizontal spaces should be used to highlight keywords and important
information. Do not add spaces at the end of each line of code. The
general rules are as follows:</p>
<ul class="simple">
<li><p>Add spaces after keywords such as if, switch, case, do, while, and
for.</p></li>
<li><p>Do not add spaces after the left parenthesis or before the right
parenthesis.</p></li>
<li><p>Add a space before and after each binary operator (= + - &lt; &gt; * / %
| &amp; ^ &lt;= &gt;= == !=).</p></li>
<li><p>Do not add a space after any unary operator (&amp; * + - ~!).</p></li>
<li><p>A space is required before and after each ternary operator (? :).</p></li>
<li><p>Add spaces before and after the colon of bit field description.</p></li>
<li><p>There is no space between ++/– and variables.</p></li>
<li><p>There is no space before and after the struct member operator (. -&gt;).</p></li>
<li><p>Adding or not adding spaces inside the brace must be consistent.</p></li>
<li><p>Do not add spaces before commas, semicolons, colons (without the
colon in the ternary operator or the bit field description); Add
spaces after them.</p></li>
<li><p>There is no space between the parentheses of the function parameter
list and the function name.</p></li>
<li><p>There is no space between the parenthesis of the type cast and the
object being converted.</p></li>
<li><p>There is no space between the square bracket of the array and the
array name.</p></li>
<li><p>Spaces at the end of the line can be omitted.</p></li>
</ul>
<p>For spaces inside the braces, the following are <strong>recommended</strong>:</p>
<ul class="simple">
<li><p>In general, spaces should be added after the left brace or before the
right brace.</p></li>
<li><p>For empty, or a single identifier, or a single literal constant,
spaces are not required. Such as: ‘{}’, ‘{0}’, ‘{NULL}’, ‘{“hi”}’.</p></li>
<li><p>Spaces between consecutively nested multiple parentheses, spaces are
not required. Such as: ‘{{0}}’, ‘{{ 1, 2 }}’. Bad example: ‘{ 0,
{1}}’. It is not a continuous nested scene, and the spaces inside the
outermost braces are inconsistent.</p></li>
</ul>
<p>In normal cases:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                  <span class="c1">// Good: When the variable is initialized, there should be spaces before and after the =. Do not leave a space before the semicolon.</span>
<span class="kt">int</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>    <span class="c1">// Good: During array initialization, spaces in curly braces are optional.</span>
<span class="kt">int</span> <span class="n">arr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span> <span class="p">};</span>     <span class="c1">// Good: A space is added before and after the brace.</span>
</pre></div>
</div>
<p>Function definition and call:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">);</span>
                      <span class="o">^</span>         <span class="c1">// Bad: There should be a space after the comma.</span>

<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="p">);</span>
                 <span class="o">^</span>          <span class="o">^</span>   <span class="c1">// Bad: No space should be added to either side in the parentheses.</span>
</pre></div>
</div>
<p>Pointer and address-of operator:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>     <span class="c1">// Good: There is no space between the operator * and the pointer p.</span>
<span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">;</span>     <span class="c1">// Good: There is no space between the operator &amp; and the variable x.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>    <span class="c1">// Good: When a member variable is accessed through the operator (.), no space is added.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>   <span class="c1">// Good: When a member variable is accessed through the operator (.), no space is added.</span>
</pre></div>
</div>
<p>Operator:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    <span class="c1">// Good: A space must be added before and after the assignment operator (=).</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">-5</span><span class="p">;</span>   <span class="c1">// Good: Do not add spaces before the minus sign (-) and the number.</span>
<span class="o">++</span><span class="n">x</span><span class="p">;</span>      <span class="c1">// Good: Do not add spaces before the minus sign (-) and the number.</span>
<span class="n">x</span><span class="o">--</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">y</span><span class="p">)</span>        <span class="c1">// Good: A space must be added before and after the Boolean operator. Do not leave spaces between the ! operator and variables.</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">/</span> <span class="n">z</span><span class="p">;</span>  <span class="c1">// Good: A space must be added before and after binary operators.</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">z</span><span class="p">);</span>    <span class="c1">// Good: No space is required before and after the expression in the parentheses.</span>
</pre></div>
</div>
<p>Loops and conditional statements:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span>    <span class="c1">// Good: A space is added between the if keyword and the parenthesis and no space is added before or after the conditional statement inside the parentheses.</span>
    <span class="p">...</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>            <span class="c1">// Good: A space is added between the else keyword and the curly brace.</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">while</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{}</span>    <span class="c1">// Good: A space is added between the while keyword and the parenthesis. No space is added before or after the conditional statement inside the parentheses.</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">someRange</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// Good: A space is added between the for keyword and the parenthesis, and after the semicolons (;).</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">switch</span> <span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// Good: A space is added after the switch keyword.</span>
    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>     <span class="c1">// Good: No space is added between the case conditional statement and the colon.</span>
        <span class="p">...</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">...</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="p">...</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note: Current integrated development environments (IDEs) and code
editors can be set to automatically delete spaces at the end of a line.
Please configure your editor as such.</p>
</div>
<div class="section" id="rec-2-4-arrange-blank-lines-reasonably-keep-the-code-compact">
<h3>Rec 2.4 Arrange blank lines reasonably keep the code compact.<a class="headerlink" href="#rec-2-4-arrange-blank-lines-reasonably-keep-the-code-compact" title="Permalink to this headline">¶</a></h3>
<p>Reduce unnecessary blank lines so that more code can be displayed for
easy reading. The following rules are recommended:</p>
<ul class="simple">
<li><p>Make a reasonable arrangement of blank lines according to the degree
of relevance of neighboring content.</p></li>
<li><p>Do not put two or more consecutive blank lines inside a function, a
type definition, a macro, or an initialization expression.</p></li>
<li><p>Do not use <strong>three</strong> or more consecutive blank lines.</p></li>
<li><p>Do not add blank lines at the start and end of a code block defined
by braces.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span> <span class="o">=</span> <span class="n">DoSomething</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="n">OK</span><span class="p">)</span> <span class="p">{</span>    <span class="c1">// Bad: Return value judgment should follow the function call.</span>
    <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>       <span class="c1">// Bad: Use no more than two continuous blank lines.</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

    <span class="n">DoSomething</span><span class="p">();</span>  <span class="c1">// Bad: The blank lines above and below are unnecessary.</span>
    <span class="p">...</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comments">
<h1>3 Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">Generally, clear architecture and good symbol naming are recommended
to improve code readability, and comments are provided only when
necessary.</div>
<div class="line">Comments help readers quickly understand code. Therefore, <strong>comments
should be provided when necessary</strong> for the sake of readers.</div>
</div>
<p>The comments must be concise, clear, and unambiguous, ensuring that the
information is complete and not redundant.</p>
<div class="line-block">
<div class="line"><strong>Comments are as important as code.</strong></div>
<div class="line">When writing a comment, you need to step into the reader’s shoes and
use comments to express what the reader really needs. Comments are
used to express the function and intention of code, rather than
repeating code.</div>
<div class="line">When modifying the code, ensure that the comments are consistent. It
is impolite to only modify code and not update the comments. It
destroys the consistency between code and comments, and may confuse or
even mislead readers.</div>
</div>
<p>Comment code in fluent English.</p>
<div class="section" id="comment-style">
<h2>Comment Style<a class="headerlink" href="#comment-style" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">In C code, both <code class="docutils literal notranslate"><span class="pre">/*</span></code> <code class="docutils literal notranslate"><span class="pre">*/</span></code> and <code class="docutils literal notranslate"><span class="pre">//</span></code> can be used.</div>
<div class="line">Comments can be classified into different types depending on purpose
and position, such as file header comments, function header comments,
and general comments.</div>
<div class="line">Comments of the same type must keep a consistent style.</div>
</div>
<p>Note: The sample code used in this article sees extensive use of the
‘//’ post-comment. This is only to aid understanding, and does not mean
that this comment style is better.</p>
</div>
<div class="section" id="file-header-comments">
<h2>File Header Comments<a class="headerlink" href="#file-header-comments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-3-1-file-header-comments-must-contain-the-copyright-license">
<h3>Rule 3.1 File header comments must contain the copyright license.<a class="headerlink" href="#rule-3-1-file-header-comments-must-contain-the-copyright-license" title="Permalink to this headline">¶</a></h3>
<p>/*</p>
<ul class="simple">
<li><p>Copyright (c) 2020 Huawei Device Co., Ltd.</p></li>
<li><p>Licensed under the Apache License, Version 2.0 (the “License”);</p></li>
<li><p>you may not use this file except in compliance with the License.</p></li>
<li><p>You may obtain a copy of the License at</p></li>
<li><p>​</p></li>
<li><p><a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p></li>
<li><p>​</p></li>
<li><p>Unless required by applicable law or agreed to in writing, software</p></li>
<li><p>distributed under the License is distributed on an “AS IS” BASIS,</p></li>
<li><p>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied.</p></li>
<li><p>See the License for the specific language governing permissions and</p></li>
<li><p>limitations under the License. */</p></li>
</ul>
</div>
</div>
<div class="section" id="function-header-comments">
<h2>Function Header Comments<a class="headerlink" href="#function-header-comments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-3-2-empty-function-header-comments-with-no-content-are-forbidden">
<h3>Rule 3.2 Empty function header comments with no content are forbidden.<a class="headerlink" href="#rule-3-2-empty-function-header-comments-with-no-content-are-forbidden" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Not all functions need function header comments.</div>
<div class="line">Function header comments must be added for any information that cannot
be expressed just with function prototype.</div>
</div>
<div class="line-block">
<div class="line">Function header comments are placed above the function declaration or
definition.</div>
<div class="line">Select and use one of the following styles:</div>
<div class="line"><strong>Use ‘//’ to start the function header.</strong></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Single-line function header</span>
<span class="kt">int</span> <span class="nf">Func1</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="c1">// Multi-line function header</span>
<span class="c1">// Second line</span>
<span class="kt">int</span> <span class="nf">Func2</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Use ‘/*’ ‘*/’ to start the function header.</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Single-line function header */</span>
<span class="kt">int</span> <span class="nf">Func1</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Single-line or multi-line function header</span>
<span class="cm"> * Second line</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">Func2</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Use function names to describe functions, and only add function header
comments if necessary.</div>
<div class="line">Do not write useless or redundant function headers. Do not write empty
function headers with no content.</div>
</div>
<div class="line-block">
<div class="line">The function header comment content is <strong>optional</strong> any may include
the following: function description, return value, performance
constraint, usage, memory convention, algorithm implementation, and
reentering requirements.</div>
<div class="line">In the function interface declaration in the external header file of
the module, the function header comment should clearly describe
important and useful information.</div>
</div>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * The number of written bytes is returned. If -1 is returned, the write operation fails.</span>
<span class="cm"> * Note that, the memory buffer is released by the caller.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">WriteString</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
</pre></div>
</div>
<p>Bad example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Function name: WriteString</span>
<span class="cm"> * Function: Write a character string.</span>
<span class="cm"> * Parameter:</span>
<span class="cm"> * Return value:</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">WriteString</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
</pre></div>
</div>
<p>Problems in the preceding example are as follows:</p>
<ul class="simple">
<li><p>The ‘Parameter’ and ‘Return value’ headings have no content.</p></li>
<li><p>The function name has redundant information.</p></li>
<li><p>The most important thing, the notice to release the buffer, is not
clearly stated.</p></li>
</ul>
</div>
</div>
<div class="section" id="code-comments">
<h2>Code Comments<a class="headerlink" href="#code-comments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-3-3-code-comments-are-placed-above-or-to-the-right-of-the-corresponding-code">
<h3>Rule 3.3 Code comments are placed above or to the right of the corresponding code.<a class="headerlink" href="#rule-3-3-code-comments-are-placed-above-or-to-the-right-of-the-corresponding-code" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="rule-3-4-there-must-be-a-space-between-the-comment-character-and-the-comment-content-at-least-one-space-is-required-between-the-comment-and-code-if-the-comment-is-placed-to-the-right-of-code">
<h3>Rule 3.4 There must be a space between the comment character and the comment content. At least one space is required between the comment and code if the comment is placed to the right of code.<a class="headerlink" href="#rule-3-4-there-must-be-a-space-between-the-comment-character-and-the-comment-content-at-least-one-space-is-required-between-the-comment-and-code-if-the-comment-is-placed-to-the-right-of-code" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Comments placed above code should be indented to the same level as the
code.</div>
<div class="line">Select and use one of the following styles:</div>
<div class="line"><strong>Use ‘//’ to start the comment.</strong></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Single-line comment</span>
<span class="n">DoSomething</span><span class="p">();</span>

<span class="c1">// Multi-line comment</span>
<span class="c1">// Second line</span>
<span class="n">DoSomething</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>Use ‘/*’ ‘*/’ to start the comment.</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*Single-line comment */</span>
<span class="n">DoSomething</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm"> * Single-/Multi-line comment</span>
<span class="cm"> * Second line</span>
<span class="cm"> */</span>
<span class="n">DoSomething</span><span class="p">();</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Leave at least one space between the code and the comment on the
right. No more than four spaces is recommended.</div>
<div class="line">You can use the extended Tab key to indent 1-4 spaces.</div>
</div>
<p>Select and use one of the following styles:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">foo</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>  <span class="c1">// Comment on the right</span>
<span class="kt">int</span> <span class="n">bar</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>  <span class="cm">/* Comment on the right */</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">It is more appealing sometimes when the comment is placed to the right
of code and the comments and code are aligned vertically.</div>
<div class="line">After the alignment, ensure that the comment is 1–4 spaces separated
from the closest code line on the left.</div>
<div class="line">Example:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define A_CONST 100         </span><span class="cm">/* Related comments of the same type can be aligned vertically. */</span><span class="cp"></span>
<span class="cp">#define ANOTHER_CONST 200   </span><span class="cm">/* Leave spaces after code to align comments vertically. */</span><span class="cp"></span>
</pre></div>
</div>
<p>If the comment on the right exceeds the permitted line length, the
comment can be placed above the code.</p>
</div>
<div class="section" id="rule-3-5-delete-unused-code-segments-do-not-comment-them-out">
<h3>Rule 3.5 Delete unused code segments. Do not comment them out.<a class="headerlink" href="#rule-3-5-delete-unused-code-segments-do-not-comment-them-out" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Code that is commented out cannot be maintained. If you attempt to
restore the code, it is very likely to introduce ignorable defects.</div>
<div class="line">The correct method is to delete unnecessary code. If necessary,
consider porting or rewriting the code.</div>
</div>
<p>Here, commenting out refers to the removal of code from compilation
without actually deleting it. This is done by using /* */, //, #if 0,
#ifdef NEVER_DEFINED, and so on.</p>
</div>
<div class="section" id="rec-3-1-no-todo-tbd-or-fixme-comment-is-allowed-in-code-delivered-to-a-customer">
<h3>Rec 3.1 No TODO, TBD, or FIXME comment is allowed in code delivered to a customer.<a class="headerlink" href="#rec-3-1-no-todo-tbd-or-fixme-comment-is-allowed-in-code-delivered-to-a-customer" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">TODO and TBD comments are used to describe required improvements and
supplements.</div>
<div class="line">FIXME comments are used to describe defects that need fixing.</div>
<div class="line">They should have a standardized style, which facilitates text search.
For example:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// TODO(&lt;author-name&gt;): Supplement to XX</span>
<span class="c1">// FIXME: XX defect</span>
</pre></div>
</div>
<p>During version development, this type of comments can be used for
highlighting, and must be processed and deleted before delivery.</p>
</div>
<div class="section" id="rec-3-2-if-break-or-return-is-not-added-to-the-end-of-the-case-statement-block-fall-through-comments-must-be-provided">
<h3>Rec 3.2 If ‘break’ or ‘return’ is not added to the end of the case statement block (fall-through), comments must be provided.<a class="headerlink" href="#rec-3-2-if-break-or-return-is-not-added-to-the-end-of-the-case-statement-block-fall-through-comments-must-be-provided" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Sometimes, the same thing is needed for multiple case tags. When a
case statement ends without ‘break’ or ‘return’, the statement in the
next case tag will be executed. This is called “fall-through”.</div>
<div class="line">In this case, you need to add comments for the “fall-through” to
clearly describe your intention.</div>
</div>
<p>For example, explicitly specify the “fall-through”:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
        <span class="n">DoSomething</span><span class="p">();</span>
        <span class="cm">/* fall-through */</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="n">DoSomeOtherThing</span><span class="p">();</span>
        <span class="p">...</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="n">DoNothing</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the case statement is empty, the comment explaining the
“fall-through” can be omitted.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="n">DoSomething</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="n">DoNothing</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="header-files">
<h1>4 Header Files<a class="headerlink" href="#header-files" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line"><strong>For the C language, the design of the header file reflects most of
the system design.</strong></div>
<div class="line">The correct use of the header file makes code more readable, reduces
file size, and speeds up compilation and build performance.</div>
</div>
<p>This chapter summarizes some methods from the perspective of programming
specifications to help you properly plan header files.</p>
<div class="section" id="header-file-responsibility">
<h2>Header File Responsibility<a class="headerlink" href="#header-file-responsibility" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">A header file is an external interface of a module or file.</div>
<div class="line">The interface declaration for most functions (except inline
functions), is more suitable in the header file, than as interface
implementations.</div>
<div class="line">Header responsibility should be simple. A complex header file will
make dependencies complex and cause long compilation times.</div>
</div>
<div class="section" id="rec-4-1-each-c-file-must-have-a-corresponding-h-file-which-is-used-to-declare-the-interfaces-that-need-to-be-disclosed-externally">
<h3>Rec 4.1 Each .c file must have a corresponding .h file, which is used to declare the interfaces that need to be disclosed externally.<a class="headerlink" href="#rec-4-1-each-c-file-must-have-a-corresponding-h-file-which-is-used-to-declare-the-interfaces-that-need-to-be-disclosed-externally" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Generally, each .c file has a corresponding .h file (Not necessarily
the same name.), which is used to store the function declarations,
macro definitions, and type definitions that are to be exposed
externally.</div>
<div class="line">If a .c file does not need to open any interface externally, it should
not exist.</div>
</div>
<p>Exception: the entry point of the program (for example, the file where
the main function is located), unit test code, and dynamic library code.</p>
<div class="line-block">
<div class="line">Example:</div>
<div class="line">foo.h content</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef FOO_H</span>
<span class="cp">#define FOO_H</span>

<span class="kt">int</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>  <span class="c1">// Good: Declare an external interface in the header file.</span>

<span class="cp">#endif</span>
</pre></div>
</div>
<p>foo.c content</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="n">Bar</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>  <span class="c1">// Good: The declaration of the internal function is placed in the header of the .c file, declaring its static scope.</span>

<span class="kt">void</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Bar</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">Bar</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Do something;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Internally used functions declarations, macros, enumerations,
structures, and others should not be placed in header ﬁles.</p>
<div class="line-block">
<div class="line">In some products, one .c file corresponds to two .h files. One is used
to store external public interfaces, and the other is used to store
definitions and declarations among others for internal use to limit
the number of code lines in the .c file.</div>
<div class="line">This style is not recommended. It is used only because the .c file is
too large. It should be split into another file instead.</div>
<div class="line">In addition, if private definitions and declarations are placed in
independent header files, they technically cannot avoid inclusion.</div>
</div>
<div class="line-block">
<div class="line">This rule, in turn, is not necessarily correct. For example:</div>
<div class="line">Some simple header files, such as the command ID definition header
file, do not need to have the corresponding .c file.</div>
<div class="line">If a set of interface protocols has multiple instances and the
interface is fixed, one .h file can have multiple .c files.</div>
</div>
</div>
<div class="section" id="rec-4-2-use-h-as-the-extension-of-the-header-file-rather-than-other-unconventional-extensions-for-example-inc">
<h3>Rec 4.2 Use .h as the extension of the header file, rather than other unconventional extensions, for example, .inc.<a class="headerlink" href="#rec-4-2-use-h-as-the-extension-of-the-header-file-rather-than-other-unconventional-extensions-for-example-inc" title="Permalink to this headline">¶</a></h3>
<p>Some products use .inc as the header file name extension, which does not
comply with the C language. A header ﬁle using .inc as the ﬁle name
extension usually indicates a private header ﬁle. However, in practice,
this recommendation is not followed properly. An .inc ﬁle is generally
contained in multiple .c ﬁles. This document does not recommend that
private definitions be stored in header files. For details, see <a class="reference external" href="#a4-1">Rec
4.1</a>.</p>
</div>
</div>
<div class="section" id="header-file-dependency">
<h2>Header File Dependency<a class="headerlink" href="#header-file-dependency" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">The header file contains a dependency, and the dependency should be
stable.</div>
<div class="line">Generally, an unstable module depends on a stable module. When the
unstable module changes, the build of the stable module is not
affected.</div>
</div>
<p>Dependency direction is as follows: Products depend on the platform, and
the platform depends on the standard library.</p>
<div class="line-block">
<div class="line">In addition to unstable modules depending on stable modules, each
module depends on the interface. In this way, in case of any internal
implementation changes to one module, users do not need to recompile
another module.</div>
<div class="line">This assumes that the interface itself is the most stable.</div>
</div>
<div class="section" id="rule-4-1-forbid-cyclic-dependency-of-header-files">
<h3>Rule 4.1 Forbid cyclic dependency of header files.<a class="headerlink" href="#rule-4-1-forbid-cyclic-dependency-of-header-files" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Cyclic dependency (also known as a circular dependency) of header
files means that a.h contains b.h, b.h contains c.h, and c.h contains
a.h. If any header file is modified, all code containing a.h, b.h, and
c.h needs to be recompiled.</div>
<div class="line">For a unidirectional dependency: a.h contains b.h, b.h contains c.h,
and c.h does not contain any header file, modifying a.h does not mean
a need to recompile the source code for b.h or c.h.</div>
</div>
<p>The cyclic dependency of header files reflects an obviously unreasonable
architecture design, which can be avoided through optimization.</p>
</div>
<div class="section" id="rule-4-2-the-header-file-must-have-the-internal-include-protection-character-define-protection">
<h3>Rule 4.2 The header file must have the internal #include protection character (#define protection).<a class="headerlink" href="#rule-4-2-the-header-file-must-have-the-internal-include-protection-character-define-protection" title="Permalink to this headline">¶</a></h3>
<p>To prevent header files from being included multiple times, all header
files should be protected by #define. Do not use #pragma once.</p>
<p>When defining a protection character, comply with the following rules:</p>
<ul class="simple">
<li><p>The protection character uses a unique name. It is recommended to
consider the file path and name below the top layer of the project
code tree.</p></li>
<li><p>Do not place code or comments before or after the protected part,
except for file header comments.</p></li>
</ul>
<p>Assume that the path to timer.h of the timer module is
<code class="docutils literal notranslate"><span class="pre">timer/include/timer.h</span></code>. If the protection character resembles
‘TIME_H’, it is not unique. Add a path, for example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef TIMER_INCLUDE_TIMER_H</span>
<span class="cp">#define TIMER_INCLUDE_TIMER_H</span>

<span class="p">...</span>

<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="section" id="rule-4-3-do-not-reference-external-function-interfaces-and-variables-by-using-declaration">
<h3>Rule 4.3 Do not reference external function interfaces and variables by using declaration.<a class="headerlink" href="#rule-4-3-do-not-reference-external-function-interfaces-and-variables-by-using-declaration" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">You can use the interfaces provided by other modules or files only by
using header files.</div>
<div class="line">Using external function interfaces and variables with an extern
declaration may cause inconsistency between declarations and
definitions when external interfaces are changed.</div>
<div class="line">In addition, this kind of implicit dependency may cause architecture
corruption.</div>
</div>
<div class="line-block">
<div class="line">Cases that do not comply with specifications:</div>
<div class="line">a.c content</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="kt">int</span> <span class="n">Foo</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>   <span class="c1">// Bad: Reference external functions by using the extern declaration.</span>
<span class="kt">void</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">();</span>  <span class="c1">// Here, the external interface Foo is used.</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">It should be changed to:</div>
<div class="line">a.c content</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;b.h&quot;</span><span class="c1">      // Good: Use the interface providing the interface.</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">();</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>b.h content</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>b.c content</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Do something</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In some scenarios, if internal functions need to be referenced with no
intrusion to the code, the extern declaration mode can be used.</div>
<div class="line">For example:</div>
<div class="line">When performing unit testing on an internal function, you can use the
extern declaration to reference the tested function.</div>
<div class="line">When a function needs to be stubbed or patched, the function can be
declared using extern.</div>
</div>
</div>
<div class="section" id="rule-4-4-do-not-include-header-files-in-extern-c">
<h3>Rule 4.4 Do not include header files in extern “C”.<a class="headerlink" href="#rule-4-4-do-not-include-header-files-in-extern-c" title="Permalink to this headline">¶</a></h3>
<p>If a header file is included in extern “C”, extern “C” may be nested.
Some compilers restrict the nesting of extern “C”. If there are too many
nested layers, compilation errors may occur.</p>
<p>extern “C” usually occurs in mixed programming using both C and C++. If
the extern “C” includes a header file, the original intent behind the
header file may be hindered. For example, when the linkage
specifications are modified incorrectly.</p>
<div class="line-block">
<div class="line">For example, assume that there are two header files a.h and b.h.</div>
<div class="line">a.h content</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="cp">#ifdef __cplusplus</span>
<span class="kt">void</span> <span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="cp">#define A(value) Foo(value)</span>
<span class="cp">#else</span>
<span class="kt">void</span> <span class="n">A</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>b.h content</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="cp">#ifdef __cplusplus</span>
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<span class="cp">#endif</span>

<span class="cp">#include</span> <span class="cpf">&quot;a.h&quot;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">B</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Using the C++ preprocessor to expand b.h, the following information is
displayed:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">Foo</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">B</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the a.h file, the function Foo is intended to be a C++ free function
following the C++ specifications. However, in the b.h file, because
<code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;a.h&quot;</span></code> is placed inside <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code>, the linking
specification of function Foo is changed incorrectly.</p>
<p>Exception: In the C++ compilation environment, if you want to reference
a header file written in pure C, a non-intrusive approach is to exclude
the C header file from <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="functions">
<h1>5 Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h1>
<p>Functions help avoid repeated code and increase reusability. In
addition, functions act to layer code and reduce code complexity, hiding
implementation details, making programs more modular, and facilitating
reading and maintenance.</p>
<div class="line-block">
<div class="line">The function should be concise and short.</div>
<div class="line">One function completes only one thing.</div>
</div>
<div class="section" id="function-design">
<h2>Function Design<a class="headerlink" href="#function-design" title="Permalink to this headline">¶</a></h2>
<p>Writing clean functions and organizing code effectively is the essence
of good function design. The code should be simple and not conceal the
designer’s intention, using clean abstractions and straightforward
control statements to organize the function naturally.</p>
<div class="section" id="rule-5-1-avoid-long-functions-and-ensure-that-functions-contain-no-more-than-50-lines-not-including-blank-lines-and-comments">
<h3>Rule 5.1 Avoid long functions and ensure that functions contain no more than 50 lines (not including blank lines and comments).<a class="headerlink" href="#rule-5-1-avoid-long-functions-and-ensure-that-functions-contain-no-more-than-50-lines-not-including-blank-lines-and-comments" title="Permalink to this headline">¶</a></h3>
<p>A function should fit on one screen, (be no longer than 50 lines), do
only one thing, and do it well.</p>
<p>Large functions are often caused by the fulfillment of more than one
purpose by the function, or over complication when parts could be
abstracted.</p>
<div class="line-block">
<div class="line">Exception:</div>
<div class="line">Considering the code’s aggregation and functionality, some functions
may exceed 50 lines, but only if the code is readable and concise.</div>
<div class="line">These exceptions should be minimal, such as specific algorithm
processing.</div>
</div>
<div class="line-block">
<div class="line">Even if a large function works well in the moment, once someone
modifies it, new problems may occur. It may even cause bugs that are
difficult to discover.</div>
<div class="line">It is recommended that you split it into several simpler and easier to
manage functions, facilitating reading and modification of code.</div>
</div>
</div>
<div class="section" id="rule-5-2-avoid-nesting-a-code-block-more-than-four-times-within-a-function">
<h3>Rule 5.2 Avoid nesting a code block more than four times within a function.<a class="headerlink" href="#rule-5-2-avoid-nesting-a-code-block-more-than-four-times-within-a-function" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The nested code block depth of a function refers to the layered depth
of a code control block (created by statements such as: if, for,
while, and switch).</div>
<div class="line">Each layer of nesting increases the brain power required to read the
code, because you need to maintain a “stack” in your mind comprised of
each conditional statement, loop, and so on.</div>
<div class="line">Code should be broken down functionally to prevent the reader from
remembering too much context at a time.</div>
</div>
<div class="line-block">
<div class="line">Using <code class="docutils literal notranslate"><span class="pre">guardian</span> <span class="pre">statements</span></code>, (a short conditional return), can
effectively reduce the nesting layers of if statements. For example:</div>
<div class="line">The original code nesting level is 3:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Foo</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">received</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">GetMsgType</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">!=</span> <span class="n">UNKNOWN</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">DealMsg</span><span class="p">(...);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Refactored code using the <code class="docutils literal notranslate"><span class="pre">guardian</span> <span class="pre">statement</span></code>, the nesting level is
2:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Foo</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">received</span><span class="p">)</span> <span class="p">{</span>    <span class="c1">// Good: Use the &#39;guardian statement&#39;.</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">type</span> <span class="o">=</span> <span class="n">GetMsgType</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">UNKNOWN</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">DealMsg</span><span class="p">(..);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Exception:</div>
<div class="line">Considering the code’s aggregation and functionality, some functions
may exceed 4 times nested, but only if the code is readable and
concise.</div>
<div class="line">These exceptions should be rare.</div>
</div>
</div>
<div class="section" id="rec-5-1-process-all-returned-error-codes">
<h3>Rec 5.1 Process all returned error codes.<a class="headerlink" href="#rec-5-1-process-all-returned-error-codes" title="Permalink to this headline">¶</a></h3>
<p>A function (in a standard library, a third-party library, or a
user-defined function) must be able to indicate errors. This can be done
by using error tags, special return data, or other means. No matter when
a function provides such a mechanism, the caller should immediately
check the error indication after the function returns.</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">fileHead</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="n">ReadFileHead</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileHead</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fileHead</span><span class="p">));</span> <span class="c1">// Bad: The returned value is not checked.</span>

<span class="n">DealWithFileHead</span><span class="p">(</span><span class="n">fileHead</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fileHead</span><span class="p">));</span>       <span class="c1">// The &#39;fileHead&#39; is possibly invalid.</span>
</pre></div>
</div>
<p>The correct format is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">fileHead</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">ReadFileHead</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileHead</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fileHead</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="n">OK</span><span class="p">)</span> <span class="p">{</span>                <span class="c1">// Good: Ensure that the &#39;fileHead&#39; is written.</span>
    <span class="k">return</span> <span class="n">ERROR</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">DealWithFileHead</span><span class="p">(</span><span class="n">fileHead</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fileHead</span><span class="p">));</span>       <span class="c1">// Process the file header.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Note that when the return value of a function is ignored and instead
void is returned frequently, consider whether the return value of the
function is designed reasonably.</div>
<div class="line">Only if the caller of a function really doesn’t need a return value,
should you design the function to return <code class="docutils literal notranslate"><span class="pre">void</span></code>.</div>
</div>
</div>
</div>
<div class="section" id="function-parameters">
<h2>Function Parameters<a class="headerlink" href="#function-parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rec-5-2-use-the-return-value-instead-of-the-output-parameter-when-designing-a-function">
<h3>Rec 5.2 Use the return value instead of the output parameter when designing a function.<a class="headerlink" href="#rec-5-2-use-the-return-value-instead-of-the-output-parameter-when-designing-a-function" title="Permalink to this headline">¶</a></h3>
<p>Using return values rather than output parameters improves readability
and usually provides the same or better performance.</p>
<p>Readability can be improved by naming functions such as GetXxx, FindXxx,
or directly using a single noun, to directly return the corresponding
object.</p>
</div>
<div class="section" id="rec-5-3-use-strongly-typed-parameters-and-avoid-using-void">
<h3>Rec 5.3 Use strongly typed parameters and avoid using void*<a class="headerlink" href="#rec-5-3-use-strongly-typed-parameters-and-avoid-using-void" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">While different languages have their own views on strong typing and
weak typing, it is generally believed that C/C++ is a strongly typed
language. Since we use such a strongly typed language, we should keep
this style.</div>
<div class="line">The advantage of this strongly typed style is to prevent evasive
errors by catching errors at the compilation stage.</div>
</div>
<p>Strong types help the compiler find more errors for us. Pay attention to
the usage of the <code class="docutils literal notranslate"><span class="pre">FooListAddNode</span></code> function in the following code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">FooNode</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="nc">List</span> <span class="n">link</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">foo</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">BarNode</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="nc">List</span> <span class="n">link</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">bar</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">FooListAddNode</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span> <span class="c1">// Bad: Here, the void * type is used to pass parameters.</span>
<span class="p">{</span>
    <span class="n">FooNode</span> <span class="o">*</span><span class="n">foo</span> <span class="o">=</span> <span class="p">(</span><span class="n">FooNode</span> <span class="o">*</span><span class="p">)</span><span class="n">node</span><span class="p">;</span>
    <span class="n">ListAppend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_fooList</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">link</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">MakeTheList</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="n">FooNode</span> <span class="o">*</span><span class="n">foo</span><span class="p">;</span>
    <span class="n">BarNode</span> <span class="o">*</span><span class="n">bar</span><span class="p">;</span>
    <span class="p">...</span>

    <span class="n">FooListAddNode</span><span class="p">(</span><span class="n">bar</span><span class="p">);</span>        <span class="c1">// Wrong: In this example, the foo parameter was supposed to be passed, but the bar parameter is incorrectly passed instead. No error is reported immediately and issues may occur as a result.</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The preceding problems may be difficult to expose and are more
destructive than compiler errors.</div>
<div class="line">If the parameter type of <code class="docutils literal notranslate"><span class="pre">FooListAddNode</span></code> is specified clearly,
instead of with the <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code> type, the preceding problem can be
detected during compilation.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">FooListAddNode</span><span class="p">(</span><span class="n">FooNode</span> <span class="o">*</span><span class="n">foo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ListAppend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_fooList</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">link</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Exception: For some generic interfaces, you can use the input parameter
<code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code> to pass different types of pointers.</p>
</div>
<div class="section" id="it-is-the-callers-responsibility-to-check-the-validity-of-internal-function-parameters-of-a-module">
<h3>It is the caller’s responsibility to check the validity of internal function parameters of a module.<a class="headerlink" href="#it-is-the-callers-responsibility-to-check-the-validity-of-internal-function-parameters-of-a-module" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Validity checks must be performed on data received from external
modules to protect programs against illegal input.</div>
<div class="line">When calling internal functions, by default, the caller is responsible
for ensuring the validity of any returned data. If the callee takes
responsibility for checking data validity, checks may be performed
multiple times and redundant code is generated. This is not concise.</div>
</div>
<div class="line-block">
<div class="line">The caller ensures the validity of any received data. This type of
contractual programming can make logic simpler and code more readable.</div>
<div class="line">Example:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">SomeProc</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">dataOK</span> <span class="o">=</span> <span class="n">GetData</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>       <span class="c1">// Get data.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dataOK</span><span class="p">)</span> <span class="p">{</span>                      <span class="c1">// Check the result of the previous step ensuring data validity.</span>
        <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">DealWithData</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>                 <span class="c1">// Call the data processing function.</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">DealWithData</span><span class="p">(</span><span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">MIN</span> <span class="o">||</span> <span class="n">data</span> <span class="o">&gt;</span> <span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>     <span class="c1">// Bad: The caller has already ensured the validity of the data.</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="rec-5-5-the-pointer-argument-of-a-function-should-be-declared-as-const-if-it-is-not-used-to-modify-the-pointed-object">
<h3>Rec 5.5 The pointer argument of a function should be declared as ‘const’ if it is not used to modify the pointed object.<a class="headerlink" href="#rec-5-5-the-pointer-argument-of-a-function-should-be-declared-as-const-if-it-is-not-used-to-modify-the-pointed-object" title="Permalink to this headline">¶</a></h3>
<p>The const pointer argument, which restricts the function from modifying
the object through the pointer, makes code stronger and safer.</p>
<p>Example: In the example of the strncmp in the 7.21.4.4 of the C99
standard, the invariant parameter is declared as const.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">strncmp</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s2</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span> <span class="c1">// Good: The invariant parameter is declared as const.</span>
</pre></div>
</div>
<p>Note: Whether or not the pointer parameter is to be declared as ‘const’
depends on the function design, not on whether there is a “modify
object” action in the function entity.</p>
</div>
<div class="section" id="rec-5-6-ensure-that-the-number-of-parameters-in-a-function-is-less-than-or-equal-to-5">
<h3>Rec 5.6 Ensure that the number of parameters in a function is less than or equal to 5.<a class="headerlink" href="#rec-5-6-ensure-that-the-number-of-parameters-in-a-function-is-less-than-or-equal-to-5" title="Permalink to this headline">¶</a></h3>
<p>If a function has too many parameters, the function is easy to be
affected by changes in external code, hindering maintenance. Too many
function parameters will also increases the workload for testing.</p>
<p>The number of parameters in a function must not exceed 5. If the number
of parameters exceeds 5, consider the following:</p>
<ul class="simple">
<li><p>Check whether the function can be split.</p></li>
<li><p>Check whether any related parameters can be combined and defined as a
struct.</p></li>
</ul>
</div>
</div>
<div class="section" id="inline-functions">
<h2>Inline Functions<a class="headerlink" href="#inline-functions" title="Permalink to this headline">¶</a></h2>
<p>An inline function is a function optimization method introduced by C99.
Function inlining can eliminate the overhead of function calls; thanks
to inlining, combination with the called code is implemented, so that
the compiler can achieve further code optimization from a larger
perspective. The inline function is similar to a function-like macro.
For details, see <a class="reference external" href="#a6-1">Rec 6.1</a>.</p>
<div class="section" id="rec-5-7-ensure-that-the-inline-function-contains-no-more-than-10-lines-non-blank-and-non-comment">
<h3>Rec 5.7 Ensure that the inline function contains no more than 10 lines (non-blank and non-comment).<a class="headerlink" href="#rec-5-7-ensure-that-the-inline-function-contains-no-more-than-10-lines-non-blank-and-non-comment" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Defining a function as an inline function generally aims to improve
performance, but it does not always improve performance. If the
function body is short, function inlining can effectively reduce the
size of the target code and improve the function execution efficiency.</div>
<div class="line">Vice versa, if the function body is large, inlining will cause
expansion of the target code, especially when there are many call
points.</div>
<div class="line">It is recommended that inline functions be controlled to within <strong>10</strong>
lines.</div>
</div>
<p>Do not abuse inline functions to improve performance. Avoid premature
optimization. In general, a function can be defined as an inline
function only when actual test data proves that the inlining achieves
higher performance. Functions such as setter and getter functions, that
are short and called frequently can be defined as inline functions.</p>
</div>
<div class="section" id="rule-5-3-define-inline-functions-that-will-be-called-by-multiple-source-files-in-the-header-file">
<h3>Rule 5.3 Define inline functions that will be called by multiple source files in the header file.<a class="headerlink" href="#rule-5-3-define-inline-functions-that-will-be-called-by-multiple-source-files-in-the-header-file" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Inline functions are unfolded in compilation. Therefore, the inline
function definition must be visible in each source file that calls
this function.</div>
<div class="line">As shown in the following code, inline.h has only the declaration of
the <code class="docutils literal notranslate"><span class="pre">SomeInlineFunc</span></code> function but no definition. The other.c file
includes inline.h. As a result, inlining fails when <code class="docutils literal notranslate"><span class="pre">SomeInlineFunc</span></code>
is called.</div>
</div>
<p>inline.h</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kr">inline</span> <span class="kt">int</span> <span class="n">SomeInlineFunc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>inline.c</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kr">inline</span> <span class="kt">int</span> <span class="n">SomeInlineFunc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Implementation code</span>
<span class="p">}</span>
</pre></div>
</div>
<p>other.c</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;inline.h&quot;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">OtherFunc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">SomeInlineFunc</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Due to this restriction, if multiple source files need to call the
same inline function, the definition of the inline function needs to
be placed in the header file.</div>
<div class="line">The inline function implementation in <strong>gnu89</strong> differs from that in
the <strong>C99</strong> standard. For compatibility, you can declare the function
as <strong>static inline</strong>.</div>
</div>
</div>
</div>
</div>
<div class="section" id="macros">
<h1>6 Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h1>
<div class="section" id="function-like-macros">
<h2>Function-like Macros<a class="headerlink" href="#function-like-macros" title="Permalink to this headline">¶</a></h2>
<p>A function-like macro is a macro (as shown in the following example)
similar to a function. It contains several statements to implement a
specific function.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define ASSERT(x) do { \</span>
<span class="cp">    if (!(x)) { \</span>
<span class="cp">        printk(KERN_EMERG &quot;assertion failed %s: %d: %s\n&quot;, \</span>
<span class="cp">              __FILE__, __LINE__, #x); \</span>
<span class="cp">        BUG(); \</span>
<span class="cp">    } \</span>
<span class="cp">} while (0)</span>
</pre></div>
</div>
<div class="section" id="use-functions-instead-of-function-like-macros">
<h3>Use functions instead of function-like macros.<a class="headerlink" href="#use-functions-instead-of-function-like-macros" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Before defining a function-like macro, consider whether it can be
replaced with a function. If so, you are advised to replace macros
with functions.</div>
<div class="line">The disadvantages of the function-like macro are as follows:</div>
</div>
<ul class="simple">
<li><p>Function-like macros haves no type check, which is not as strict as
the function call check. For the example code, see
<a class="reference external" href="#macro_lack_of_type_check__example">Below</a>.</p></li>
<li><p>If macro parameters are not calculated during macro expansion,
unexpected results may be generated. For details, see <a class="reference external" href="#r6-1">Rule
6.1</a> and <a class="reference external" href="#r6-3">Rule 6.3</a>.</p></li>
<li><p>The macro has no independent scope. When it is used together with
control flow statements, unexpected results described in <a class="reference external" href="#r6-2">Rule
6.2</a> may be generated.</p></li>
<li><p>There are high skill requirements on the proper use of macros (see
the following rules), for example, the usage of <code class="docutils literal notranslate"><span class="pre">#</span></code> and parentheses
affects readability.</p></li>
<li><p>Extensions of some macros can only be implemented by specific
compilers in specific scenarios, such as <code class="docutils literal notranslate"><span class="pre">statement</span> <span class="pre">expression</span></code> of
<code class="docutils literal notranslate"><span class="pre">gcc</span></code>, reducing the portability.</p></li>
<li><p>After the macro is expanded at the pre-compilation stage, it is
invisible during subsequent compilation, linking, and debugging.
Macros that contain multiple lines are expanded into a line.
Function-like macros are difficult to debug, interrupt, and locate in
the case of bugs.</p></li>
<li><p>Macros containing a large number of statements must be expanded at
each call point. If there are many call points, the code will be
expanded.</p></li>
</ul>
<p>Example code of a function-like macro lacking type check:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MAX(a, b)   (((a) &lt; (b)) ? (b) : (a))</span>

<span class="kt">int</span> <span class="nf">Max</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="nl">b</span> <span class="p">:</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">TestMacro</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>

    <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;MACRO: max of a(%u) and b(%d) is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">MAX</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">));</span>
    <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;FUNC : max of a(%u) and b(%d) is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">));</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Due to the lack of type check, the comparison between <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> in
<code class="docutils literal notranslate"><span class="pre">MAX</span></code> is changed to a comparison ignoring the sign status. The result
is <strong>a &lt; b</strong>. The output is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MACRO</span><span class="p">:</span> <span class="nb">max</span> <span class="n">of</span> <span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">FUNC</span> <span class="p">:</span> <span class="nb">max</span> <span class="n">of</span> <span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The function does not have the preceding macro disadvantages. However,
compared with macros, the biggest disadvantage is that the execution
efficiency is not as high (increasing the overhead of function calls
and the difficulty of compiler optimization).</div>
<div class="line">Therefore, the C99 standard introduces inline functions (gcc
introduces inline functions ahead of this standard).</div>
</div>
<div class="line-block">
<div class="line">The inline function is similar to the macro, as it is also expanded at
the call point. The difference is that inline functions are expanded
during compilation.</div>
<div class="line">Inline functions have the advantages of both functions and macros:</div>
</div>
<ul class="simple">
<li><p>Strict type checking is performed for inline functions and functions.</p></li>
<li><p>The parameter of an inline function/function is calculated only once.</p></li>
<li><p>Inline functions are unfolded in place and there is no overhead for
function calls.</p></li>
<li><p>Inline functions are better optimized than standard functions.</p></li>
</ul>
<div class="line-block">
<div class="line">For performance-sensitive code, consider using inline functions
instead of function-like macros.</div>
<div class="line">Functions and inline functions cannot completely replace function-like
macros, because function-like macros are more suitable for certain
scenarios.</div>
<div class="line">For example, in a log scenario, using a function-like macro with
variable parameters and default parameters is more convenient.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">ErrLog</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="cp">#define ERR_LOG(fmt, ...) ErrLog(__FILE__, __LINE__, fmt, ##__VA_ARGS__)</span>
</pre></div>
</div>
</div>
<div class="section" id="rule-6-1-when-a-macro-is-defined-macro-parameters-must-use-complete-parentheses">
<h3>Rule 6.1 When a macro is defined, macro parameters must use complete parentheses.<a class="headerlink" href="#rule-6-1-when-a-macro-is-defined-macro-parameters-must-use-complete-parentheses" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The macro parameter is replaced by text only when the macro is
expanded. The value is calculated when the macro is compiled. After
the text replacement, the statements contained in the macro are
combined with called code.</div>
<div class="line">The expression after combination may result in a different result than
expected, especially when the macro parameter is in an expression.</div>
</div>
<p>The following is an incorrect format:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SUM(a, b) a + b         </span><span class="c1">// Bad.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">When the macro is used, the execution result is inconsistent with the
expected result.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">100</span> <span class="pre">/</span> <span class="pre">SUM(2,</span> <span class="pre">8)</span></code> is expanded to <code class="docutils literal notranslate"><span class="pre">(100</span> <span class="pre">/</span> <span class="pre">2)</span> <span class="pre">+</span> <span class="pre">8</span></code>. The expected
result is <code class="docutils literal notranslate"><span class="pre">100</span> <span class="pre">/</span> <span class="pre">(2</span> <span class="pre">+</span> <span class="pre">8)</span></code>.</div>
<div class="line">This problem can be solved by adding parentheses to the entire
expression, as shown in the following:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SUM(a, b) (a + b)       </span><span class="c1">// Bad.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">However, this method has the following problems:</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">SUM(1</span> <span class="pre">&lt;&lt;</span> <span class="pre">2,</span> <span class="pre">8)</span></code> is extended to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;&lt;</span> <span class="pre">(2</span> <span class="pre">+</span> <span class="pre">8)</span></code> (because the
priority of <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> is lower than that of <code class="docutils literal notranslate"><span class="pre">+</span></code>), which is inconsistent
with the expected result <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">&lt;&lt;</span> <span class="pre">2)</span> <span class="pre">+</span> <span class="pre">8</span></code>.</div>
</div>
<p>To solve this problem, add parentheses to each macro parameter, as shown
in the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SUM(a, b) (a) + (b)     </span><span class="c1">// Bad.</span>
</pre></div>
</div>
<p>The third scenario is as follows: <code class="docutils literal notranslate"><span class="pre">SUM(2,</span> <span class="pre">8)</span> <span class="pre">*</span> <span class="pre">10</span></code> . The result after
the extension is <code class="docutils literal notranslate"><span class="pre">(2)</span> <span class="pre">+</span> <span class="pre">((8)</span> <span class="pre">*</span> <span class="pre">10)</span></code>, which is inconsistent with the
expected result <code class="docutils literal notranslate"><span class="pre">(2</span> <span class="pre">+</span> <span class="pre">8)</span> <span class="pre">*</span> <span class="pre">10</span></code>.</p>
<p>In conclusion, the correct format is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SUM(a, b) ((a) + (b))   </span><span class="c1">// Good.</span>
</pre></div>
</div>
<p>But avoid abusing parentheses. As shown in the following, adding
parentheses to a single identifier or a positive number is meaningless.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SOME_CONST      100     </span><span class="c1">// Good: No parentheses needed for a single positive number.</span>
<span class="cp">#define ANOTHER_CONST   (-1)    </span><span class="c1">// Good: Parentheses needed for a negative number.</span>

<span class="cp">#define THE_CONST SOME_CONST    </span><span class="c1">// Good: No parentheses needed for a single identifier.</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>Macro parameters in ‘#’, ‘##’ operation do not need parentheses.</p></li>
<li><p>Macro parameters which participating in string splicing do not need
parentheses.</p></li>
<li><p>If a macro parameter is used as a separate part in one side of an
assignment expression (including +=, -=, etc.), parentheses are not
required.</p></li>
<li><p>If a macro parameter is used as a separate part in comma expressions,
functions or macro call lists, parentheses are not required.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MAKE_STR(x) #x                  </span><span class="c1">// No parentheses for &#39;x&#39;</span>

<span class="cp">#define HELLO_STR(obj) &quot;Hello, &quot; obj    </span><span class="c1">// No parentheses for &#39;obj&#39;</span>

<span class="cp">#define ADD_3(sum, a, b, c) (sum = (a) + (b) + (c)) </span><span class="c1">// &#39;a&#39;, &#39;b&#39;, and &#39;c&#39; need parentheses, while &#39;sum&#39; does not.</span>

<span class="cp">#define FOO(a, b) Bar((a) + 1, b)       </span><span class="c1">// &#39;a&#39; needs parentheses, while &#39;b&#39; does not.</span>
</pre></div>
</div>
</div>
<div class="section" id="rule-6-2-implementation-statements-of-function-like-macros-that-contain-multiple-statements-must-be-placed-in-a-do-while-0">
<h3>Rule 6.2 Implementation statements of function-like macros that contain multiple statements must be placed in a do-while(0).<a class="headerlink" href="#rule-6-2-implementation-statements-of-function-like-macros-that-contain-multiple-statements-must-be-placed-in-a-do-while-0" title="Permalink to this headline">¶</a></h3>
<p>Macros do not have code blocks. Macros do not have code blocks. When a
macro is expanded at the call point, the expressions and variables
defined in the macro are integrated into the calling code. As a result,
variable name conflict and segmentation of macro statements may occur.
Use do-while(0) to add a boundary to the macro so that the macro has an
independent scope. In addition, a single statement can be formed by
combining the macro with a semicolon (;) to avoid this problem.</p>
<p>The following macro is incorrect:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Not Good.</span>
<span class="cp">#define FOO(x) \</span>
<span class="cp">    (void)printf(&quot;arg is %d\n&quot;, (x)); \</span>
<span class="cp">    DoSomething((x));</span>
</pre></div>
</div>
<p>When the macro is called as shown in the following example code, the for
loop only executes the first statement of the macro, and the next
statement of the macro is executed only after the loop ends.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">FOO</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</pre></div>
</div>
<p>To solve the preceding problem, use braces to enclose the statements
defined by <code class="docutils literal notranslate"><span class="pre">FOO</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FOO(x) { \</span>
<span class="cp">    (void)printf(&quot;arg is %d\n&quot;, (x)); \</span>
<span class="cp">    DoSomething((x)); \</span>
<span class="cp">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The brackets are not associated with semicolons (;). The semicolon
following the braces is another statement.</div>
<div class="line">In the following code example, the &quot;suspended else’ compilation error
message is displayed.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span>
    <span class="n">FOO</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="k">else</span>
    <span class="nf">FOO</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
<p>The correct format is to wrap the executed body using a do-while(0), as
shown in the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Good.</span>
<span class="cp">#define FOO(x) do { \</span>
<span class="cp">    (void)printf(&quot;arg is %d\n&quot;, (x)); \</span>
<span class="cp">    DoSomething((x)); \</span>
<span class="cp">} while (0)</span>
</pre></div>
</div>
<p>Exception:</p>
<ul class="simple">
<li><p>Macros that contain ‘break’ or ‘continue’ statements can be treated
as exceptions. Do use these macros carefully.</p></li>
<li><p>An exception can be made when the macro contains an incomplete
statement. For example, use a macro to encapsulate the conditional
part of the for loop.</p></li>
<li><p>An exception can be a non-multiple statement, or a single
if/for/while/switch statement.</p></li>
</ul>
</div>
<div class="section" id="rule-6-3-do-not-pass-expressions-with-side-effects-to-a-function-like-macro">
<h3>Rule 6.3 Do not pass expressions with side effects to a function-like macro.<a class="headerlink" href="#rule-6-3-do-not-pass-expressions-with-side-effects-to-a-function-like-macro" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Since macros are replaced by text, if a function-like macro uses the
same macro parameter multiple times and transfers expressions with
side effects as macro parameters, unexpected results may occur.</div>
<div class="line">As shown in the following example, the macro <code class="docutils literal notranslate"><span class="pre">SQUARE</span></code> is normal, but
the <code class="docutils literal notranslate"><span class="pre">a++</span></code> expression with side effects is passed to the macro. As a
result, the value of <code class="docutils literal notranslate"><span class="pre">a</span></code> is different from the expected value after
the <code class="docutils literal notranslate"><span class="pre">SQUARE</span></code> macro is executed.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define SQUARE(a) ((a) * (a))</span>

<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">SQUARE</span><span class="p">(</span><span class="n">a</span><span class="o">++</span><span class="p">);</span>    <span class="c1">// Bad: &#39;a&#39; is added twice.</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SQUARE(a++)</span></code> is expanded to <code class="docutils literal notranslate"><span class="pre">((a++)</span> <span class="pre">*</span> <span class="pre">(a++))</span></code> the variable <code class="docutils literal notranslate"><span class="pre">a</span></code> is
added twice, and its value is <code class="docutils literal notranslate"><span class="pre">7</span></code> instead of the expected <code class="docutils literal notranslate"><span class="pre">6</span></code>.</p>
<p>The correct format is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">SQUARE</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="n">a</span><span class="o">++</span><span class="p">;</span> <span class="c1">// Result: a = 6, which is added only once.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In addition, if the macro parameter contains a function call, the
function may be called repeatedly after the macro is expanded.</div>
<div class="line">If the function execution results are the same, it is a waste; if the
results are different, the execution result may not meet the expected
value.</div>
</div>
</div>
<div class="section" id="rec-6-2-exercise-caution-when-you-use-the-statements-such-as-return-goto-continue-and-break-in-a-function-like-macro-definition">
<h3>Rec 6.2 Exercise caution when you use the statements such as return, goto, continue, and break in a function-like macro definition.<a class="headerlink" href="#rec-6-2-exercise-caution-when-you-use-the-statements-such-as-return-goto-continue-and-break-in-a-function-like-macro-definition" title="Permalink to this headline">¶</a></h3>
<p>In a macro, the process changing statements, such as return, goto,
continue, and break. While they can simplify the code, they hide the
real process, which hinders understanding and causes resource leakage.</p>
<div class="line-block">
<div class="line">First, the macro encapsulation of the statement ‘return’ can easily
lead to excessive encapsulation and use.</div>
<div class="line">As shown in the following code, the judgment of <code class="docutils literal notranslate"><span class="pre">status</span></code> is a part
of the main process. After being encapsulated in macros, the purpose
is not intuitive. The <code class="docutils literal notranslate"><span class="pre">RETURN_IF</span></code> macro is ignored, causing a
confused understanding.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define LOG_AND_RETURN_IF_FAIL(ret, fmt, ...) do { \</span>
<span class="cp">    if ((ret) != OK) {                             \</span>
<span class="cp">        (void)ErrLog(fmt, ##__VA_ARGS__);          \</span>
<span class="cp">        return (ret);                              \</span>
<span class="cp">    }                                              \</span>
<span class="cp">} while (0)</span>

<span class="cp">#define RETURN_IF(cond, ret) do {                  \</span>
<span class="cp">    if (cond) {                                    \</span>
<span class="cp">        return (ret);                              \</span>
<span class="cp">    }                                              \</span>
<span class="cp">} while (0)</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">InitModuleA</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">);</span>
<span class="n">LOG_AND_RETURN_IF_FAIL</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s">&quot;Init module A failed!&quot;</span><span class="p">);</span> <span class="c1">// OK.</span>

<span class="n">RETURN_IF</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">READY</span><span class="p">,</span> <span class="n">ERR_NOT_READY</span><span class="p">);</span>  <span class="c1">// Bad: The most important logic is not obvious.</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">InitModuleB</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="n">LOG_AND_RETURN_IF_FAIL</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s">&quot;Init module B failed!&quot;</span><span class="p">);</span> <span class="c1">// OK.</span>
</pre></div>
</div>
<p>Second, if return is encapsulated in a macro, it may also cause a memory
leak. Example is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CHECK_PTR(ptr, ret) do { \</span>
<span class="cp">    if ((ptr) == NULL) { \</span>
<span class="cp">        return (ret); \</span>
<span class="cp">    } \</span>
<span class="cp">} while (0)</span>

<span class="p">...</span>

<span class="n">mem1</span> <span class="o">=</span> <span class="n">MemAlloc</span><span class="p">(...);</span>
<span class="n">CHECK_PTR</span><span class="p">(</span><span class="n">mem1</span><span class="p">,</span> <span class="n">ERR_CODE_XXX</span><span class="p">);</span>

<span class="n">mem2</span> <span class="o">=</span> <span class="n">MemAlloc</span><span class="p">(...);</span>
<span class="n">CHECK_PTR</span><span class="p">(</span><span class="n">mem2</span><span class="p">,</span> <span class="n">ERR_CODE_XXX</span><span class="p">);</span>  <span class="c1">// Wrong: Memory leak.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">If <code class="docutils literal notranslate"><span class="pre">mem2</span></code> fails to apply for memory, the <code class="docutils literal notranslate"><span class="pre">CHECK_PTR</span></code> will return a
message instead of releasing <code class="docutils literal notranslate"><span class="pre">mem1</span></code>.</div>
<div class="line">Besides, the name of the <code class="docutils literal notranslate"><span class="pre">CHECK_PTR</span></code> macro is not good. The macro
name only reflects the check action and does not specify the result.
Readers can see that a failure is returned when the pointer is null
only after viewing the macro implementation. It’s not inherently
obvious.</div>
</div>
<div class="line-block">
<div class="line">In summary: It is not recommended to encapsulate statements that
change control flow, such as return, goto, continue, and break in
macro definitions.</div>
<div class="line">However, these macros can be used such as return value judgment as an
exception.</div>
</div>
<p>Note: <strong>Macro names must contain descriptive keywords if statements that
will change control flow such as return, goto, continue, and break are
used.</strong></p>
</div>
<div class="section" id="rec-6-3-ensure-that-function-like-macros-contain-no-more-than-10-lines-not-including-blank-lines-and-comments">
<h3>Rec 6.3 Ensure that function-like macros contain no more than 10 lines (not including blank lines and comments).<a class="headerlink" href="#rec-6-3-ensure-that-function-like-macros-contain-no-more-than-10-lines-not-including-blank-lines-and-comments" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">A big problem of the function-like macro is that it is more difficult
to debug and locate than the function, especially when the macro is
too long.</div>
<div class="line">Macro expansion will also lead to more compiled code. It is
recommended that function-like macros contain no more than 10 lines.</div>
</div>
</div>
</div>
</div>
<div class="section" id="variables">
<h1>7 Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">In C language coding, variables are the most important except for
functions.</div>
<div class="line">When using a variable, you should always follow the principle of
“single responsibility”.</div>
<div class="line">By scope, variables can be classified into global variables and local
variables.</div>
</div>
<div class="section" id="global-variables">
<h2>Global Variables<a class="headerlink" href="#global-variables" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Do not use or avoid using global variables.</div>
<div class="line">In program design, global variables are variables that are accessible
to all scopes. Using unnecessary global variables is generally
considered a bad habit.</div>
</div>
<p>Disadvantages of global variables:</p>
<ul class="simple">
<li><p>Destroys the independence and portability of a function. Functions
can be dependent on global variables and increased coupling results.</p></li>
<li><p>Reduces readability and maintainability. When multiple functions read
and write to global variables, their values may not be determinate,
which is unfavorable for comprehension and maintenance.</p></li>
<li><p>In a concurrent programming environment, global variables will hinder
reentry of functions. Additional synchronization protection must be
added to ensure data security.</p></li>
</ul>
<p>If unavoidable, the read and write of global variables should be
encapsulated in a centralized manner.</p>
<div class="section" id="rule-7-1-do-not-use-global-variables-as-interfaces-between-modules">
<h3>Rule 7.1 Do not use global variables as interfaces between modules.<a class="headerlink" href="#rule-7-1-do-not-use-global-variables-as-interfaces-between-modules" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Global variables are for the internal implementation of modules and
should not be exposed as interfaces.</div>
<div class="line">Global variables should be as centralized as possible. If the data of
this module needs to be disclosed to external modules, a function as
an interface to this data should be provided.</div>
</div>
</div>
</div>
<div class="section" id="local-variables">
<h2>Local Variables<a class="headerlink" href="#local-variables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-7-2-do-not-use-uninitialized-variables-as-rvalues">
<h3>Rule 7.2 Do not use uninitialized variables as rvalues.<a class="headerlink" href="#rule-7-2-do-not-use-uninitialized-variables-as-rvalues" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The variable here refers to a local dynamic variable, and also
includes a memory block obtained on a memory heap.</div>
<div class="line">Because their initial values are unpredictable, it is prohibited to
use them directly as rvalues without effective initialization.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Foo</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>  <span class="c1">// Bad: Uninitialized variables are used as rvalues.</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If there are different branches, ensure that all branches are
initialized before being used as rvalues.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Foo</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(...)</span> <span class="p">{</span>
        <span class="n">data</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Bar</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>  <span class="c1">// Bad: This value is not initialized in some branches.</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Uninitialized rvalues can be found by generic static check tools.</div>
<div class="line">For example, the PCLint tool reports a warning for the following two
examples.</div>
</div>
<blockquote>
<div><p>Warning 530: Symbol ‘data’ (line …) not initialized Warning 644:
Variable ‘data’ (line …) may not have been initialized</p>
</div></blockquote>
</div>
<div class="section" id="rule-7-3-forbid-invalid-and-redundant-variable-initialization">
<h3>Rule 7.3 Forbid invalid and redundant variable initialization.<a class="headerlink" href="#rule-7-3-forbid-invalid-and-redundant-variable-initialization" title="Permalink to this headline">¶</a></h3>
<p>If the initial value is not determined before initialization is
performed, it is not concise but not secure, which may introduce
problems that are more difficult to discover.</p>
<p>Common redundant initialization:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    <span class="c1">// Bad: Redundant initialization. It will be overwritten by later initialization.</span>
<span class="p">...</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="n">GetXxxCnt</span><span class="p">();</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Variables with conditional values can be initialized to default values
during definition.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>   <span class="c1">// Good: NULL as the default value</span>
<span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">MEM_SIZE</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// Check whether memory has been allocated.</span>
    <span class="n">free</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Even worse, redundant clearing for arrays may affect the performance.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">VERY_BIG_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>    <span class="c1">// Bad: Redundant clearing</span>
</pre></div>
</div>
<p>Invalid initialization, which hides a more severe problem:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Foo</span><span class="p">(...)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// Bad: regular initialization</span>

    <span class="n">UseData</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>          <span class="c1">// UseData should be placed after GetData.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">GetData</span><span class="p">(...);</span>    <span class="c1">// Get data.</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In the preceding code, if 0 is not assigned before initialization, the
static check tool can help find the problem of “direct use without
being initialized”.</div>
<div class="line">However, due to invalid initialization, the defect of placing
“UseData” before “GetData” cannot be easily found.</div>
</div>
<p>Therefore, simple code should be written to initialize variables or
memory blocks as required.</p>
<div class="line-block">
<div class="line">The C99 does not limit the definition position of local variables to
before the first statement in a function. That is, a variable can now
be defined close to a variable.</div>
<div class="line">This concise approach not only limits the scope of the variable scope,
but also solves the problem of how to initialize the variable when it
is defined.</div>
<div class="line">If this compilation environment is supported, you are advised to
define local variables in this way.</div>
</div>
<div class="line-block">
<div class="line"><strong>Exception:</strong></div>
<div class="line"><strong>As ‘Secure Coding Standard’ required, pointers, resource variables,
and boolean variables can be treated as exceptions of this rule.</strong></div>
</div>
</div>
<div class="section" id="rule-7-4-do-not-use-magic-numbers">
<h3>Rule 7.4 Do not use magic numbers.<a class="headerlink" href="#rule-7-4-do-not-use-magic-numbers" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The so-called magic numbers are the numbers that are unintelligible
and difficult to understand.</div>
<div class="line">The magic number is not a concept that can be defined literally. It
varies depending on context and service knowledge.</div>
</div>
<div class="line-block">
<div class="line">For example, the number 12 varies in different contexts.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">12;</span></code> is not intelligible, but <code class="docutils literal notranslate"><span class="pre">month</span> <span class="pre">=</span> <span class="pre">year</span> <span class="pre">*</span> <span class="pre">12;</span></code> can be
understood.</div>
<div class="line">The number 0 is sometimes seen as a magic number. For example, the
<code class="docutils literal notranslate"><span class="pre">status</span> <span class="pre">=</span> <span class="pre">0;</span></code> cannot truly express any status information.</div>
</div>
<div class="line-block">
<div class="line">Solution:</div>
<div class="line">Comments can be added for numbers that are used only once.</div>
<div class="line">For numbers that are used multiple times, macro or const variables
must be defined and self-commented with symbolic naming.</div>
</div>
<div class="line-block">
<div class="line">The following cases are forbidden:</div>
<div class="line">The name is not used to explain the meaning of a number, for example,
<code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">ZERO</span> <span class="pre">0</span></code>.</div>
<div class="line">The value is limited by the name, for example,
<code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">XX_TIMER_INTERVAL_300MS</span> <span class="pre">300</span></code>.</div>
</div>
</div>
</div>
</div>
<div class="section" id="programming-practice">
<h1>8 Programming Practice<a class="headerlink" href="#programming-practice" title="Permalink to this headline">¶</a></h1>
<div class="section" id="expressions-1">
<span id="id1"></span><h2>Expressions<a class="headerlink" href="#expressions-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rec-8-1-when-comparing-expressions-follow-the-principle-that-the-left-side-tends-to-change-and-the-right-side-tends-to-remain-unchanged">
<h3>Rec 8.1 When comparing expressions, follow the principle that the left side tends to change and the right side tends to remain unchanged.<a class="headerlink" href="#rec-8-1-when-comparing-expressions-follow-the-principle-that-the-left-side-tends-to-change-and-the-right-side-tends-to-remain-unchanged" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">When a variable is compared with a constant, placing the constant on
the left, for example, <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(MAX</span> <span class="pre">==</span> <span class="pre">v)</span></code> does not read naturally, and
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(MAX</span> <span class="pre">&gt;</span> <span class="pre">v)</span></code> is more diﬃcult to understand.</div>
<div class="line">The constant should be placed on the right according to the normal
reading order and habit. The expression is written as follows:</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">MAX</span><span class="p">)</span> <span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="n">MAX</span><span class="p">)</span> <span class="p">...</span>
</pre></div>
</div>
<p>There are special cases: for example, the expression
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(MIN</span> <span class="pre">&lt;</span> <span class="pre">v</span> <span class="pre">&amp;&amp;</span> <span class="pre">v</span> <span class="pre">&lt;</span> <span class="pre">MAX)</span></code> is used to check for a range. This first
constant should be placed on the left.</p>
<p>You do not need to worry about accidentally writing ‘==’ as ‘=’ because
a compilation alarm will be generated for <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(v</span> <span class="pre">=</span> <span class="pre">MAX)</span></code> and an error
will be reported by other static check tools. Use these tools to solve
such writing errors and ensure that that code is readable.</p>
</div>
<div class="section" id="a-full-expression-containing-an-increment-or-decrement-operator-should-have-no-other-using-of-the-variable">
<h3>A full expression containing an increment (++) or decrement (–) operator should have no other using of the variable.<a class="headerlink" href="#a-full-expression-containing-an-increment-or-decrement-operator-should-have-no-other-using-of-the-variable" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">In an expression containing a variable increment or decrement
operation, if the variable is referenced again, the result is not
explicitly defined in the C standard, which may vary between compilers
or different versions of the same compiler.</div>
<div class="line">For better portability, you should not make any assumptions about the
operation sequence not defined in any standards.</div>
</div>
<p>Note that this problem cannot be solved by using parentheses because it
is not a problem of priority.</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span> <span class="c1">// Bad: b[i] operation and i++, the order is not clear.</span>
</pre></div>
</div>
<p>The correct way is to add a separate line of increment or decrement:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
<span class="n">i</span><span class="o">++</span><span class="p">;</span>            <span class="c1">// Good: Single line.</span>
</pre></div>
</div>
<p>Function parameter:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Func</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>   <span class="c1">// Bad: When passing the second parameter, it is not sure whether the increment operation has occurred.</span>
</pre></div>
</div>
<p>The correct way:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">++</span><span class="p">;</span>            <span class="c1">// Good: Single line.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Func</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="rec-8-2-use-parentheses-to-specify-the-sequence-of-expressions-instead-of-using-the-default-priority">
<h3>Rec 8.2 Use parentheses to specify the sequence of expressions, instead of using the default priority.<a class="headerlink" href="#rec-8-2-use-parentheses-to-specify-the-sequence-of-expressions-instead-of-using-the-default-priority" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Parentheses can be used to better emphasize the purpose of used
operators. This will prevent program errors due to the inconsistency
between default priority and the intended design.</div>
<div class="line">However, too many parentheses muddy the code, reducing readability.
Use them moderately.</div>
</div>
<p>Parentheses are recommended when expressions contain operators that are
not commonly used and are confusing, such as bitwise operators.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>     <span class="cm">/* Parentheses are required while using bit operators. */</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="statements">
<h2>Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rule-8-2-the-switch-statement-must-have-a-default-branch">
<h3>Rule 8.2 The switch statement must have a ‘default’ branch.<a class="headerlink" href="#rule-8-2-the-switch-statement-must-have-a-default-branch" title="Permalink to this headline">¶</a></h3>
<p>In most cases, the ‘default’ branch exists in the switch statement to
ensure that there is a default processing action when the case tag is
missing.</p>
<div class="line-block">
<div class="line">Exception:</div>
<div class="line">If the switch condition variable is of the enumeration type and the
case branches cover all values, then the default branch is redundant.</div>
<div class="line">A modern compiler can check whether the case branch of some enumerated
values is missing in the switch statement. A warning will be
displayed.</div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="n">RED</span><span class="p">,</span>
    <span class="n">BLUE</span>
<span class="p">};</span>

<span class="c1">// The switch condition variable is an enumerated value. Therefore, you do not need to add the &#39;default&#39; processing branch.</span>
<span class="k">switch</span> <span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">RED</span><span class="p">:</span>
        <span class="n">DoRedThing</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">BLUE</span><span class="p">:</span>
        <span class="n">DoBlueThing</span><span class="p">();</span>
        <span class="p">...</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="rec-8-3-exercise-caution-when-using-the-goto-statement">
<h3>Rec 8.3 Exercise caution when using the goto statement.<a class="headerlink" href="#rec-8-3-exercise-caution-when-using-the-goto-statement" title="Permalink to this headline">¶</a></h3>
<p>The goto statement destroys the structure of the program, so you’d
better not use the goto statement unless you really need it. You can
only jump to statements following the goto statement, and only within
the one function.</p>
<div class="line-block">
<div class="line">The goto statement is used to implement function return to a single
point within a function.</div>
<div class="line">If a function has a large number of identical logics that cannot be
encapsulated, for example, repeated file execution, the processed part
of code after the file operation failure (for example, closing the
file handle and releasing memory that is dynamically applied for) is
usually placed in the last part of the function body. And the goto
statement is placed right before these. In this way, the code becomes
clear and concise. It can also be encapsulated in functions or macros,
but doing so makes code less straightforward.</div>
</div>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Good: Use a goto statement to implement function return at a single point.</span>
<span class="kt">int</span> <span class="nf">SomeInitFunc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">p1</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">p3</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">MEM_LEN</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">EXIT</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">p2</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">MEM_LEN</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p2</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">EXIT</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">p3</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">MEM_LEN</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p3</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">EXIT</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">DoSomething</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// OK.</span>

<span class="nl">EXIT</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p3</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">free</span><span class="p">(</span><span class="n">p3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p2</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">free</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">free</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">-1</span><span class="p">;</span>  <span class="c1">// Failed!</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-conversion">
<h2>Type Conversion<a class="headerlink" href="#type-conversion" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rec-8-4-minimize-unnecessary-type-conversion-and-forced-conversion">
<h3>Rec 8.4 Minimize unnecessary type conversion and forced conversion.<a class="headerlink" href="#rec-8-4-minimize-unnecessary-type-conversion-and-forced-conversion" title="Permalink to this headline">¶</a></h3>
<p>When the data type is forcibly changed, the meaning of the data and the
value after conversion may change. If details are not considered,
potential risks may be generated.</p>
<p>In the following assignment, most compilers do not generate warnings,
but the values are slightly changed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">exam</span><span class="p">;</span>

<span class="n">ch</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
<span class="n">exam</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span> <span class="c1">// Bad: Compilers does not generate any warnings. In this case, the value of exam is 0xFFFF.</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/contribute/OpenHarmony-c-coding-style-guide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>