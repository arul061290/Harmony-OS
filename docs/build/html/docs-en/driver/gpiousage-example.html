
<!DOCTYPE html>

<html lang="y">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GPIO Usage Example &#8212; Harmony 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="gpio-usage-example">
<h1>GPIO Usage Example<a class="headerlink" href="#gpio-usage-example" title="Permalink to this headline">Â¶</a></h1>
<p>In this example, we test the interrupt trigger of a GPIO pin as follows:
Set the ISR function for the pin, set the trigger mode to rising edge
and failing edge, write high and low levels to the pin alternately to
generate level fluctuation, and observe the execution of the ISR
function.</p>
<p>Select an idle GPIO pin. This example uses a Hi3516D V300 development
board and GPIO pin GPIO10_3, which is numbered GPIO83.</p>
<p>You can select an idle GPIO pin based on the development board and
schematic diagram.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#include &quot;gpio_if.h&quot;
#include &quot;hdf_log.h&quot;
#include &quot;osal_irq.h&quot;
#include &quot;osal_time.h&quot;

static uint32_t g_irqCnt;

/* ISR function */
static int32_t TestCaseGpioIrqHandler(uint16_t gpio, void *data)
{
    HDF_LOGE(&quot;%s: irq triggered! on gpio:%u, data=%p&quot;, __func__, gpio, data);
    g_irqCnt++; /* If the ISR function is triggered, the number of global interrupts is incremented by 1. */
    return GpioDisableIrq(gpio);
}

/* Test case function */
static int32_t TestCaseGpioIrqEdge(void)
{
    int32_t ret;
    uint16_t valRead;
    uint16_t mode;
    uint16_t gpio = 83; /* Number of the GPIO pin to test */
    uint32_t timeout;

    /* Set the output direction for the pin. */
    ret = GpioSetDir(gpio, GPIO_DIR_OUT);
    if (ret != HDF_SUCCESS) {
        HDF_LOGE(&quot;%s: set dir fail! ret:%d\n&quot;, __func__, ret);
        return ret;
    }

    /* Disable the interrupt of the pin. */
    ret = GpioDisableIrq(gpio);
    if (ret != HDF_SUCCESS) {
        HDF_LOGE(&quot;%s: disable irq fail! ret:%d\n&quot;, __func__, ret);
        return ret;
    }

    /* Set the ISR function for the pin. The trigger mode is both rising edge and falling edge. */
    mode = OSAL_IRQF_TRIGGER_RISING | OSAL_IRQF_TRIGGER_FALLING;
    HDF_LOGE(&quot;%s: mode:%0x\n&quot;, __func__, mode);
    ret = GpioSetIrq(gpio, mode, TestCaseGpioIrqHandler, NULL);
    if (ret != HDF_SUCCESS) {
        HDF_LOGE(&quot;%s: set irq fail! ret:%d\n&quot;, __func__, ret);
        return ret;
    }

    /* Enable the interrupt for this pin. */
    ret = GpioEnableIrq(gpio);
    if (ret != HDF_SUCCESS) {
        HDF_LOGE(&quot;%s: enable irq fail! ret:%d\n&quot;, __func__, ret);
        (void)GpioUnSetIrq(gpio);
        return ret;
    }

    g_irqCnt = 0; /* Reset the global counter. */
    timeout = 0;  /* Reset the waiting time. */
    /* Wait for the ISR function of this pin to trigger. The timeout duration is 1000 ms. */
    while (g_irqCnt &lt;= 0 &amp;&amp; timeout &lt; 1000) {
        (void)GpioRead(gpio, &amp;valRead);
        (void)GpioWrite(gpio, (valRead == GPIO_VAL_LOW) ? GPIO_VAL_HIGH : GPIO_VAL_LOW);
        HDF_LOGE(&quot;%s: wait irq timeout:%u\n&quot;, __func__, timeout);
        OsalMDelay(200); /* wait for irq trigger */
        timeout += 200;
    }
    (void)GpioUnSetIrq(gpio);
    return (g_irqCnt &gt; 0) ? HDF_SUCCESS : HDF_FAILURE;
}
</pre></div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Harmony</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Arul.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/docs-en/driver/gpiousage-example.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>